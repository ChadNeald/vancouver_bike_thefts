var ME=Object.defineProperty;var NE=(t,e,n)=>e in t?ME(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(NE(t,typeof e!="symbol"?e+"":e,n),n);function kE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var SF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bm(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Cm={exports:{}},Q={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uo=Symbol.for("react.element"),OE=Symbol.for("react.portal"),FE=Symbol.for("react.fragment"),DE=Symbol.for("react.strict_mode"),UE=Symbol.for("react.profiler"),BE=Symbol.for("react.provider"),LE=Symbol.for("react.context"),VE=Symbol.for("react.forward_ref"),zE=Symbol.for("react.suspense"),jE=Symbol.for("react.memo"),HE=Symbol.for("react.lazy"),Jd=Symbol.iterator;function WE(t){return t===null||typeof t!="object"?null:(t=Jd&&t[Jd]||t["@@iterator"],typeof t=="function"?t:null)}var Pm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xm=Object.assign,Im={};function ji(t,e,n){this.props=t,this.context=e,this.refs=Im,this.updater=n||Pm}ji.prototype.isReactComponent={};ji.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ji.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Mm(){}Mm.prototype=ji.prototype;function rf(t,e,n){this.props=t,this.context=e,this.refs=Im,this.updater=n||Pm}var sf=rf.prototype=new Mm;sf.constructor=rf;xm(sf,ji.prototype);sf.isPureReactComponent=!0;var Gd=Array.isArray,Nm=Object.prototype.hasOwnProperty,of={current:null},km={key:!0,ref:!0,__self:!0,__source:!0};function Om(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Nm.call(e,r)&&!km.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:uo,type:t,key:s,ref:o,props:i,_owner:of.current}}function $E(t,e){return{$$typeof:uo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function af(t){return typeof t=="object"&&t!==null&&t.$$typeof===uo}function XE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var ep=/\/+/g;function Ec(t,e){return typeof t=="object"&&t!==null&&t.key!=null?XE(""+t.key):e.toString(36)}function ua(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case uo:case OE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Ec(o,0):r,Gd(i)?(n="",t!=null&&(n=t.replace(ep,"$&/")+"/"),ua(i,e,n,"",function(c){return c})):i!=null&&(af(i)&&(i=$E(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(ep,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Gd(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+Ec(s,a);o+=ua(s,e,n,l,i)}else if(l=WE(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+Ec(s,a++),o+=ua(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ko(t,e,n){if(t==null)return t;var r=[],i=0;return ua(t,r,"","",function(s){return e.call(n,s,i++)}),r}function YE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var qe={current:null},ha={transition:null},KE={ReactCurrentDispatcher:qe,ReactCurrentBatchConfig:ha,ReactCurrentOwner:of};function Fm(){throw Error("act(...) is not supported in production builds of React.")}Q.Children={map:ko,forEach:function(t,e,n){ko(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ko(t,function(){e++}),e},toArray:function(t){return ko(t,function(e){return e})||[]},only:function(t){if(!af(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Q.Component=ji;Q.Fragment=FE;Q.Profiler=UE;Q.PureComponent=rf;Q.StrictMode=DE;Q.Suspense=zE;Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KE;Q.act=Fm;Q.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=xm({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=of.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)Nm.call(e,l)&&!km.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:uo,type:t.type,key:i,ref:s,props:r,_owner:o}};Q.createContext=function(t){return t={$$typeof:LE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:BE,_context:t},t.Consumer=t};Q.createElement=Om;Q.createFactory=function(t){var e=Om.bind(null,t);return e.type=t,e};Q.createRef=function(){return{current:null}};Q.forwardRef=function(t){return{$$typeof:VE,render:t}};Q.isValidElement=af;Q.lazy=function(t){return{$$typeof:HE,_payload:{_status:-1,_result:t},_init:YE}};Q.memo=function(t,e){return{$$typeof:jE,type:t,compare:e===void 0?null:e}};Q.startTransition=function(t){var e=ha.transition;ha.transition={};try{t()}finally{ha.transition=e}};Q.unstable_act=Fm;Q.useCallback=function(t,e){return qe.current.useCallback(t,e)};Q.useContext=function(t){return qe.current.useContext(t)};Q.useDebugValue=function(){};Q.useDeferredValue=function(t){return qe.current.useDeferredValue(t)};Q.useEffect=function(t,e){return qe.current.useEffect(t,e)};Q.useId=function(){return qe.current.useId()};Q.useImperativeHandle=function(t,e,n){return qe.current.useImperativeHandle(t,e,n)};Q.useInsertionEffect=function(t,e){return qe.current.useInsertionEffect(t,e)};Q.useLayoutEffect=function(t,e){return qe.current.useLayoutEffect(t,e)};Q.useMemo=function(t,e){return qe.current.useMemo(t,e)};Q.useReducer=function(t,e,n){return qe.current.useReducer(t,e,n)};Q.useRef=function(t){return qe.current.useRef(t)};Q.useState=function(t){return qe.current.useState(t)};Q.useSyncExternalStore=function(t,e,n){return qe.current.useSyncExternalStore(t,e,n)};Q.useTransition=function(){return qe.current.useTransition()};Q.version="18.3.1";Cm.exports=Q;var L=Cm.exports;const xe=bm(L);var Dm={exports:{}},ht={},Um={exports:{}},Bm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(j,Y){var q=j.length;j.push(Y);e:for(;0<q;){var K=q-1>>>1,J=j[K];if(0<i(J,Y))j[K]=Y,j[q]=J,q=K;else break e}}function n(j){return j.length===0?null:j[0]}function r(j){if(j.length===0)return null;var Y=j[0],q=j.pop();if(q!==Y){j[0]=q;e:for(var K=0,J=j.length,he=J>>>1;K<he;){var Ue=2*(K+1)-1,At=j[Ue],tn=Ue+1,Ee=j[tn];if(0>i(At,q))tn<J&&0>i(Ee,At)?(j[K]=Ee,j[tn]=q,K=tn):(j[K]=At,j[Ue]=q,K=Ue);else if(tn<J&&0>i(Ee,q))j[K]=Ee,j[tn]=q,K=tn;else break e}}return Y}function i(j,Y){var q=j.sortIndex-Y.sortIndex;return q!==0?q:j.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,m=!1,E=!1,w=!1,S=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,d=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(j){for(var Y=n(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=j)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=n(c)}}function A(j){if(w=!1,y(j),!E)if(n(l)!==null)E=!0,dt(b);else{var Y=n(c);Y!==null&&Qe(A,Y.startTime-j)}}function b(j,Y){E=!1,w&&(w=!1,_(M),M=-1),m=!0;var q=f;try{for(y(Y),h=n(l);h!==null&&(!(h.expirationTime>Y)||j&&!V());){var K=h.callback;if(typeof K=="function"){h.callback=null,f=h.priorityLevel;var J=K(h.expirationTime<=Y);Y=t.unstable_now(),typeof J=="function"?h.callback=J:h===n(l)&&r(l),y(Y)}else r(l);h=n(l)}if(h!==null)var he=!0;else{var Ue=n(c);Ue!==null&&Qe(A,Ue.startTime-Y),he=!1}return he}finally{h=null,f=q,m=!1}}var I=!1,k=null,M=-1,O=5,F=-1;function V(){return!(t.unstable_now()-F<O)}function z(){if(k!==null){var j=t.unstable_now();F=j;var Y=!0;try{Y=k(!0,j)}finally{Y?X():(I=!1,k=null)}}else I=!1}var X;if(typeof d=="function")X=function(){d(z)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,G=$.port2;$.port1.onmessage=z,X=function(){G.postMessage(null)}}else X=function(){S(z,0)};function dt(j){k=j,I||(I=!0,X())}function Qe(j,Y){M=S(function(){j(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(j){j.callback=null},t.unstable_continueExecution=function(){E||m||(E=!0,dt(b))},t.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<j?Math.floor(1e3/j):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(j){switch(f){case 1:case 2:case 3:var Y=3;break;default:Y=f}var q=f;f=Y;try{return j()}finally{f=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(j,Y){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var q=f;f=j;try{return Y()}finally{f=q}},t.unstable_scheduleCallback=function(j,Y,q){var K=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?K+q:K):q=K,j){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=q+J,j={id:u++,callback:Y,priorityLevel:j,startTime:q,expirationTime:J,sortIndex:-1},q>K?(j.sortIndex=q,e(c,j),n(l)===null&&j===n(c)&&(w?(_(M),M=-1):w=!0,Qe(A,q-K))):(j.sortIndex=J,e(l,j),E||m||(E=!0,dt(b))),j},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(j){var Y=f;return function(){var q=f;f=Y;try{return j.apply(this,arguments)}finally{f=q}}}})(Bm);Um.exports=Bm;var qE=Um.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZE=L,ut=qE;function U(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Lm=new Set,Ls={};function Ir(t,e){Ai(t,e),Ai(t+"Capture",e)}function Ai(t,e){for(Ls[t]=e,t=0;t<e.length;t++)Lm.add(e[t])}var pn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Au=Object.prototype.hasOwnProperty,QE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tp={},np={};function JE(t){return Au.call(np,t)?!0:Au.call(tp,t)?!1:QE.test(t)?np[t]=!0:(tp[t]=!0,!1)}function GE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ew(t,e,n,r){if(e===null||typeof e>"u"||GE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ze(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var De={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){De[t]=new Ze(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];De[e]=new Ze(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){De[t]=new Ze(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){De[t]=new Ze(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){De[t]=new Ze(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){De[t]=new Ze(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){De[t]=new Ze(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){De[t]=new Ze(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){De[t]=new Ze(t,5,!1,t.toLowerCase(),null,!1,!1)});var lf=/[\-:]([a-z])/g;function cf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(lf,cf);De[e]=new Ze(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(lf,cf);De[e]=new Ze(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(lf,cf);De[e]=new Ze(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){De[t]=new Ze(t,1,!1,t.toLowerCase(),null,!1,!1)});De.xlinkHref=new Ze("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){De[t]=new Ze(t,1,!1,t.toLowerCase(),null,!0,!0)});function uf(t,e,n,r){var i=De.hasOwnProperty(e)?De[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ew(e,n,i,r)&&(n=null),r||i===null?JE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var vn=ZE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Oo=Symbol.for("react.element"),qr=Symbol.for("react.portal"),Zr=Symbol.for("react.fragment"),hf=Symbol.for("react.strict_mode"),Ru=Symbol.for("react.profiler"),Vm=Symbol.for("react.provider"),zm=Symbol.for("react.context"),ff=Symbol.for("react.forward_ref"),bu=Symbol.for("react.suspense"),Cu=Symbol.for("react.suspense_list"),df=Symbol.for("react.memo"),Cn=Symbol.for("react.lazy"),jm=Symbol.for("react.offscreen"),rp=Symbol.iterator;function Gi(t){return t===null||typeof t!="object"?null:(t=rp&&t[rp]||t["@@iterator"],typeof t=="function"?t:null)}var me=Object.assign,wc;function ps(t){if(wc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);wc=e&&e[1]||""}return`
`+wc+t}var Sc=!1;function Ac(t,e){if(!t||Sc)return"";Sc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Sc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ps(t):""}function tw(t){switch(t.tag){case 5:return ps(t.type);case 16:return ps("Lazy");case 13:return ps("Suspense");case 19:return ps("SuspenseList");case 0:case 2:case 15:return t=Ac(t.type,!1),t;case 11:return t=Ac(t.type.render,!1),t;case 1:return t=Ac(t.type,!0),t;default:return""}}function Pu(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Zr:return"Fragment";case qr:return"Portal";case Ru:return"Profiler";case hf:return"StrictMode";case bu:return"Suspense";case Cu:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case zm:return(t.displayName||"Context")+".Consumer";case Vm:return(t._context.displayName||"Context")+".Provider";case ff:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case df:return e=t.displayName||null,e!==null?e:Pu(t.type)||"Memo";case Cn:e=t._payload,t=t._init;try{return Pu(t(e))}catch{}}return null}function nw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Pu(e);case 8:return e===hf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Kn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Hm(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function rw(t){var e=Hm(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Fo(t){t._valueTracker||(t._valueTracker=rw(t))}function Wm(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Hm(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ra(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function xu(t,e){var n=e.checked;return me({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ip(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Kn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function $m(t,e){e=e.checked,e!=null&&uf(t,"checked",e,!1)}function Iu(t,e){$m(t,e);var n=Kn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Mu(t,e.type,n):e.hasOwnProperty("defaultValue")&&Mu(t,e.type,Kn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function sp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Mu(t,e,n){(e!=="number"||Ra(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var gs=Array.isArray;function pi(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Kn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Nu(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(U(91));return me({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function op(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(U(92));if(gs(n)){if(1<n.length)throw Error(U(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Kn(n)}}function Xm(t,e){var n=Kn(e.value),r=Kn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function ap(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Ym(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ku(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Ym(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Do,Km=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Do=Do||document.createElement("div"),Do.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Do.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Vs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ws={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},iw=["Webkit","ms","Moz","O"];Object.keys(ws).forEach(function(t){iw.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ws[e]=ws[t]})});function qm(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ws.hasOwnProperty(t)&&ws[t]?(""+e).trim():e+"px"}function Zm(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=qm(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var sw=me({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ou(t,e){if(e){if(sw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(U(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(U(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(U(61))}if(e.style!=null&&typeof e.style!="object")throw Error(U(62))}}function Fu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Du=null;function pf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Uu=null,gi=null,_i=null;function lp(t){if(t=po(t)){if(typeof Uu!="function")throw Error(U(280));var e=t.stateNode;e&&(e=zl(e),Uu(t.stateNode,t.type,e))}}function Qm(t){gi?_i?_i.push(t):_i=[t]:gi=t}function Jm(){if(gi){var t=gi,e=_i;if(_i=gi=null,lp(t),e)for(t=0;t<e.length;t++)lp(e[t])}}function Gm(t,e){return t(e)}function ey(){}var Rc=!1;function ty(t,e,n){if(Rc)return t(e,n);Rc=!0;try{return Gm(t,e,n)}finally{Rc=!1,(gi!==null||_i!==null)&&(ey(),Jm())}}function zs(t,e){var n=t.stateNode;if(n===null)return null;var r=zl(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(U(231,e,typeof n));return n}var Bu=!1;if(pn)try{var es={};Object.defineProperty(es,"passive",{get:function(){Bu=!0}}),window.addEventListener("test",es,es),window.removeEventListener("test",es,es)}catch{Bu=!1}function ow(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Ss=!1,ba=null,Ca=!1,Lu=null,aw={onError:function(t){Ss=!0,ba=t}};function lw(t,e,n,r,i,s,o,a,l){Ss=!1,ba=null,ow.apply(aw,arguments)}function cw(t,e,n,r,i,s,o,a,l){if(lw.apply(this,arguments),Ss){if(Ss){var c=ba;Ss=!1,ba=null}else throw Error(U(198));Ca||(Ca=!0,Lu=c)}}function Mr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ny(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function cp(t){if(Mr(t)!==t)throw Error(U(188))}function uw(t){var e=t.alternate;if(!e){if(e=Mr(t),e===null)throw Error(U(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return cp(i),t;if(s===r)return cp(i),e;s=s.sibling}throw Error(U(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(U(189))}}if(n.alternate!==r)throw Error(U(190))}if(n.tag!==3)throw Error(U(188));return n.stateNode.current===n?t:e}function ry(t){return t=uw(t),t!==null?iy(t):null}function iy(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=iy(t);if(e!==null)return e;t=t.sibling}return null}var sy=ut.unstable_scheduleCallback,up=ut.unstable_cancelCallback,hw=ut.unstable_shouldYield,fw=ut.unstable_requestPaint,Te=ut.unstable_now,dw=ut.unstable_getCurrentPriorityLevel,gf=ut.unstable_ImmediatePriority,oy=ut.unstable_UserBlockingPriority,Pa=ut.unstable_NormalPriority,pw=ut.unstable_LowPriority,ay=ut.unstable_IdlePriority,Ul=null,Qt=null;function gw(t){if(Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(Ul,t,void 0,(t.current.flags&128)===128)}catch{}}var Nt=Math.clz32?Math.clz32:yw,_w=Math.log,mw=Math.LN2;function yw(t){return t>>>=0,t===0?32:31-(_w(t)/mw|0)|0}var Uo=64,Bo=4194304;function _s(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function xa(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=_s(a):(s&=o,s!==0&&(r=_s(s)))}else o=n&~i,o!==0?r=_s(o):s!==0&&(r=_s(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Nt(e),i=1<<n,r|=t[n],e&=~i;return r}function vw(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Tw(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Nt(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=vw(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Vu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ly(){var t=Uo;return Uo<<=1,!(Uo&4194240)&&(Uo=64),t}function bc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ho(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Nt(e),t[e]=n}function Ew(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Nt(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function _f(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Nt(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var re=0;function cy(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var uy,mf,hy,fy,dy,zu=!1,Lo=[],Bn=null,Ln=null,Vn=null,js=new Map,Hs=new Map,Mn=[],ww="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hp(t,e){switch(t){case"focusin":case"focusout":Bn=null;break;case"dragenter":case"dragleave":Ln=null;break;case"mouseover":case"mouseout":Vn=null;break;case"pointerover":case"pointerout":js.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hs.delete(e.pointerId)}}function ts(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=po(e),e!==null&&mf(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Sw(t,e,n,r,i){switch(e){case"focusin":return Bn=ts(Bn,t,e,n,r,i),!0;case"dragenter":return Ln=ts(Ln,t,e,n,r,i),!0;case"mouseover":return Vn=ts(Vn,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return js.set(s,ts(js.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Hs.set(s,ts(Hs.get(s)||null,t,e,n,r,i)),!0}return!1}function py(t){var e=fr(t.target);if(e!==null){var n=Mr(e);if(n!==null){if(e=n.tag,e===13){if(e=ny(n),e!==null){t.blockedOn=e,dy(t.priority,function(){hy(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function fa(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ju(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Du=r,n.target.dispatchEvent(r),Du=null}else return e=po(n),e!==null&&mf(e),t.blockedOn=n,!1;e.shift()}return!0}function fp(t,e,n){fa(t)&&n.delete(e)}function Aw(){zu=!1,Bn!==null&&fa(Bn)&&(Bn=null),Ln!==null&&fa(Ln)&&(Ln=null),Vn!==null&&fa(Vn)&&(Vn=null),js.forEach(fp),Hs.forEach(fp)}function ns(t,e){t.blockedOn===e&&(t.blockedOn=null,zu||(zu=!0,ut.unstable_scheduleCallback(ut.unstable_NormalPriority,Aw)))}function Ws(t){function e(i){return ns(i,t)}if(0<Lo.length){ns(Lo[0],t);for(var n=1;n<Lo.length;n++){var r=Lo[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Bn!==null&&ns(Bn,t),Ln!==null&&ns(Ln,t),Vn!==null&&ns(Vn,t),js.forEach(e),Hs.forEach(e),n=0;n<Mn.length;n++)r=Mn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Mn.length&&(n=Mn[0],n.blockedOn===null);)py(n),n.blockedOn===null&&Mn.shift()}var mi=vn.ReactCurrentBatchConfig,Ia=!0;function Rw(t,e,n,r){var i=re,s=mi.transition;mi.transition=null;try{re=1,yf(t,e,n,r)}finally{re=i,mi.transition=s}}function bw(t,e,n,r){var i=re,s=mi.transition;mi.transition=null;try{re=4,yf(t,e,n,r)}finally{re=i,mi.transition=s}}function yf(t,e,n,r){if(Ia){var i=ju(t,e,n,r);if(i===null)Dc(t,e,r,Ma,n),hp(t,r);else if(Sw(i,t,e,n,r))r.stopPropagation();else if(hp(t,r),e&4&&-1<ww.indexOf(t)){for(;i!==null;){var s=po(i);if(s!==null&&uy(s),s=ju(t,e,n,r),s===null&&Dc(t,e,r,Ma,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Dc(t,e,r,null,n)}}var Ma=null;function ju(t,e,n,r){if(Ma=null,t=pf(r),t=fr(t),t!==null)if(e=Mr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ny(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ma=t,null}function gy(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dw()){case gf:return 1;case oy:return 4;case Pa:case pw:return 16;case ay:return 536870912;default:return 16}default:return 16}}var kn=null,vf=null,da=null;function _y(){if(da)return da;var t,e=vf,n=e.length,r,i="value"in kn?kn.value:kn.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return da=i.slice(t,1<r?1-r:void 0)}function pa(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vo(){return!0}function dp(){return!1}function ft(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Vo:dp,this.isPropagationStopped=dp,this}return me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vo)},persist:function(){},isPersistent:Vo}),e}var Hi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tf=ft(Hi),fo=me({},Hi,{view:0,detail:0}),Cw=ft(fo),Cc,Pc,rs,Bl=me({},fo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ef,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==rs&&(rs&&t.type==="mousemove"?(Cc=t.screenX-rs.screenX,Pc=t.screenY-rs.screenY):Pc=Cc=0,rs=t),Cc)},movementY:function(t){return"movementY"in t?t.movementY:Pc}}),pp=ft(Bl),Pw=me({},Bl,{dataTransfer:0}),xw=ft(Pw),Iw=me({},fo,{relatedTarget:0}),xc=ft(Iw),Mw=me({},Hi,{animationName:0,elapsedTime:0,pseudoElement:0}),Nw=ft(Mw),kw=me({},Hi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ow=ft(kw),Fw=me({},Hi,{data:0}),gp=ft(Fw),Dw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Uw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Bw[t])?!!e[t]:!1}function Ef(){return Lw}var Vw=me({},fo,{key:function(t){if(t.key){var e=Dw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=pa(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Uw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ef,charCode:function(t){return t.type==="keypress"?pa(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?pa(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),zw=ft(Vw),jw=me({},Bl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_p=ft(jw),Hw=me({},fo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ef}),Ww=ft(Hw),$w=me({},Hi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xw=ft($w),Yw=me({},Bl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Kw=ft(Yw),qw=[9,13,27,32],wf=pn&&"CompositionEvent"in window,As=null;pn&&"documentMode"in document&&(As=document.documentMode);var Zw=pn&&"TextEvent"in window&&!As,my=pn&&(!wf||As&&8<As&&11>=As),mp=String.fromCharCode(32),yp=!1;function yy(t,e){switch(t){case"keyup":return qw.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vy(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Qr=!1;function Qw(t,e){switch(t){case"compositionend":return vy(e);case"keypress":return e.which!==32?null:(yp=!0,mp);case"textInput":return t=e.data,t===mp&&yp?null:t;default:return null}}function Jw(t,e){if(Qr)return t==="compositionend"||!wf&&yy(t,e)?(t=_y(),da=vf=kn=null,Qr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return my&&e.locale!=="ko"?null:e.data;default:return null}}var Gw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Gw[t.type]:e==="textarea"}function Ty(t,e,n,r){Qm(r),e=Na(e,"onChange"),0<e.length&&(n=new Tf("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Rs=null,$s=null;function eS(t){My(t,0)}function Ll(t){var e=ei(t);if(Wm(e))return t}function tS(t,e){if(t==="change")return e}var Ey=!1;if(pn){var Ic;if(pn){var Mc="oninput"in document;if(!Mc){var Tp=document.createElement("div");Tp.setAttribute("oninput","return;"),Mc=typeof Tp.oninput=="function"}Ic=Mc}else Ic=!1;Ey=Ic&&(!document.documentMode||9<document.documentMode)}function Ep(){Rs&&(Rs.detachEvent("onpropertychange",wy),$s=Rs=null)}function wy(t){if(t.propertyName==="value"&&Ll($s)){var e=[];Ty(e,$s,t,pf(t)),ty(eS,e)}}function nS(t,e,n){t==="focusin"?(Ep(),Rs=e,$s=n,Rs.attachEvent("onpropertychange",wy)):t==="focusout"&&Ep()}function rS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ll($s)}function iS(t,e){if(t==="click")return Ll(e)}function sS(t,e){if(t==="input"||t==="change")return Ll(e)}function oS(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ot=typeof Object.is=="function"?Object.is:oS;function Xs(t,e){if(Ot(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Au.call(e,i)||!Ot(t[i],e[i]))return!1}return!0}function wp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sp(t,e){var n=wp(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=wp(n)}}function Sy(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Sy(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Ay(){for(var t=window,e=Ra();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ra(t.document)}return e}function Sf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function aS(t){var e=Ay(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Sy(n.ownerDocument.documentElement,n)){if(r!==null&&Sf(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=Sp(n,s);var o=Sp(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var lS=pn&&"documentMode"in document&&11>=document.documentMode,Jr=null,Hu=null,bs=null,Wu=!1;function Ap(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Wu||Jr==null||Jr!==Ra(r)||(r=Jr,"selectionStart"in r&&Sf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bs&&Xs(bs,r)||(bs=r,r=Na(Hu,"onSelect"),0<r.length&&(e=new Tf("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Jr)))}function zo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Gr={animationend:zo("Animation","AnimationEnd"),animationiteration:zo("Animation","AnimationIteration"),animationstart:zo("Animation","AnimationStart"),transitionend:zo("Transition","TransitionEnd")},Nc={},Ry={};pn&&(Ry=document.createElement("div").style,"AnimationEvent"in window||(delete Gr.animationend.animation,delete Gr.animationiteration.animation,delete Gr.animationstart.animation),"TransitionEvent"in window||delete Gr.transitionend.transition);function Vl(t){if(Nc[t])return Nc[t];if(!Gr[t])return t;var e=Gr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Ry)return Nc[t]=e[n];return t}var by=Vl("animationend"),Cy=Vl("animationiteration"),Py=Vl("animationstart"),xy=Vl("transitionend"),Iy=new Map,Rp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jn(t,e){Iy.set(t,e),Ir(e,[t])}for(var kc=0;kc<Rp.length;kc++){var Oc=Rp[kc],cS=Oc.toLowerCase(),uS=Oc[0].toUpperCase()+Oc.slice(1);Jn(cS,"on"+uS)}Jn(by,"onAnimationEnd");Jn(Cy,"onAnimationIteration");Jn(Py,"onAnimationStart");Jn("dblclick","onDoubleClick");Jn("focusin","onFocus");Jn("focusout","onBlur");Jn(xy,"onTransitionEnd");Ai("onMouseEnter",["mouseout","mouseover"]);Ai("onMouseLeave",["mouseout","mouseover"]);Ai("onPointerEnter",["pointerout","pointerover"]);Ai("onPointerLeave",["pointerout","pointerover"]);Ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ir("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ms="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),hS=new Set("cancel close invalid load scroll toggle".split(" ").concat(ms));function bp(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,cw(r,e,void 0,t),t.currentTarget=null}function My(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;bp(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;bp(i,a,c),s=l}}}if(Ca)throw t=Lu,Ca=!1,Lu=null,t}function ce(t,e){var n=e[qu];n===void 0&&(n=e[qu]=new Set);var r=t+"__bubble";n.has(r)||(Ny(e,t,2,!1),n.add(r))}function Fc(t,e,n){var r=0;e&&(r|=4),Ny(n,t,r,e)}var jo="_reactListening"+Math.random().toString(36).slice(2);function Ys(t){if(!t[jo]){t[jo]=!0,Lm.forEach(function(n){n!=="selectionchange"&&(hS.has(n)||Fc(n,!1,t),Fc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[jo]||(e[jo]=!0,Fc("selectionchange",!1,e))}}function Ny(t,e,n,r){switch(gy(e)){case 1:var i=Rw;break;case 4:i=bw;break;default:i=yf}n=i.bind(null,e,n,t),i=void 0,!Bu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Dc(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=fr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}ty(function(){var c=s,u=pf(n),h=[];e:{var f=Iy.get(t);if(f!==void 0){var m=Tf,E=t;switch(t){case"keypress":if(pa(n)===0)break e;case"keydown":case"keyup":m=zw;break;case"focusin":E="focus",m=xc;break;case"focusout":E="blur",m=xc;break;case"beforeblur":case"afterblur":m=xc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=pp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=xw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Ww;break;case by:case Cy:case Py:m=Nw;break;case xy:m=Xw;break;case"scroll":m=Cw;break;case"wheel":m=Kw;break;case"copy":case"cut":case"paste":m=Ow;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=_p}var w=(e&4)!==0,S=!w&&t==="scroll",_=w?f!==null?f+"Capture":null:f;w=[];for(var d=c,y;d!==null;){y=d;var A=y.stateNode;if(y.tag===5&&A!==null&&(y=A,_!==null&&(A=zs(d,_),A!=null&&w.push(Ks(d,A,y)))),S)break;d=d.return}0<w.length&&(f=new m(f,E,null,n,u),h.push({event:f,listeners:w}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&n!==Du&&(E=n.relatedTarget||n.fromElement)&&(fr(E)||E[gn]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(E=n.relatedTarget||n.toElement,m=c,E=E?fr(E):null,E!==null&&(S=Mr(E),E!==S||E.tag!==5&&E.tag!==6)&&(E=null)):(m=null,E=c),m!==E)){if(w=pp,A="onMouseLeave",_="onMouseEnter",d="mouse",(t==="pointerout"||t==="pointerover")&&(w=_p,A="onPointerLeave",_="onPointerEnter",d="pointer"),S=m==null?f:ei(m),y=E==null?f:ei(E),f=new w(A,d+"leave",m,n,u),f.target=S,f.relatedTarget=y,A=null,fr(u)===c&&(w=new w(_,d+"enter",E,n,u),w.target=y,w.relatedTarget=S,A=w),S=A,m&&E)t:{for(w=m,_=E,d=0,y=w;y;y=Br(y))d++;for(y=0,A=_;A;A=Br(A))y++;for(;0<d-y;)w=Br(w),d--;for(;0<y-d;)_=Br(_),y--;for(;d--;){if(w===_||_!==null&&w===_.alternate)break t;w=Br(w),_=Br(_)}w=null}else w=null;m!==null&&Cp(h,f,m,w,!1),E!==null&&S!==null&&Cp(h,S,E,w,!0)}}e:{if(f=c?ei(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var b=tS;else if(vp(f))if(Ey)b=sS;else{b=rS;var I=nS}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=iS);if(b&&(b=b(t,c))){Ty(h,b,n,u);break e}I&&I(t,f,c),t==="focusout"&&(I=f._wrapperState)&&I.controlled&&f.type==="number"&&Mu(f,"number",f.value)}switch(I=c?ei(c):window,t){case"focusin":(vp(I)||I.contentEditable==="true")&&(Jr=I,Hu=c,bs=null);break;case"focusout":bs=Hu=Jr=null;break;case"mousedown":Wu=!0;break;case"contextmenu":case"mouseup":case"dragend":Wu=!1,Ap(h,n,u);break;case"selectionchange":if(lS)break;case"keydown":case"keyup":Ap(h,n,u)}var k;if(wf)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Qr?yy(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(my&&n.locale!=="ko"&&(Qr||M!=="onCompositionStart"?M==="onCompositionEnd"&&Qr&&(k=_y()):(kn=u,vf="value"in kn?kn.value:kn.textContent,Qr=!0)),I=Na(c,M),0<I.length&&(M=new gp(M,t,null,n,u),h.push({event:M,listeners:I}),k?M.data=k:(k=vy(n),k!==null&&(M.data=k)))),(k=Zw?Qw(t,n):Jw(t,n))&&(c=Na(c,"onBeforeInput"),0<c.length&&(u=new gp("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:c}),u.data=k))}My(h,e)})}function Ks(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Na(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=zs(t,n),s!=null&&r.unshift(Ks(t,s,i)),s=zs(t,e),s!=null&&r.push(Ks(t,s,i))),t=t.return}return r}function Br(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Cp(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=zs(n,s),l!=null&&o.unshift(Ks(n,l,a))):i||(l=zs(n,s),l!=null&&o.push(Ks(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var fS=/\r\n?/g,dS=/\u0000|\uFFFD/g;function Pp(t){return(typeof t=="string"?t:""+t).replace(fS,`
`).replace(dS,"")}function Ho(t,e,n){if(e=Pp(e),Pp(t)!==e&&n)throw Error(U(425))}function ka(){}var $u=null,Xu=null;function Yu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ku=typeof setTimeout=="function"?setTimeout:void 0,pS=typeof clearTimeout=="function"?clearTimeout:void 0,xp=typeof Promise=="function"?Promise:void 0,gS=typeof queueMicrotask=="function"?queueMicrotask:typeof xp<"u"?function(t){return xp.resolve(null).then(t).catch(_S)}:Ku;function _S(t){setTimeout(function(){throw t})}function Uc(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Ws(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Ws(e)}function zn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ip(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Wi=Math.random().toString(36).slice(2),Xt="__reactFiber$"+Wi,qs="__reactProps$"+Wi,gn="__reactContainer$"+Wi,qu="__reactEvents$"+Wi,mS="__reactListeners$"+Wi,yS="__reactHandles$"+Wi;function fr(t){var e=t[Xt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[gn]||n[Xt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ip(t);t!==null;){if(n=t[Xt])return n;t=Ip(t)}return e}t=n,n=t.parentNode}return null}function po(t){return t=t[Xt]||t[gn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ei(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(U(33))}function zl(t){return t[qs]||null}var Zu=[],ti=-1;function Gn(t){return{current:t}}function ue(t){0>ti||(t.current=Zu[ti],Zu[ti]=null,ti--)}function ae(t,e){ti++,Zu[ti]=t.current,t.current=e}var qn={},We=Gn(qn),tt=Gn(!1),Sr=qn;function Ri(t,e){var n=t.type.contextTypes;if(!n)return qn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function nt(t){return t=t.childContextTypes,t!=null}function Oa(){ue(tt),ue(We)}function Mp(t,e,n){if(We.current!==qn)throw Error(U(168));ae(We,e),ae(tt,n)}function ky(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(U(108,nw(t)||"Unknown",i));return me({},n,r)}function Fa(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||qn,Sr=We.current,ae(We,t),ae(tt,tt.current),!0}function Np(t,e,n){var r=t.stateNode;if(!r)throw Error(U(169));n?(t=ky(t,e,Sr),r.__reactInternalMemoizedMergedChildContext=t,ue(tt),ue(We),ae(We,t)):ue(tt),ae(tt,n)}var ln=null,jl=!1,Bc=!1;function Oy(t){ln===null?ln=[t]:ln.push(t)}function vS(t){jl=!0,Oy(t)}function er(){if(!Bc&&ln!==null){Bc=!0;var t=0,e=re;try{var n=ln;for(re=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ln=null,jl=!1}catch(i){throw ln!==null&&(ln=ln.slice(t+1)),sy(gf,er),i}finally{re=e,Bc=!1}}return null}var ni=[],ri=0,Da=null,Ua=0,_t=[],mt=0,Ar=null,un=1,hn="";function or(t,e){ni[ri++]=Ua,ni[ri++]=Da,Da=t,Ua=e}function Fy(t,e,n){_t[mt++]=un,_t[mt++]=hn,_t[mt++]=Ar,Ar=t;var r=un;t=hn;var i=32-Nt(r)-1;r&=~(1<<i),n+=1;var s=32-Nt(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,un=1<<32-Nt(e)+i|n<<i|r,hn=s+t}else un=1<<s|n<<i|r,hn=t}function Af(t){t.return!==null&&(or(t,1),Fy(t,1,0))}function Rf(t){for(;t===Da;)Da=ni[--ri],ni[ri]=null,Ua=ni[--ri],ni[ri]=null;for(;t===Ar;)Ar=_t[--mt],_t[mt]=null,hn=_t[--mt],_t[mt]=null,un=_t[--mt],_t[mt]=null}var ct=null,at=null,fe=!1,xt=null;function Dy(t,e){var n=yt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function kp(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ct=t,at=zn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ct=t,at=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ar!==null?{id:un,overflow:hn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=yt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ct=t,at=null,!0):!1;default:return!1}}function Qu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ju(t){if(fe){var e=at;if(e){var n=e;if(!kp(t,e)){if(Qu(t))throw Error(U(418));e=zn(n.nextSibling);var r=ct;e&&kp(t,e)?Dy(r,n):(t.flags=t.flags&-4097|2,fe=!1,ct=t)}}else{if(Qu(t))throw Error(U(418));t.flags=t.flags&-4097|2,fe=!1,ct=t}}}function Op(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ct=t}function Wo(t){if(t!==ct)return!1;if(!fe)return Op(t),fe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Yu(t.type,t.memoizedProps)),e&&(e=at)){if(Qu(t))throw Uy(),Error(U(418));for(;e;)Dy(t,e),e=zn(e.nextSibling)}if(Op(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(U(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){at=zn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}at=null}}else at=ct?zn(t.stateNode.nextSibling):null;return!0}function Uy(){for(var t=at;t;)t=zn(t.nextSibling)}function bi(){at=ct=null,fe=!1}function bf(t){xt===null?xt=[t]:xt.push(t)}var TS=vn.ReactCurrentBatchConfig;function is(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(U(309));var r=n.stateNode}if(!r)throw Error(U(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(U(284));if(!n._owner)throw Error(U(290,t))}return t}function $o(t,e){throw t=Object.prototype.toString.call(e),Error(U(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Fp(t){var e=t._init;return e(t._payload)}function By(t){function e(_,d){if(t){var y=_.deletions;y===null?(_.deletions=[d],_.flags|=16):y.push(d)}}function n(_,d){if(!t)return null;for(;d!==null;)e(_,d),d=d.sibling;return null}function r(_,d){for(_=new Map;d!==null;)d.key!==null?_.set(d.key,d):_.set(d.index,d),d=d.sibling;return _}function i(_,d){return _=$n(_,d),_.index=0,_.sibling=null,_}function s(_,d,y){return _.index=y,t?(y=_.alternate,y!==null?(y=y.index,y<d?(_.flags|=2,d):y):(_.flags|=2,d)):(_.flags|=1048576,d)}function o(_){return t&&_.alternate===null&&(_.flags|=2),_}function a(_,d,y,A){return d===null||d.tag!==6?(d=$c(y,_.mode,A),d.return=_,d):(d=i(d,y),d.return=_,d)}function l(_,d,y,A){var b=y.type;return b===Zr?u(_,d,y.props.children,A,y.key):d!==null&&(d.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Cn&&Fp(b)===d.type)?(A=i(d,y.props),A.ref=is(_,d,y),A.return=_,A):(A=Ea(y.type,y.key,y.props,null,_.mode,A),A.ref=is(_,d,y),A.return=_,A)}function c(_,d,y,A){return d===null||d.tag!==4||d.stateNode.containerInfo!==y.containerInfo||d.stateNode.implementation!==y.implementation?(d=Xc(y,_.mode,A),d.return=_,d):(d=i(d,y.children||[]),d.return=_,d)}function u(_,d,y,A,b){return d===null||d.tag!==7?(d=vr(y,_.mode,A,b),d.return=_,d):(d=i(d,y),d.return=_,d)}function h(_,d,y){if(typeof d=="string"&&d!==""||typeof d=="number")return d=$c(""+d,_.mode,y),d.return=_,d;if(typeof d=="object"&&d!==null){switch(d.$$typeof){case Oo:return y=Ea(d.type,d.key,d.props,null,_.mode,y),y.ref=is(_,null,d),y.return=_,y;case qr:return d=Xc(d,_.mode,y),d.return=_,d;case Cn:var A=d._init;return h(_,A(d._payload),y)}if(gs(d)||Gi(d))return d=vr(d,_.mode,y,null),d.return=_,d;$o(_,d)}return null}function f(_,d,y,A){var b=d!==null?d.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return b!==null?null:a(_,d,""+y,A);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Oo:return y.key===b?l(_,d,y,A):null;case qr:return y.key===b?c(_,d,y,A):null;case Cn:return b=y._init,f(_,d,b(y._payload),A)}if(gs(y)||Gi(y))return b!==null?null:u(_,d,y,A,null);$o(_,y)}return null}function m(_,d,y,A,b){if(typeof A=="string"&&A!==""||typeof A=="number")return _=_.get(y)||null,a(d,_,""+A,b);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Oo:return _=_.get(A.key===null?y:A.key)||null,l(d,_,A,b);case qr:return _=_.get(A.key===null?y:A.key)||null,c(d,_,A,b);case Cn:var I=A._init;return m(_,d,y,I(A._payload),b)}if(gs(A)||Gi(A))return _=_.get(y)||null,u(d,_,A,b,null);$o(d,A)}return null}function E(_,d,y,A){for(var b=null,I=null,k=d,M=d=0,O=null;k!==null&&M<y.length;M++){k.index>M?(O=k,k=null):O=k.sibling;var F=f(_,k,y[M],A);if(F===null){k===null&&(k=O);break}t&&k&&F.alternate===null&&e(_,k),d=s(F,d,M),I===null?b=F:I.sibling=F,I=F,k=O}if(M===y.length)return n(_,k),fe&&or(_,M),b;if(k===null){for(;M<y.length;M++)k=h(_,y[M],A),k!==null&&(d=s(k,d,M),I===null?b=k:I.sibling=k,I=k);return fe&&or(_,M),b}for(k=r(_,k);M<y.length;M++)O=m(k,_,M,y[M],A),O!==null&&(t&&O.alternate!==null&&k.delete(O.key===null?M:O.key),d=s(O,d,M),I===null?b=O:I.sibling=O,I=O);return t&&k.forEach(function(V){return e(_,V)}),fe&&or(_,M),b}function w(_,d,y,A){var b=Gi(y);if(typeof b!="function")throw Error(U(150));if(y=b.call(y),y==null)throw Error(U(151));for(var I=b=null,k=d,M=d=0,O=null,F=y.next();k!==null&&!F.done;M++,F=y.next()){k.index>M?(O=k,k=null):O=k.sibling;var V=f(_,k,F.value,A);if(V===null){k===null&&(k=O);break}t&&k&&V.alternate===null&&e(_,k),d=s(V,d,M),I===null?b=V:I.sibling=V,I=V,k=O}if(F.done)return n(_,k),fe&&or(_,M),b;if(k===null){for(;!F.done;M++,F=y.next())F=h(_,F.value,A),F!==null&&(d=s(F,d,M),I===null?b=F:I.sibling=F,I=F);return fe&&or(_,M),b}for(k=r(_,k);!F.done;M++,F=y.next())F=m(k,_,M,F.value,A),F!==null&&(t&&F.alternate!==null&&k.delete(F.key===null?M:F.key),d=s(F,d,M),I===null?b=F:I.sibling=F,I=F);return t&&k.forEach(function(z){return e(_,z)}),fe&&or(_,M),b}function S(_,d,y,A){if(typeof y=="object"&&y!==null&&y.type===Zr&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Oo:e:{for(var b=y.key,I=d;I!==null;){if(I.key===b){if(b=y.type,b===Zr){if(I.tag===7){n(_,I.sibling),d=i(I,y.props.children),d.return=_,_=d;break e}}else if(I.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Cn&&Fp(b)===I.type){n(_,I.sibling),d=i(I,y.props),d.ref=is(_,I,y),d.return=_,_=d;break e}n(_,I);break}else e(_,I);I=I.sibling}y.type===Zr?(d=vr(y.props.children,_.mode,A,y.key),d.return=_,_=d):(A=Ea(y.type,y.key,y.props,null,_.mode,A),A.ref=is(_,d,y),A.return=_,_=A)}return o(_);case qr:e:{for(I=y.key;d!==null;){if(d.key===I)if(d.tag===4&&d.stateNode.containerInfo===y.containerInfo&&d.stateNode.implementation===y.implementation){n(_,d.sibling),d=i(d,y.children||[]),d.return=_,_=d;break e}else{n(_,d);break}else e(_,d);d=d.sibling}d=Xc(y,_.mode,A),d.return=_,_=d}return o(_);case Cn:return I=y._init,S(_,d,I(y._payload),A)}if(gs(y))return E(_,d,y,A);if(Gi(y))return w(_,d,y,A);$o(_,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,d!==null&&d.tag===6?(n(_,d.sibling),d=i(d,y),d.return=_,_=d):(n(_,d),d=$c(y,_.mode,A),d.return=_,_=d),o(_)):n(_,d)}return S}var Ci=By(!0),Ly=By(!1),Ba=Gn(null),La=null,ii=null,Cf=null;function Pf(){Cf=ii=La=null}function xf(t){var e=Ba.current;ue(Ba),t._currentValue=e}function Gu(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function yi(t,e){La=t,Cf=ii=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(et=!0),t.firstContext=null)}function wt(t){var e=t._currentValue;if(Cf!==t)if(t={context:t,memoizedValue:e,next:null},ii===null){if(La===null)throw Error(U(308));ii=t,La.dependencies={lanes:0,firstContext:t}}else ii=ii.next=t;return e}var dr=null;function If(t){dr===null?dr=[t]:dr.push(t)}function Vy(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,If(e)):(n.next=i.next,i.next=n),e.interleaved=n,_n(t,r)}function _n(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Pn=!1;function Mf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zy(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function dn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function jn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ee&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,_n(t,n)}return i=r.interleaved,i===null?(e.next=e,If(r)):(e.next=i.next,i.next=e),r.interleaved=e,_n(t,n)}function ga(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,_f(t,n)}}function Dp(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Va(t,e,n,r){var i=t.updateQueue;Pn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=i.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane,m=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var E=t,w=a;switch(f=e,m=n,w.tag){case 1:if(E=w.payload,typeof E=="function"){h=E.call(m,h,f);break e}h=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=w.payload,f=typeof E=="function"?E.call(m,h,f):E,f==null)break e;h=me({},h,f);break e;case 2:Pn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(u===null&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);br|=o,t.lanes=o,t.memoizedState=h}}function Up(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(U(191,i));i.call(r)}}}var go={},Jt=Gn(go),Zs=Gn(go),Qs=Gn(go);function pr(t){if(t===go)throw Error(U(174));return t}function Nf(t,e){switch(ae(Qs,e),ae(Zs,t),ae(Jt,go),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ku(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ku(e,t)}ue(Jt),ae(Jt,e)}function Pi(){ue(Jt),ue(Zs),ue(Qs)}function jy(t){pr(Qs.current);var e=pr(Jt.current),n=ku(e,t.type);e!==n&&(ae(Zs,t),ae(Jt,n))}function kf(t){Zs.current===t&&(ue(Jt),ue(Zs))}var pe=Gn(0);function za(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Lc=[];function Of(){for(var t=0;t<Lc.length;t++)Lc[t]._workInProgressVersionPrimary=null;Lc.length=0}var _a=vn.ReactCurrentDispatcher,Vc=vn.ReactCurrentBatchConfig,Rr=0,_e=null,Re=null,Ie=null,ja=!1,Cs=!1,Js=0,ES=0;function Be(){throw Error(U(321))}function Ff(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ot(t[n],e[n]))return!1;return!0}function Df(t,e,n,r,i,s){if(Rr=s,_e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,_a.current=t===null||t.memoizedState===null?RS:bS,t=n(r,i),Cs){s=0;do{if(Cs=!1,Js=0,25<=s)throw Error(U(301));s+=1,Ie=Re=null,e.updateQueue=null,_a.current=CS,t=n(r,i)}while(Cs)}if(_a.current=Ha,e=Re!==null&&Re.next!==null,Rr=0,Ie=Re=_e=null,ja=!1,e)throw Error(U(300));return t}function Uf(){var t=Js!==0;return Js=0,t}function $t(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ie===null?_e.memoizedState=Ie=t:Ie=Ie.next=t,Ie}function St(){if(Re===null){var t=_e.alternate;t=t!==null?t.memoizedState:null}else t=Re.next;var e=Ie===null?_e.memoizedState:Ie.next;if(e!==null)Ie=e,Re=t;else{if(t===null)throw Error(U(310));Re=t,t={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Ie===null?_e.memoizedState=Ie=t:Ie=Ie.next=t}return Ie}function Gs(t,e){return typeof e=="function"?e(t):e}function zc(t){var e=St(),n=e.queue;if(n===null)throw Error(U(311));n.lastRenderedReducer=t;var r=Re,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Rr&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,_e.lanes|=u,br|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,Ot(r,e.memoizedState)||(et=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,_e.lanes|=s,br|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function jc(t){var e=St(),n=e.queue;if(n===null)throw Error(U(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Ot(s,e.memoizedState)||(et=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Hy(){}function Wy(t,e){var n=_e,r=St(),i=e(),s=!Ot(r.memoizedState,i);if(s&&(r.memoizedState=i,et=!0),r=r.queue,Bf(Yy.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ie!==null&&Ie.memoizedState.tag&1){if(n.flags|=2048,eo(9,Xy.bind(null,n,r,i,e),void 0,null),Me===null)throw Error(U(349));Rr&30||$y(n,e,i)}return i}function $y(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Xy(t,e,n,r){e.value=n,e.getSnapshot=r,Ky(e)&&qy(t)}function Yy(t,e,n){return n(function(){Ky(e)&&qy(t)})}function Ky(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ot(t,n)}catch{return!0}}function qy(t){var e=_n(t,1);e!==null&&kt(e,t,1,-1)}function Bp(t){var e=$t();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gs,lastRenderedState:t},e.queue=t,t=t.dispatch=AS.bind(null,_e,t),[e.memoizedState,t]}function eo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Zy(){return St().memoizedState}function ma(t,e,n,r){var i=$t();_e.flags|=t,i.memoizedState=eo(1|e,n,void 0,r===void 0?null:r)}function Hl(t,e,n,r){var i=St();r=r===void 0?null:r;var s=void 0;if(Re!==null){var o=Re.memoizedState;if(s=o.destroy,r!==null&&Ff(r,o.deps)){i.memoizedState=eo(e,n,s,r);return}}_e.flags|=t,i.memoizedState=eo(1|e,n,s,r)}function Lp(t,e){return ma(8390656,8,t,e)}function Bf(t,e){return Hl(2048,8,t,e)}function Qy(t,e){return Hl(4,2,t,e)}function Jy(t,e){return Hl(4,4,t,e)}function Gy(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function e0(t,e,n){return n=n!=null?n.concat([t]):null,Hl(4,4,Gy.bind(null,e,t),n)}function Lf(){}function t0(t,e){var n=St();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Ff(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function n0(t,e){var n=St();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Ff(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function r0(t,e,n){return Rr&21?(Ot(n,e)||(n=ly(),_e.lanes|=n,br|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,et=!0),t.memoizedState=n)}function wS(t,e){var n=re;re=n!==0&&4>n?n:4,t(!0);var r=Vc.transition;Vc.transition={};try{t(!1),e()}finally{re=n,Vc.transition=r}}function i0(){return St().memoizedState}function SS(t,e,n){var r=Wn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},s0(t))o0(e,n);else if(n=Vy(t,e,n,r),n!==null){var i=Ke();kt(n,t,r,i),a0(n,e,r)}}function AS(t,e,n){var r=Wn(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(s0(t))o0(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Ot(a,o)){var l=e.interleaved;l===null?(i.next=i,If(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=Vy(t,e,i,r),n!==null&&(i=Ke(),kt(n,t,r,i),a0(n,e,r))}}function s0(t){var e=t.alternate;return t===_e||e!==null&&e===_e}function o0(t,e){Cs=ja=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function a0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,_f(t,n)}}var Ha={readContext:wt,useCallback:Be,useContext:Be,useEffect:Be,useImperativeHandle:Be,useInsertionEffect:Be,useLayoutEffect:Be,useMemo:Be,useReducer:Be,useRef:Be,useState:Be,useDebugValue:Be,useDeferredValue:Be,useTransition:Be,useMutableSource:Be,useSyncExternalStore:Be,useId:Be,unstable_isNewReconciler:!1},RS={readContext:wt,useCallback:function(t,e){return $t().memoizedState=[t,e===void 0?null:e],t},useContext:wt,useEffect:Lp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ma(4194308,4,Gy.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ma(4194308,4,t,e)},useInsertionEffect:function(t,e){return ma(4,2,t,e)},useMemo:function(t,e){var n=$t();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$t();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=SS.bind(null,_e,t),[r.memoizedState,t]},useRef:function(t){var e=$t();return t={current:t},e.memoizedState=t},useState:Bp,useDebugValue:Lf,useDeferredValue:function(t){return $t().memoizedState=t},useTransition:function(){var t=Bp(!1),e=t[0];return t=wS.bind(null,t[1]),$t().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=_e,i=$t();if(fe){if(n===void 0)throw Error(U(407));n=n()}else{if(n=e(),Me===null)throw Error(U(349));Rr&30||$y(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Lp(Yy.bind(null,r,s,t),[t]),r.flags|=2048,eo(9,Xy.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=$t(),e=Me.identifierPrefix;if(fe){var n=hn,r=un;n=(r&~(1<<32-Nt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Js++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ES++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},bS={readContext:wt,useCallback:t0,useContext:wt,useEffect:Bf,useImperativeHandle:e0,useInsertionEffect:Qy,useLayoutEffect:Jy,useMemo:n0,useReducer:zc,useRef:Zy,useState:function(){return zc(Gs)},useDebugValue:Lf,useDeferredValue:function(t){var e=St();return r0(e,Re.memoizedState,t)},useTransition:function(){var t=zc(Gs)[0],e=St().memoizedState;return[t,e]},useMutableSource:Hy,useSyncExternalStore:Wy,useId:i0,unstable_isNewReconciler:!1},CS={readContext:wt,useCallback:t0,useContext:wt,useEffect:Bf,useImperativeHandle:e0,useInsertionEffect:Qy,useLayoutEffect:Jy,useMemo:n0,useReducer:jc,useRef:Zy,useState:function(){return jc(Gs)},useDebugValue:Lf,useDeferredValue:function(t){var e=St();return Re===null?e.memoizedState=t:r0(e,Re.memoizedState,t)},useTransition:function(){var t=jc(Gs)[0],e=St().memoizedState;return[t,e]},useMutableSource:Hy,useSyncExternalStore:Wy,useId:i0,unstable_isNewReconciler:!1};function Ct(t,e){if(t&&t.defaultProps){e=me({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function eh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:me({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Wl={isMounted:function(t){return(t=t._reactInternals)?Mr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ke(),i=Wn(t),s=dn(r,i);s.payload=e,n!=null&&(s.callback=n),e=jn(t,s,i),e!==null&&(kt(e,t,i,r),ga(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ke(),i=Wn(t),s=dn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=jn(t,s,i),e!==null&&(kt(e,t,i,r),ga(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ke(),r=Wn(t),i=dn(n,r);i.tag=2,e!=null&&(i.callback=e),e=jn(t,i,r),e!==null&&(kt(e,t,r,n),ga(e,t,r))}};function Vp(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Xs(n,r)||!Xs(i,s):!0}function l0(t,e,n){var r=!1,i=qn,s=e.contextType;return typeof s=="object"&&s!==null?s=wt(s):(i=nt(e)?Sr:We.current,r=e.contextTypes,s=(r=r!=null)?Ri(t,i):qn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Wl,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function zp(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Wl.enqueueReplaceState(e,e.state,null)}function th(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Mf(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=wt(s):(s=nt(e)?Sr:We.current,i.context=Ri(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(eh(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Wl.enqueueReplaceState(i,i.state,null),Va(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function xi(t,e){try{var n="",r=e;do n+=tw(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Hc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function nh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var PS=typeof WeakMap=="function"?WeakMap:Map;function c0(t,e,n){n=dn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){$a||($a=!0,fh=r),nh(t,e)},n}function u0(t,e,n){n=dn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){nh(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){nh(t,e),typeof r!="function"&&(Hn===null?Hn=new Set([this]):Hn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function jp(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new PS;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=jS.bind(null,t,e,n),e.then(t,t))}function Hp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Wp(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=dn(-1,1),e.tag=2,jn(n,e,1))),n.lanes|=1),t)}var xS=vn.ReactCurrentOwner,et=!1;function Xe(t,e,n,r){e.child=t===null?Ly(e,null,n,r):Ci(e,t.child,n,r)}function $p(t,e,n,r,i){n=n.render;var s=e.ref;return yi(e,i),r=Df(t,e,n,r,s,i),n=Uf(),t!==null&&!et?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,mn(t,e,i)):(fe&&n&&Af(e),e.flags|=1,Xe(t,e,r,i),e.child)}function Xp(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Yf(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,h0(t,e,s,r,i)):(t=Ea(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Xs,n(o,r)&&t.ref===e.ref)return mn(t,e,i)}return e.flags|=1,t=$n(s,r),t.ref=e.ref,t.return=e,e.child=t}function h0(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Xs(s,r)&&t.ref===e.ref)if(et=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(et=!0);else return e.lanes=t.lanes,mn(t,e,i)}return rh(t,e,n,r,i)}function f0(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ae(oi,st),st|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ae(oi,st),st|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ae(oi,st),st|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ae(oi,st),st|=r;return Xe(t,e,i,n),e.child}function d0(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function rh(t,e,n,r,i){var s=nt(n)?Sr:We.current;return s=Ri(e,s),yi(e,i),n=Df(t,e,n,r,s,i),r=Uf(),t!==null&&!et?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,mn(t,e,i)):(fe&&r&&Af(e),e.flags|=1,Xe(t,e,n,i),e.child)}function Yp(t,e,n,r,i){if(nt(n)){var s=!0;Fa(e)}else s=!1;if(yi(e,i),e.stateNode===null)ya(t,e),l0(e,n,r),th(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=wt(c):(c=nt(n)?Sr:We.current,c=Ri(e,c));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&zp(e,o,r,c),Pn=!1;var f=e.memoizedState;o.state=f,Va(e,r,o,i),l=e.memoizedState,a!==r||f!==l||tt.current||Pn?(typeof u=="function"&&(eh(e,n,u,r),l=e.memoizedState),(a=Pn||Vp(e,n,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,zy(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Ct(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=wt(l):(l=nt(n)?Sr:We.current,l=Ri(e,l));var m=n.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&zp(e,o,r,l),Pn=!1,f=e.memoizedState,o.state=f,Va(e,r,o,i);var E=e.memoizedState;a!==h||f!==E||tt.current||Pn?(typeof m=="function"&&(eh(e,n,m,r),E=e.memoizedState),(c=Pn||Vp(e,n,c,r,f,E,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,E,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,E,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),o.props=r,o.state=E,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return ih(t,e,n,r,s,i)}function ih(t,e,n,r,i,s){d0(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Np(e,n,!1),mn(t,e,s);r=e.stateNode,xS.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Ci(e,t.child,null,s),e.child=Ci(e,null,a,s)):Xe(t,e,a,s),e.memoizedState=r.state,i&&Np(e,n,!0),e.child}function p0(t){var e=t.stateNode;e.pendingContext?Mp(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Mp(t,e.context,!1),Nf(t,e.containerInfo)}function Kp(t,e,n,r,i){return bi(),bf(i),e.flags|=256,Xe(t,e,n,r),e.child}var sh={dehydrated:null,treeContext:null,retryLane:0};function oh(t){return{baseLanes:t,cachePool:null,transitions:null}}function g0(t,e,n){var r=e.pendingProps,i=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ae(pe,i&1),t===null)return Ju(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Yl(o,r,0,null),t=vr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=oh(n),e.memoizedState=sh,t):Vf(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return IS(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=$n(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=$n(a,s):(s=vr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?oh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=sh,r}return s=t.child,t=s.sibling,r=$n(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Vf(t,e){return e=Yl({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Xo(t,e,n,r){return r!==null&&bf(r),Ci(e,t.child,null,n),t=Vf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function IS(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=Hc(Error(U(422))),Xo(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Yl({mode:"visible",children:r.children},i,0,null),s=vr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Ci(e,t.child,null,o),e.child.memoizedState=oh(o),e.memoizedState=sh,s);if(!(e.mode&1))return Xo(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(U(419)),r=Hc(s,r,void 0),Xo(t,e,o,r)}if(a=(o&t.childLanes)!==0,et||a){if(r=Me,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,_n(t,i),kt(r,t,i,-1))}return Xf(),r=Hc(Error(U(421))),Xo(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=HS.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,at=zn(i.nextSibling),ct=e,fe=!0,xt=null,t!==null&&(_t[mt++]=un,_t[mt++]=hn,_t[mt++]=Ar,un=t.id,hn=t.overflow,Ar=e),e=Vf(e,r.children),e.flags|=4096,e)}function qp(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Gu(t.return,e,n)}function Wc(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function _0(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Xe(t,e,r.children,n),r=pe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&qp(t,n,e);else if(t.tag===19)qp(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ae(pe,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&za(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Wc(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&za(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Wc(e,!0,n,null,s);break;case"together":Wc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ya(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function mn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),br|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(U(153));if(e.child!==null){for(t=e.child,n=$n(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$n(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function MS(t,e,n){switch(e.tag){case 3:p0(e),bi();break;case 5:jy(e);break;case 1:nt(e.type)&&Fa(e);break;case 4:Nf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ae(Ba,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ae(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?g0(t,e,n):(ae(pe,pe.current&1),t=mn(t,e,n),t!==null?t.sibling:null);ae(pe,pe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return _0(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ae(pe,pe.current),r)break;return null;case 22:case 23:return e.lanes=0,f0(t,e,n)}return mn(t,e,n)}var m0,ah,y0,v0;m0=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ah=function(){};y0=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,pr(Jt.current);var s=null;switch(n){case"input":i=xu(t,i),r=xu(t,r),s=[];break;case"select":i=me({},i,{value:void 0}),r=me({},r,{value:void 0}),s=[];break;case"textarea":i=Nu(t,i),r=Nu(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ka)}Ou(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ls.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ls.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ce("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};v0=function(t,e,n,r){n!==r&&(e.flags|=4)};function ss(t,e){if(!fe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Le(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function NS(t,e,n){var r=e.pendingProps;switch(Rf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Le(e),null;case 1:return nt(e.type)&&Oa(),Le(e),null;case 3:return r=e.stateNode,Pi(),ue(tt),ue(We),Of(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Wo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xt!==null&&(gh(xt),xt=null))),ah(t,e),Le(e),null;case 5:kf(e);var i=pr(Qs.current);if(n=e.type,t!==null&&e.stateNode!=null)y0(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(U(166));return Le(e),null}if(t=pr(Jt.current),Wo(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Xt]=e,r[qs]=s,t=(e.mode&1)!==0,n){case"dialog":ce("cancel",r),ce("close",r);break;case"iframe":case"object":case"embed":ce("load",r);break;case"video":case"audio":for(i=0;i<ms.length;i++)ce(ms[i],r);break;case"source":ce("error",r);break;case"img":case"image":case"link":ce("error",r),ce("load",r);break;case"details":ce("toggle",r);break;case"input":ip(r,s),ce("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ce("invalid",r);break;case"textarea":op(r,s),ce("invalid",r)}Ou(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Ho(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Ho(r.textContent,a,t),i=["children",""+a]):Ls.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",r)}switch(n){case"input":Fo(r),sp(r,s,!0);break;case"textarea":Fo(r),ap(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ka)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ym(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Xt]=e,t[qs]=r,m0(t,e,!1,!1),e.stateNode=t;e:{switch(o=Fu(n,r),n){case"dialog":ce("cancel",t),ce("close",t),i=r;break;case"iframe":case"object":case"embed":ce("load",t),i=r;break;case"video":case"audio":for(i=0;i<ms.length;i++)ce(ms[i],t);i=r;break;case"source":ce("error",t),i=r;break;case"img":case"image":case"link":ce("error",t),ce("load",t),i=r;break;case"details":ce("toggle",t),i=r;break;case"input":ip(t,r),i=xu(t,r),ce("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=me({},r,{value:void 0}),ce("invalid",t);break;case"textarea":op(t,r),i=Nu(t,r),ce("invalid",t);break;default:i=r}Ou(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Zm(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Km(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Vs(t,l):typeof l=="number"&&Vs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ls.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ce("scroll",t):l!=null&&uf(t,s,l,o))}switch(n){case"input":Fo(t),sp(t,r,!1);break;case"textarea":Fo(t),ap(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Kn(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?pi(t,!!r.multiple,s,!1):r.defaultValue!=null&&pi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=ka)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Le(e),null;case 6:if(t&&e.stateNode!=null)v0(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(U(166));if(n=pr(Qs.current),pr(Jt.current),Wo(e)){if(r=e.stateNode,n=e.memoizedProps,r[Xt]=e,(s=r.nodeValue!==n)&&(t=ct,t!==null))switch(t.tag){case 3:Ho(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ho(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Xt]=e,e.stateNode=r}return Le(e),null;case 13:if(ue(pe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fe&&at!==null&&e.mode&1&&!(e.flags&128))Uy(),bi(),e.flags|=98560,s=!1;else if(s=Wo(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(U(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(U(317));s[Xt]=e}else bi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Le(e),s=!1}else xt!==null&&(gh(xt),xt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?be===0&&(be=3):Xf())),e.updateQueue!==null&&(e.flags|=4),Le(e),null);case 4:return Pi(),ah(t,e),t===null&&Ys(e.stateNode.containerInfo),Le(e),null;case 10:return xf(e.type._context),Le(e),null;case 17:return nt(e.type)&&Oa(),Le(e),null;case 19:if(ue(pe),s=e.memoizedState,s===null)return Le(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)ss(s,!1);else{if(be!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=za(t),o!==null){for(e.flags|=128,ss(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ae(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&Te()>Ii&&(e.flags|=128,r=!0,ss(s,!1),e.lanes=4194304)}else{if(!r)if(t=za(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ss(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!fe)return Le(e),null}else 2*Te()-s.renderingStartTime>Ii&&n!==1073741824&&(e.flags|=128,r=!0,ss(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Te(),e.sibling=null,n=pe.current,ae(pe,r?n&1|2:n&1),e):(Le(e),null);case 22:case 23:return $f(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?st&1073741824&&(Le(e),e.subtreeFlags&6&&(e.flags|=8192)):Le(e),null;case 24:return null;case 25:return null}throw Error(U(156,e.tag))}function kS(t,e){switch(Rf(e),e.tag){case 1:return nt(e.type)&&Oa(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Pi(),ue(tt),ue(We),Of(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return kf(e),null;case 13:if(ue(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(U(340));bi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(pe),null;case 4:return Pi(),null;case 10:return xf(e.type._context),null;case 22:case 23:return $f(),null;case 24:return null;default:return null}}var Yo=!1,je=!1,OS=typeof WeakSet=="function"?WeakSet:Set,W=null;function si(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ve(t,e,r)}else n.current=null}function lh(t,e,n){try{n()}catch(r){ve(t,e,r)}}var Zp=!1;function FS(t,e){if($u=Ia,t=Ay(),Sf(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,f=null;t:for(;;){for(var m;h!==n||i!==0&&h.nodeType!==3||(a=o+i),h!==s||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===t)break t;if(f===n&&++c===i&&(a=o),f===s&&++u===r&&(l=o),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Xu={focusedElem:t,selectionRange:n},Ia=!1,W=e;W!==null;)if(e=W,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,W=t;else for(;W!==null;){e=W;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var w=E.memoizedProps,S=E.memoizedState,_=e.stateNode,d=_.getSnapshotBeforeUpdate(e.elementType===e.type?w:Ct(e.type,w),S);_.__reactInternalSnapshotBeforeUpdate=d}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(U(163))}}catch(A){ve(e,e.return,A)}if(t=e.sibling,t!==null){t.return=e.return,W=t;break}W=e.return}return E=Zp,Zp=!1,E}function Ps(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&lh(e,n,s)}i=i.next}while(i!==r)}}function $l(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ch(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function T0(t){var e=t.alternate;e!==null&&(t.alternate=null,T0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Xt],delete e[qs],delete e[qu],delete e[mS],delete e[yS])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function E0(t){return t.tag===5||t.tag===3||t.tag===4}function Qp(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||E0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function uh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ka));else if(r!==4&&(t=t.child,t!==null))for(uh(t,e,n),t=t.sibling;t!==null;)uh(t,e,n),t=t.sibling}function hh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(hh(t,e,n),t=t.sibling;t!==null;)hh(t,e,n),t=t.sibling}var Oe=null,Pt=!1;function wn(t,e,n){for(n=n.child;n!==null;)w0(t,e,n),n=n.sibling}function w0(t,e,n){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(Ul,n)}catch{}switch(n.tag){case 5:je||si(n,e);case 6:var r=Oe,i=Pt;Oe=null,wn(t,e,n),Oe=r,Pt=i,Oe!==null&&(Pt?(t=Oe,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Oe.removeChild(n.stateNode));break;case 18:Oe!==null&&(Pt?(t=Oe,n=n.stateNode,t.nodeType===8?Uc(t.parentNode,n):t.nodeType===1&&Uc(t,n),Ws(t)):Uc(Oe,n.stateNode));break;case 4:r=Oe,i=Pt,Oe=n.stateNode.containerInfo,Pt=!0,wn(t,e,n),Oe=r,Pt=i;break;case 0:case 11:case 14:case 15:if(!je&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&lh(n,e,o),i=i.next}while(i!==r)}wn(t,e,n);break;case 1:if(!je&&(si(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){ve(n,e,a)}wn(t,e,n);break;case 21:wn(t,e,n);break;case 22:n.mode&1?(je=(r=je)||n.memoizedState!==null,wn(t,e,n),je=r):wn(t,e,n);break;default:wn(t,e,n)}}function Jp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new OS),e.forEach(function(r){var i=WS.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function bt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Oe=a.stateNode,Pt=!1;break e;case 3:Oe=a.stateNode.containerInfo,Pt=!0;break e;case 4:Oe=a.stateNode.containerInfo,Pt=!0;break e}a=a.return}if(Oe===null)throw Error(U(160));w0(s,o,i),Oe=null,Pt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){ve(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)S0(e,t),e=e.sibling}function S0(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(bt(e,t),Lt(t),r&4){try{Ps(3,t,t.return),$l(3,t)}catch(w){ve(t,t.return,w)}try{Ps(5,t,t.return)}catch(w){ve(t,t.return,w)}}break;case 1:bt(e,t),Lt(t),r&512&&n!==null&&si(n,n.return);break;case 5:if(bt(e,t),Lt(t),r&512&&n!==null&&si(n,n.return),t.flags&32){var i=t.stateNode;try{Vs(i,"")}catch(w){ve(t,t.return,w)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&$m(i,s),Fu(a,o);var c=Fu(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?Zm(i,h):u==="dangerouslySetInnerHTML"?Km(i,h):u==="children"?Vs(i,h):uf(i,u,h,c)}switch(a){case"input":Iu(i,s);break;case"textarea":Xm(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?pi(i,!!s.multiple,m,!1):f!==!!s.multiple&&(s.defaultValue!=null?pi(i,!!s.multiple,s.defaultValue,!0):pi(i,!!s.multiple,s.multiple?[]:"",!1))}i[qs]=s}catch(w){ve(t,t.return,w)}}break;case 6:if(bt(e,t),Lt(t),r&4){if(t.stateNode===null)throw Error(U(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(w){ve(t,t.return,w)}}break;case 3:if(bt(e,t),Lt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ws(e.containerInfo)}catch(w){ve(t,t.return,w)}break;case 4:bt(e,t),Lt(t);break;case 13:bt(e,t),Lt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Hf=Te())),r&4&&Jp(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(je=(c=je)||u,bt(e,t),je=c):bt(e,t),Lt(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(W=t,u=t.child;u!==null;){for(h=W=u;W!==null;){switch(f=W,m=f.child,f.tag){case 0:case 11:case 14:case 15:Ps(4,f,f.return);break;case 1:si(f,f.return);var E=f.stateNode;if(typeof E.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(w){ve(r,n,w)}}break;case 5:si(f,f.return);break;case 22:if(f.memoizedState!==null){eg(h);continue}}m!==null?(m.return=f,W=m):eg(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=qm("display",o))}catch(w){ve(t,t.return,w)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(w){ve(t,t.return,w)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:bt(e,t),Lt(t),r&4&&Jp(t);break;case 21:break;default:bt(e,t),Lt(t)}}function Lt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(E0(n)){var r=n;break e}n=n.return}throw Error(U(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Vs(i,""),r.flags&=-33);var s=Qp(t);hh(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Qp(t);uh(t,a,o);break;default:throw Error(U(161))}}catch(l){ve(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function DS(t,e,n){W=t,A0(t)}function A0(t,e,n){for(var r=(t.mode&1)!==0;W!==null;){var i=W,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Yo;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||je;a=Yo;var c=je;if(Yo=o,(je=l)&&!c)for(W=i;W!==null;)o=W,l=o.child,o.tag===22&&o.memoizedState!==null?tg(i):l!==null?(l.return=o,W=l):tg(i);for(;s!==null;)W=s,A0(s),s=s.sibling;W=i,Yo=a,je=c}Gp(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,W=s):Gp(t)}}function Gp(t){for(;W!==null;){var e=W;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:je||$l(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!je)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Ct(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Up(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Up(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Ws(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(U(163))}je||e.flags&512&&ch(e)}catch(f){ve(e,e.return,f)}}if(e===t){W=null;break}if(n=e.sibling,n!==null){n.return=e.return,W=n;break}W=e.return}}function eg(t){for(;W!==null;){var e=W;if(e===t){W=null;break}var n=e.sibling;if(n!==null){n.return=e.return,W=n;break}W=e.return}}function tg(t){for(;W!==null;){var e=W;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{$l(4,e)}catch(l){ve(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){ve(e,i,l)}}var s=e.return;try{ch(e)}catch(l){ve(e,s,l)}break;case 5:var o=e.return;try{ch(e)}catch(l){ve(e,o,l)}}}catch(l){ve(e,e.return,l)}if(e===t){W=null;break}var a=e.sibling;if(a!==null){a.return=e.return,W=a;break}W=e.return}}var US=Math.ceil,Wa=vn.ReactCurrentDispatcher,zf=vn.ReactCurrentOwner,Tt=vn.ReactCurrentBatchConfig,ee=0,Me=null,Ae=null,Fe=0,st=0,oi=Gn(0),be=0,to=null,br=0,Xl=0,jf=0,xs=null,Ge=null,Hf=0,Ii=1/0,on=null,$a=!1,fh=null,Hn=null,Ko=!1,On=null,Xa=0,Is=0,dh=null,va=-1,Ta=0;function Ke(){return ee&6?Te():va!==-1?va:va=Te()}function Wn(t){return t.mode&1?ee&2&&Fe!==0?Fe&-Fe:TS.transition!==null?(Ta===0&&(Ta=ly()),Ta):(t=re,t!==0||(t=window.event,t=t===void 0?16:gy(t.type)),t):1}function kt(t,e,n,r){if(50<Is)throw Is=0,dh=null,Error(U(185));ho(t,n,r),(!(ee&2)||t!==Me)&&(t===Me&&(!(ee&2)&&(Xl|=n),be===4&&Nn(t,Fe)),rt(t,r),n===1&&ee===0&&!(e.mode&1)&&(Ii=Te()+500,jl&&er()))}function rt(t,e){var n=t.callbackNode;Tw(t,e);var r=xa(t,t===Me?Fe:0);if(r===0)n!==null&&up(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&up(n),e===1)t.tag===0?vS(ng.bind(null,t)):Oy(ng.bind(null,t)),gS(function(){!(ee&6)&&er()}),n=null;else{switch(cy(r)){case 1:n=gf;break;case 4:n=oy;break;case 16:n=Pa;break;case 536870912:n=ay;break;default:n=Pa}n=N0(n,R0.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function R0(t,e){if(va=-1,Ta=0,ee&6)throw Error(U(327));var n=t.callbackNode;if(vi()&&t.callbackNode!==n)return null;var r=xa(t,t===Me?Fe:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Ya(t,r);else{e=r;var i=ee;ee|=2;var s=C0();(Me!==t||Fe!==e)&&(on=null,Ii=Te()+500,yr(t,e));do try{VS();break}catch(a){b0(t,a)}while(1);Pf(),Wa.current=s,ee=i,Ae!==null?e=0:(Me=null,Fe=0,e=be)}if(e!==0){if(e===2&&(i=Vu(t),i!==0&&(r=i,e=ph(t,i))),e===1)throw n=to,yr(t,0),Nn(t,r),rt(t,Te()),n;if(e===6)Nn(t,r);else{if(i=t.current.alternate,!(r&30)&&!BS(i)&&(e=Ya(t,r),e===2&&(s=Vu(t),s!==0&&(r=s,e=ph(t,s))),e===1))throw n=to,yr(t,0),Nn(t,r),rt(t,Te()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(U(345));case 2:ar(t,Ge,on);break;case 3:if(Nn(t,r),(r&130023424)===r&&(e=Hf+500-Te(),10<e)){if(xa(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Ke(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Ku(ar.bind(null,t,Ge,on),e);break}ar(t,Ge,on);break;case 4:if(Nn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Nt(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Te()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*US(r/1960))-r,10<r){t.timeoutHandle=Ku(ar.bind(null,t,Ge,on),r);break}ar(t,Ge,on);break;case 5:ar(t,Ge,on);break;default:throw Error(U(329))}}}return rt(t,Te()),t.callbackNode===n?R0.bind(null,t):null}function ph(t,e){var n=xs;return t.current.memoizedState.isDehydrated&&(yr(t,e).flags|=256),t=Ya(t,e),t!==2&&(e=Ge,Ge=n,e!==null&&gh(e)),t}function gh(t){Ge===null?Ge=t:Ge.push.apply(Ge,t)}function BS(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Ot(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Nn(t,e){for(e&=~jf,e&=~Xl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Nt(e),r=1<<n;t[n]=-1,e&=~r}}function ng(t){if(ee&6)throw Error(U(327));vi();var e=xa(t,0);if(!(e&1))return rt(t,Te()),null;var n=Ya(t,e);if(t.tag!==0&&n===2){var r=Vu(t);r!==0&&(e=r,n=ph(t,r))}if(n===1)throw n=to,yr(t,0),Nn(t,e),rt(t,Te()),n;if(n===6)throw Error(U(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ar(t,Ge,on),rt(t,Te()),null}function Wf(t,e){var n=ee;ee|=1;try{return t(e)}finally{ee=n,ee===0&&(Ii=Te()+500,jl&&er())}}function Cr(t){On!==null&&On.tag===0&&!(ee&6)&&vi();var e=ee;ee|=1;var n=Tt.transition,r=re;try{if(Tt.transition=null,re=1,t)return t()}finally{re=r,Tt.transition=n,ee=e,!(ee&6)&&er()}}function $f(){st=oi.current,ue(oi)}function yr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,pS(n)),Ae!==null)for(n=Ae.return;n!==null;){var r=n;switch(Rf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Oa();break;case 3:Pi(),ue(tt),ue(We),Of();break;case 5:kf(r);break;case 4:Pi();break;case 13:ue(pe);break;case 19:ue(pe);break;case 10:xf(r.type._context);break;case 22:case 23:$f()}n=n.return}if(Me=t,Ae=t=$n(t.current,null),Fe=st=e,be=0,to=null,jf=Xl=br=0,Ge=xs=null,dr!==null){for(e=0;e<dr.length;e++)if(n=dr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}dr=null}return t}function b0(t,e){do{var n=Ae;try{if(Pf(),_a.current=Ha,ja){for(var r=_e.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}ja=!1}if(Rr=0,Ie=Re=_e=null,Cs=!1,Js=0,zf.current=null,n===null||n.return===null){be=1,to=e,Ae=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Fe,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=Hp(o);if(m!==null){m.flags&=-257,Wp(m,o,a,s,e),m.mode&1&&jp(s,c,e),e=m,l=c;var E=e.updateQueue;if(E===null){var w=new Set;w.add(l),e.updateQueue=w}else E.add(l);break e}else{if(!(e&1)){jp(s,c,e),Xf();break e}l=Error(U(426))}}else if(fe&&a.mode&1){var S=Hp(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),Wp(S,o,a,s,e),bf(xi(l,a));break e}}s=l=xi(l,a),be!==4&&(be=2),xs===null?xs=[s]:xs.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var _=c0(s,l,e);Dp(s,_);break e;case 1:a=l;var d=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof d.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Hn===null||!Hn.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var A=u0(s,a,e);Dp(s,A);break e}}s=s.return}while(s!==null)}x0(n)}catch(b){e=b,Ae===n&&n!==null&&(Ae=n=n.return);continue}break}while(1)}function C0(){var t=Wa.current;return Wa.current=Ha,t===null?Ha:t}function Xf(){(be===0||be===3||be===2)&&(be=4),Me===null||!(br&268435455)&&!(Xl&268435455)||Nn(Me,Fe)}function Ya(t,e){var n=ee;ee|=2;var r=C0();(Me!==t||Fe!==e)&&(on=null,yr(t,e));do try{LS();break}catch(i){b0(t,i)}while(1);if(Pf(),ee=n,Wa.current=r,Ae!==null)throw Error(U(261));return Me=null,Fe=0,be}function LS(){for(;Ae!==null;)P0(Ae)}function VS(){for(;Ae!==null&&!hw();)P0(Ae)}function P0(t){var e=M0(t.alternate,t,st);t.memoizedProps=t.pendingProps,e===null?x0(t):Ae=e,zf.current=null}function x0(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=kS(n,e),n!==null){n.flags&=32767,Ae=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{be=6,Ae=null;return}}else if(n=NS(n,e,st),n!==null){Ae=n;return}if(e=e.sibling,e!==null){Ae=e;return}Ae=e=t}while(e!==null);be===0&&(be=5)}function ar(t,e,n){var r=re,i=Tt.transition;try{Tt.transition=null,re=1,zS(t,e,n,r)}finally{Tt.transition=i,re=r}return null}function zS(t,e,n,r){do vi();while(On!==null);if(ee&6)throw Error(U(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(U(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Ew(t,s),t===Me&&(Ae=Me=null,Fe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ko||(Ko=!0,N0(Pa,function(){return vi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Tt.transition,Tt.transition=null;var o=re;re=1;var a=ee;ee|=4,zf.current=null,FS(t,n),S0(n,t),aS(Xu),Ia=!!$u,Xu=$u=null,t.current=n,DS(n),fw(),ee=a,re=o,Tt.transition=s}else t.current=n;if(Ko&&(Ko=!1,On=t,Xa=i),s=t.pendingLanes,s===0&&(Hn=null),gw(n.stateNode),rt(t,Te()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if($a)throw $a=!1,t=fh,fh=null,t;return Xa&1&&t.tag!==0&&vi(),s=t.pendingLanes,s&1?t===dh?Is++:(Is=0,dh=t):Is=0,er(),null}function vi(){if(On!==null){var t=cy(Xa),e=Tt.transition,n=re;try{if(Tt.transition=null,re=16>t?16:t,On===null)var r=!1;else{if(t=On,On=null,Xa=0,ee&6)throw Error(U(331));var i=ee;for(ee|=4,W=t.current;W!==null;){var s=W,o=s.child;if(W.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(W=c;W!==null;){var u=W;switch(u.tag){case 0:case 11:case 15:Ps(8,u,s)}var h=u.child;if(h!==null)h.return=u,W=h;else for(;W!==null;){u=W;var f=u.sibling,m=u.return;if(T0(u),u===c){W=null;break}if(f!==null){f.return=m,W=f;break}W=m}}}var E=s.alternate;if(E!==null){var w=E.child;if(w!==null){E.child=null;do{var S=w.sibling;w.sibling=null,w=S}while(w!==null)}}W=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,W=o;else e:for(;W!==null;){if(s=W,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ps(9,s,s.return)}var _=s.sibling;if(_!==null){_.return=s.return,W=_;break e}W=s.return}}var d=t.current;for(W=d;W!==null;){o=W;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,W=y;else e:for(o=d;W!==null;){if(a=W,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:$l(9,a)}}catch(b){ve(a,a.return,b)}if(a===o){W=null;break e}var A=a.sibling;if(A!==null){A.return=a.return,W=A;break e}W=a.return}}if(ee=i,er(),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(Ul,t)}catch{}r=!0}return r}finally{re=n,Tt.transition=e}}return!1}function rg(t,e,n){e=xi(n,e),e=c0(t,e,1),t=jn(t,e,1),e=Ke(),t!==null&&(ho(t,1,e),rt(t,e))}function ve(t,e,n){if(t.tag===3)rg(t,t,n);else for(;e!==null;){if(e.tag===3){rg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Hn===null||!Hn.has(r))){t=xi(n,t),t=u0(e,t,1),e=jn(e,t,1),t=Ke(),e!==null&&(ho(e,1,t),rt(e,t));break}}e=e.return}}function jS(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ke(),t.pingedLanes|=t.suspendedLanes&n,Me===t&&(Fe&n)===n&&(be===4||be===3&&(Fe&130023424)===Fe&&500>Te()-Hf?yr(t,0):jf|=n),rt(t,e)}function I0(t,e){e===0&&(t.mode&1?(e=Bo,Bo<<=1,!(Bo&130023424)&&(Bo=4194304)):e=1);var n=Ke();t=_n(t,e),t!==null&&(ho(t,e,n),rt(t,n))}function HS(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),I0(t,n)}function WS(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(U(314))}r!==null&&r.delete(e),I0(t,n)}var M0;M0=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||tt.current)et=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return et=!1,MS(t,e,n);et=!!(t.flags&131072)}else et=!1,fe&&e.flags&1048576&&Fy(e,Ua,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ya(t,e),t=e.pendingProps;var i=Ri(e,We.current);yi(e,n),i=Df(null,e,r,t,i,n);var s=Uf();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,nt(r)?(s=!0,Fa(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Mf(e),i.updater=Wl,e.stateNode=i,i._reactInternals=e,th(e,r,t,n),e=ih(null,e,r,!0,s,n)):(e.tag=0,fe&&s&&Af(e),Xe(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ya(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=XS(r),t=Ct(r,t),i){case 0:e=rh(null,e,r,t,n);break e;case 1:e=Yp(null,e,r,t,n);break e;case 11:e=$p(null,e,r,t,n);break e;case 14:e=Xp(null,e,r,Ct(r.type,t),n);break e}throw Error(U(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),rh(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),Yp(t,e,r,i,n);case 3:e:{if(p0(e),t===null)throw Error(U(387));r=e.pendingProps,s=e.memoizedState,i=s.element,zy(t,e),Va(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=xi(Error(U(423)),e),e=Kp(t,e,r,n,i);break e}else if(r!==i){i=xi(Error(U(424)),e),e=Kp(t,e,r,n,i);break e}else for(at=zn(e.stateNode.containerInfo.firstChild),ct=e,fe=!0,xt=null,n=Ly(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(bi(),r===i){e=mn(t,e,n);break e}Xe(t,e,r,n)}e=e.child}return e;case 5:return jy(e),t===null&&Ju(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Yu(r,i)?o=null:s!==null&&Yu(r,s)&&(e.flags|=32),d0(t,e),Xe(t,e,o,n),e.child;case 6:return t===null&&Ju(e),null;case 13:return g0(t,e,n);case 4:return Nf(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ci(e,null,r,n):Xe(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),$p(t,e,r,i,n);case 7:return Xe(t,e,e.pendingProps,n),e.child;case 8:return Xe(t,e,e.pendingProps.children,n),e.child;case 12:return Xe(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ae(Ba,r._currentValue),r._currentValue=o,s!==null)if(Ot(s.value,o)){if(s.children===i.children&&!tt.current){e=mn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=dn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Gu(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(U(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Gu(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Xe(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,yi(e,n),i=wt(i),r=r(i),e.flags|=1,Xe(t,e,r,n),e.child;case 14:return r=e.type,i=Ct(r,e.pendingProps),i=Ct(r.type,i),Xp(t,e,r,i,n);case 15:return h0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),ya(t,e),e.tag=1,nt(r)?(t=!0,Fa(e)):t=!1,yi(e,n),l0(e,r,i),th(e,r,i,n),ih(null,e,r,!0,t,n);case 19:return _0(t,e,n);case 22:return f0(t,e,n)}throw Error(U(156,e.tag))};function N0(t,e){return sy(t,e)}function $S(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yt(t,e,n,r){return new $S(t,e,n,r)}function Yf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function XS(t){if(typeof t=="function")return Yf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ff)return 11;if(t===df)return 14}return 2}function $n(t,e){var n=t.alternate;return n===null?(n=yt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ea(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")Yf(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Zr:return vr(n.children,i,s,e);case hf:o=8,i|=8;break;case Ru:return t=yt(12,n,e,i|2),t.elementType=Ru,t.lanes=s,t;case bu:return t=yt(13,n,e,i),t.elementType=bu,t.lanes=s,t;case Cu:return t=yt(19,n,e,i),t.elementType=Cu,t.lanes=s,t;case jm:return Yl(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Vm:o=10;break e;case zm:o=9;break e;case ff:o=11;break e;case df:o=14;break e;case Cn:o=16,r=null;break e}throw Error(U(130,t==null?t:typeof t,""))}return e=yt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function vr(t,e,n,r){return t=yt(7,t,r,e),t.lanes=n,t}function Yl(t,e,n,r){return t=yt(22,t,r,e),t.elementType=jm,t.lanes=n,t.stateNode={isHidden:!1},t}function $c(t,e,n){return t=yt(6,t,null,e),t.lanes=n,t}function Xc(t,e,n){return e=yt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function YS(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bc(0),this.expirationTimes=bc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bc(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Kf(t,e,n,r,i,s,o,a,l){return t=new YS(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=yt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mf(s),t}function KS(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:qr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function k0(t){if(!t)return qn;t=t._reactInternals;e:{if(Mr(t)!==t||t.tag!==1)throw Error(U(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(nt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(U(171))}if(t.tag===1){var n=t.type;if(nt(n))return ky(t,n,e)}return e}function O0(t,e,n,r,i,s,o,a,l){return t=Kf(n,r,!0,t,i,s,o,a,l),t.context=k0(null),n=t.current,r=Ke(),i=Wn(n),s=dn(r,i),s.callback=e??null,jn(n,s,i),t.current.lanes=i,ho(t,i,r),rt(t,r),t}function Kl(t,e,n,r){var i=e.current,s=Ke(),o=Wn(i);return n=k0(n),e.context===null?e.context=n:e.pendingContext=n,e=dn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=jn(i,e,o),t!==null&&(kt(t,i,o,s),ga(t,i,o)),o}function Ka(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ig(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function qf(t,e){ig(t,e),(t=t.alternate)&&ig(t,e)}function qS(){return null}var F0=typeof reportError=="function"?reportError:function(t){console.error(t)};function Zf(t){this._internalRoot=t}ql.prototype.render=Zf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(U(409));Kl(t,e,null,null)};ql.prototype.unmount=Zf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Cr(function(){Kl(null,t,null,null)}),e[gn]=null}};function ql(t){this._internalRoot=t}ql.prototype.unstable_scheduleHydration=function(t){if(t){var e=fy();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Mn.length&&e!==0&&e<Mn[n].priority;n++);Mn.splice(n,0,t),n===0&&py(t)}};function Qf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Zl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function sg(){}function ZS(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=Ka(o);s.call(c)}}var o=O0(e,r,t,0,null,!1,!1,"",sg);return t._reactRootContainer=o,t[gn]=o.current,Ys(t.nodeType===8?t.parentNode:t),Cr(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Ka(l);a.call(c)}}var l=Kf(t,0,!1,null,null,!1,!1,"",sg);return t._reactRootContainer=l,t[gn]=l.current,Ys(t.nodeType===8?t.parentNode:t),Cr(function(){Kl(e,l,n,r)}),l}function Ql(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=Ka(o);a.call(l)}}Kl(e,o,t,i)}else o=ZS(n,e,t,i,r);return Ka(o)}uy=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=_s(e.pendingLanes);n!==0&&(_f(e,n|1),rt(e,Te()),!(ee&6)&&(Ii=Te()+500,er()))}break;case 13:Cr(function(){var r=_n(t,1);if(r!==null){var i=Ke();kt(r,t,1,i)}}),qf(t,1)}};mf=function(t){if(t.tag===13){var e=_n(t,134217728);if(e!==null){var n=Ke();kt(e,t,134217728,n)}qf(t,134217728)}};hy=function(t){if(t.tag===13){var e=Wn(t),n=_n(t,e);if(n!==null){var r=Ke();kt(n,t,e,r)}qf(t,e)}};fy=function(){return re};dy=function(t,e){var n=re;try{return re=t,e()}finally{re=n}};Uu=function(t,e,n){switch(e){case"input":if(Iu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=zl(r);if(!i)throw Error(U(90));Wm(r),Iu(r,i)}}}break;case"textarea":Xm(t,n);break;case"select":e=n.value,e!=null&&pi(t,!!n.multiple,e,!1)}};Gm=Wf;ey=Cr;var QS={usingClientEntryPoint:!1,Events:[po,ei,zl,Qm,Jm,Wf]},os={findFiberByHostInstance:fr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},JS={bundleType:os.bundleType,version:os.version,rendererPackageName:os.rendererPackageName,rendererConfig:os.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ry(t),t===null?null:t.stateNode},findFiberByHostInstance:os.findFiberByHostInstance||qS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qo.isDisabled&&qo.supportsFiber)try{Ul=qo.inject(JS),Qt=qo}catch{}}ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QS;ht.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Qf(e))throw Error(U(200));return KS(t,e,null,n)};ht.createRoot=function(t,e){if(!Qf(t))throw Error(U(299));var n=!1,r="",i=F0;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Kf(t,1,!1,null,null,n,!1,r,i),t[gn]=e.current,Ys(t.nodeType===8?t.parentNode:t),new Zf(e)};ht.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(U(188)):(t=Object.keys(t).join(","),Error(U(268,t)));return t=ry(e),t=t===null?null:t.stateNode,t};ht.flushSync=function(t){return Cr(t)};ht.hydrate=function(t,e,n){if(!Zl(e))throw Error(U(200));return Ql(null,t,e,!0,n)};ht.hydrateRoot=function(t,e,n){if(!Qf(t))throw Error(U(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=F0;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=O0(e,null,t,1,n??null,i,!1,s,o),t[gn]=e.current,Ys(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new ql(e)};ht.render=function(t,e,n){if(!Zl(e))throw Error(U(200));return Ql(null,t,e,!1,n)};ht.unmountComponentAtNode=function(t){if(!Zl(t))throw Error(U(40));return t._reactRootContainer?(Cr(function(){Ql(null,null,t,!1,function(){t._reactRootContainer=null,t[gn]=null})}),!0):!1};ht.unstable_batchedUpdates=Wf;ht.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Zl(n))throw Error(U(200));if(t==null||t._reactInternals===void 0)throw Error(U(38));return Ql(t,e,n,!1,r)};ht.version="18.3.1-next-f1338f8080-20240426";function D0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(D0)}catch(t){console.error(t)}}D0(),Dm.exports=ht;var Jf=Dm.exports,U0,og=Jf;U0=og.createRoot,og.hydrateRoot;const GS="modulepreload",e1=function(t){return"/"+t},ag={},t1=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=e1(s),s in ag)return;ag[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const h=i[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":GS,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},n1=L.createContext(null);function r1(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function cn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!cn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!cn(t[i],e[i]))return!1;return!0}return!1}function i1(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function lg(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();cn(n,r)||e.setProjection(n)}function cg(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function ug(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const s1=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hg(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of s1)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}const fg={version:8,sources:{},layers:[]},dg={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Yc={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},pg={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},o1=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],a1=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Mi{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[pg[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[dg[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Yc[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Mi.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=fg}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||l1()||null,container:e,style:hg(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),lg(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in dg)o.on(u,this._onPointerEvent);for(const u in Yc)o.on(u,this._onCameraEvent);for(const u in pg)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Mi.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=i1(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,l=r.isMoving();l&&(i.cameraElevationReference="sea");const c=ug(i,{...cg(r.transform),...e});if(l&&(i.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==i.zoom),u.rotate||(u.rotate=a!==i.bearing),u.pitch||(u.pitch=o!==i.pitch)}return l||ug(r.transform,e),c}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of o1)if(s in e&&!cn(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=fg,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(hg(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!cn(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!cn(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!cn(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of a1){const l=(r=e[a])!==null&&r!==void 0?r:!0,c=(i=n[a])!==null&&i!==void 0?i:!0;cn(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Yc&&(typeof n=="object"&&(n.viewState=cg(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{lg(this._renderTransform,n),e.transform=n}}}Mi.savedMaps=[];function l1(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const c1=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function u1(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of h1(e))!(r in n)&&!c1.includes(r)&&(n[r]=e[r].bind(e));return n}function h1(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const f1=typeof document<"u"?L.useLayoutEffect:L.useEffect,d1=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function p1(t,e){for(const r of d1)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const Jl=L.createContext(null);function g1(t,e,n){const r=L.useContext(n1),[i,s]=L.useState(null),o=L.useRef(),{current:a}=L.useRef({mapLib:null,map:null});L.useEffect(()=>{const u=t.mapLib;let h=!0,f;return Promise.resolve(u||n).then(m=>{if(!h)return;if(!m)throw new Error("Invalid mapLib");const E="Map"in m?m:m.default;if(!E.Map)throw new Error("Invalid mapLib");if(p1(E,t),!E.supported||E.supported(t))t.reuseMaps&&(f=Mi.reuse(t,o.current)),f||(f=new Mi(E.Map,t,o.current)),a.map=u1(f),a.mapLib=E,s(f),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(m=>{const{onError:E}=t;E?E({type:"error",target:null,originalEvent:null,error:m}):console.error(m)}),()=>{h=!1,f&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),f1(()=>{i&&i.setProps(t)}),L.useImperativeHandle(e,()=>a.map,[i]);const l=L.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return L.createElement("div",{id:t.id,ref:o,style:l},i&&L.createElement(Jl.Provider,{value:a},L.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const _1=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Nr(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!_1.test(r)?n[r]=`${i}px`:n[r]=i}}function m1(t,e){const{map:n,mapLib:r}=L.useContext(Jl),i=L.useRef({props:t});i.current.props=t;const s=L.useMemo(()=>{let w=!1;L.Children.forEach(t.children,d=>{d&&(w=!0)});const S={...t,element:w?document.createElement("div"):null},_=new r.Marker(S);return _.setLngLat([t.longitude,t.latitude]),_.getElement().addEventListener("click",d=>{var y,A;(A=(y=i.current.props).onClick)===null||A===void 0||A.call(y,{type:"click",target:_,originalEvent:d})}),_.on("dragstart",d=>{var y,A;const b=d;b.lngLat=s.getLngLat(),(A=(y=i.current.props).onDragStart)===null||A===void 0||A.call(y,b)}),_.on("drag",d=>{var y,A;const b=d;b.lngLat=s.getLngLat(),(A=(y=i.current.props).onDrag)===null||A===void 0||A.call(y,b)}),_.on("dragend",d=>{var y,A;const b=d;b.lngLat=s.getLngLat(),(A=(y=i.current.props).onDragEnd)===null||A===void 0||A.call(y,b)}),_},[]);L.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:h=null,rotation:f=0,rotationAlignment:m="auto",pitchAlignment:E="auto"}=t;return L.useEffect(()=>{Nr(s.getElement(),c)},[c]),L.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!r1(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==f&&s.setRotation(f),s.getRotationAlignment()!==m&&s.setRotationAlignment(m),s.getPitchAlignment()!==E&&s.setPitchAlignment(E),s.getPopup()!==h&&s.setPopup(h),Jf.createPortal(t.children,s.getElement())}L.memo(L.forwardRef(m1));function gg(t){return new Set(t?t.trim().split(/\s+/):[])}function y1(t,e){const{map:n,mapLib:r}=L.useContext(Jl),i=L.useMemo(()=>document.createElement("div"),[]),s=L.useRef({props:t});s.current.props=t;const o=L.useMemo(()=>{const a={...t},l=new r.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,h;(h=(u=s.current.props).onOpen)===null||h===void 0||h.call(u,c)}),l},[]);if(L.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),L.useEffect(()=>{Nr(o.getElement(),t.style)},[t.style]),L.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!cn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=gg(o.options.className),l=gg(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return Jf.createPortal(t.children,i)}L.memo(L.forwardRef(y1));function _o(t,e,n,r){const i=L.useContext(Jl),s=L.useMemo(()=>t(i),[]);return L.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=i;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{l&&l(i),c.hasControl(s)&&c.removeControl(s)}},[]),s}function v1(t){const e=_o(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return L.useEffect(()=>{Nr(e._container,t.style)},[t.style]),null}L.memo(v1);function T1(t){const e=_o(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return L.useEffect(()=>{Nr(e._controlContainer,t.style)},[t.style]),null}L.memo(T1);function E1(t,e){const n=L.useRef({props:t}),r=_o(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,L.useImperativeHandle(e,()=>r,[]),L.useEffect(()=>{Nr(r._container,t.style)},[t.style]),null}L.memo(L.forwardRef(E1));function w1(t){const e=_o(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return L.useEffect(()=>{Nr(e._container,t.style)},[t.style]),null}L.memo(w1);function S1(t){const e=_o(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=L.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),L.useEffect(()=>{Nr(e._container,i)},[i]),null}L.memo(S1);const A1=t1(()=>import("./maplibre-gl-eb5136c0.js").then(t=>t.m),[]),R1=(()=>L.forwardRef(function(e,n){return g1(e,n,A1)}))();function qa(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Gf=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),_g=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_g&&parseFloat(_g[1]);const Zo=globalThis,Lr=globalThis.process||{},b1=globalThis.navigator||{};function B0(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function tr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||B0()}function C1(t){return!t&&!tr()?"Node":B0(t)?"Electron":(t||b1.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const L0="4.0.7";function P1(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class x1{constructor(e,n,r="sessionStorage"){this.storage=P1(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function I1(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function M1(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Za;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Za||(Za={}));const N1=10;function mg(t){return typeof t!="string"?t:(t=t.toUpperCase(),Za[t]||Za.WHITE)}function k1(t,e,n){return!tr&&typeof t=="string"&&(e&&(t=`\x1B[${mg(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${mg(n)+N1}m${t}\x1B[49m`)),t}function O1(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function ed(t,e){if(!t)throw new Error(e||"Assertion failed")}function Vr(){var e,n,r;let t;if(tr()&&Zo.performance)t=(n=(e=Zo==null?void 0:Zo.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Lr){const i=(r=Lr==null?void 0:Lr.hrtime)==null?void 0:r.call(Lr);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const zr={debug:tr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},F1={enabled:!0,level:0};function jr(){}const yg={},vg={once:!0};class mo{constructor({id:e}={id:""}){this.VERSION=L0,this._startTs=Vr(),this._deltaTs=Vr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new x1(`__probe-${this.id}__`,F1),this.timeStamp(`${this.id} started`),O1(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Vr()-this._startTs).toPrecision(10))}getDelta(){return Number((Vr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,zr.warn,arguments,vg)}error(e){return this._getLogFunction(0,e,zr.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,zr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,zr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,zr.debug||zr.info,arguments,vg)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||jr,r&&[r],{tag:U1(n)}):jr}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||jr)}group(e,n,r={collapsed:!1}){const i=Tg({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||jr)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=V0(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=Tg({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,ed(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Vr();const o=s.tag||s.message;if(s.once&&o)if(!yg[o])yg[o]=Vr();else return jr;return n=D1(this.id,s.message,s),r.bind(console,n,...s.args)}return jr}}mo.VERSION=L0;function V0(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return ed(Number.isFinite(e)&&e>=0),e}function Tg(t){const{logLevel:e,message:n}=t;t.logLevel=V0(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return ed(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function D1(t,e,n){if(typeof e=="string"){const r=n.time?M1(I1(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=k1(e,n.color,n.background)}return e}function U1(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}function B1(t,e){return z0(t||{},e)}function z0(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=z0(r[i]||{},e[i],n+1):r[i]=e[i];return r}const L1="latest";function V1(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const z1=V1();function Zn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Tr=typeof process!="object"||String(process)!=="[object process]"||process.browser,j1=typeof window<"u"&&typeof window.orientation<"u",Eg=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Eg&&parseFloat(Eg[1]);class H1{constructor(e,n){p(this,"name");p(this,"workerThread");p(this,"isRunning",!0);p(this,"result");p(this,"_resolve",()=>{});p(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Zn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Zn(this.isRunning),this.isRunning=!1,this._reject(e)}}class Kc{terminate(){}}const qc=new Map;function W1(t){Zn(t.source&&!t.url||!t.source&&t.url);let e=qc.get(t.source||t.url);return e||(t.url&&(e=$1(t.url),qc.set(t.url,e)),t.source&&(e=j0(t.source),qc.set(t.source,e))),Zn(e),e}function $1(t){if(!t.startsWith("http"))return t;const e=X1(t);return j0(e)}function j0(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function X1(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function H0(t,e=!0,n){const r=n||new Set;if(t){if(wg(t))r.add(t);else if(wg(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)H0(t[i],e,r)}}return n===void 0?Array.from(r):[]}function wg(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Zc=()=>{};class _h{constructor(e){p(this,"name");p(this,"source");p(this,"url");p(this,"terminated",!1);p(this,"worker");p(this,"onMessage");p(this,"onError");p(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Zn(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Zc,this.onError=s=>console.log(s),this.worker=Tr?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Tr||typeof Kc<"u"&&!Tr}destroy(){this.onMessage=Zc,this.onError=Zc,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||H0(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=W1({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Kc(r,{eval:!1})}else if(this.source)e=new Kc(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class Y1{constructor(e){p(this,"name","unnamed");p(this,"source");p(this,"url");p(this,"maxConcurrency",1);p(this,"maxMobileConcurrency",1);p(this,"onDebug",()=>{});p(this,"reuseWorkers",!0);p(this,"props",{});p(this,"jobQueue",[]);p(this,"idleQueue",[]);p(this,"count",0);p(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return _h.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new H1(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Tr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new _h({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return j1?this.maxMobileConcurrency:this.maxConcurrency}}const K1={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},In=class In{constructor(e){p(this,"props");p(this,"workerPools",new Map);this.props={...K1},this.setProps(e),this.workerPools=new Map}static isSupported(){return _h.isSupported()}static getWorkerFarm(e={}){return In._workerFarm=In._workerFarm||new In({}),In._workerFarm.setProps(e),In._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new Y1({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};p(In,"_workerFarm");let Qa=In;function q1(t,e={}){const n=e[t.id]||{},r=Tr?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Tr?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=L1);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return Zn(i),i}function Z1(t,e=z1){Zn(t,"no worker provided");const n=t.version;return!(!e||!n)}function Q1(t,e){return!Qa.isSupported()||!Tr&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function J1(t,e,n,r,i){const s=t.id,o=q1(t,n),l=Qa.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",G1.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function G1(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function eA(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function tA(...t){return nA(t)}function nA(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function rA(t){const e=[];for await(const n of t)e.push(n);return tA(...e)}function Sg(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Ag{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Sg(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Sg()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Gl{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof Ag?i=e:i=new Ag(n,r),this.stats[n]=i),i}}let iA="";const Rg={};function sA(t){for(const e in Rg)if(t.startsWith(e)){const n=Rg[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${iA}${t}`),t}function oA(t){return t&&typeof t=="object"&&t.isBuffer}function W0(t){if(oA(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function $0(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function aA(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const lA=t=>typeof t=="boolean",Ms=t=>typeof t=="function",yo=t=>t!==null&&typeof t=="object",bg=t=>yo(t)&&t.constructor==={}.constructor,cA=t=>!!t&&typeof t[Symbol.iterator]=="function",uA=t=>t&&typeof t[Symbol.asyncIterator]=="function",kr=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Or=t=>typeof Blob<"u"&&t instanceof Blob,hA=t=>t&&typeof t=="object"&&t.isBuffer,fA=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||yo(t)&&Ms(t.tee)&&Ms(t.cancel)&&Ms(t.getReader),dA=t=>yo(t)&&Ms(t.read)&&Ms(t.pipe)&&lA(t.readable),X0=t=>fA(t)||dA(t);class pA extends Error{constructor(n,r){super(n);p(this,"reason");p(this,"url");p(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const gA=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,_A=/^([-\w.]+\/[-\w.+]+)/;function Cg(t,e){return t.toLowerCase()===e.toLowerCase()}function mA(t){const e=_A.exec(t);return e?e[1]:t}function Pg(t){const e=gA.exec(t);return e?e[1]:""}const Y0=/\?.*/;function yA(t){const e=t.match(Y0);return e&&e[0]}function td(t){return t.replace(Y0,"")}function vA(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function ec(t){return kr(t)?t.url:Or(t)?t.name||"":typeof t=="string"?t:""}function nd(t){if(kr(t)){const e=t,n=e.headers.get("content-type")||"",r=td(e.url);return mA(n)||Pg(r)}return Or(t)?t.type||"":typeof t=="string"?Pg(t):""}function TA(t){return kr(t)?t.headers["content-length"]||-1:Or(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function K0(t){if(kr(t))return t;const e={},n=TA(t);n>=0&&(e["content-length"]=String(n));const r=ec(t),i=nd(t);i&&(e["content-type"]=i);const s=await SA(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function EA(t){if(!t.ok)throw await wA(t)}async function wA(t){const e=vA(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=i!=null&&i.includes("application/json")?await t.json():t.text()}catch{}return new pA(n,r)}async function SA(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${AA(n)}`}return null}function AA(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function RA(t){return!bA(t)&&!CA(t)}function bA(t){return t.startsWith("http:")||t.startsWith("https:")}function CA(t){return t.startsWith("data:")}async function xg(t,e){var n,r;if(typeof t=="string"){const i=sA(t);return RA(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await K0(t)}const Ig=new mo({id:"loaders.gl"});class PA{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class xA{constructor(){p(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const q0={fetch:null,mimeType:void 0,nothrow:!1,log:new xA,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Gf,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},IA={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Z0(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function Q0(){const t=Z0();return t.globalOptions=t.globalOptions||{...q0},t.globalOptions}function MA(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],NA(t,n),OA(e,t,r)}function NA(t,e){Mg(t,null,q0,IA,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Mg(r,n.id,i,s,e)}}function Mg(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&yo(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)Ig.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const h=kA(a,i);Ig.warn(`${s} loader option '${o}${a}' not recognized. ${h}`)()}}}}function kA(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function OA(t,e,n){const i={...t.options||{}};return FA(i,n),i.log===null&&(i.log=new PA),Ng(i,Q0()),Ng(i,e),i}function Ng(t,e){for(const n in e)if(n in e){const r=e[n];bg(r)&&bg(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function FA(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function rd(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function id(t){qa(t,"null loader"),qa(rd(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const J0=()=>{const t=Z0();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function DA(t){const e=J0();t=Array.isArray(t)?t:[t];for(const n of t){const r=id(n);e.find(i=>r===i)||e.unshift(r)}}function UA(){return J0()}const BA=new mo({id:"loaders.gl"}),LA=/\.([^.]+)$/;async function VA(t,e=[],n,r){if(!G0(t))return null;let i=kg(t,e,{...n,nothrow:!0},r);if(i)return i;if(Or(t)&&(t=await t.slice(0,10).arrayBuffer(),i=kg(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(ev(t));return i}function kg(t,e=[],n,r){if(!G0(t))return null;if(e&&!Array.isArray(e))return id(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...UA()),jA(i);const s=zA(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(ev(t));return s}function zA(t,e,n,r){const i=ec(t),s=nd(t),o=td(i)||(r==null?void 0:r.url);let a=null,l="";return n!=null&&n.mimeType&&(a=Qc(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||HA(e,o),l=l||(a?`matched url ${o}`:""),a=a||Qc(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||$A(e,t),l=l||(a?`matched initial data ${tv(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Qc(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&BA.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function G0(t){return!(t instanceof Response&&t.status===204)}function ev(t){const e=ec(t),n=nd(t);let r="No valid loader found (";r+=e?`${$0(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?tv(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function jA(t){for(const e of t)id(e)}function HA(t,e){const n=e&&LA.exec(e),r=n&&n[1];return r?WA(t,r):null}function WA(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Qc(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>Cg(e,i))||Cg(e,`application/x.${r.id}`))return r;return null}function $A(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(XA(e,n))return n}else if(ArrayBuffer.isView(e)){if(Og(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Og(e,0,n))return n;return null}function XA(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Og(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>YA(t,e,n,i))}function YA(t,e,n,r){if(r instanceof ArrayBuffer)return eA(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=mh(t,e,r.length);return r===i;default:return!1}}function tv(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?mh(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?mh(t,0,e):""}function mh(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const KA=256*1024;function*qA(t,e){const n=(e==null?void 0:e.chunkSize)||KA;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const ZA=256*1024;function*QA(t,e={}){const{chunkSize:n=ZA}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const JA=1024*1024;async function*GA(t,e){const n=(e==null?void 0:e.chunkSize)||JA;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function Fg(t,e){return Gf?eR(t,e):tR(t)}async function*eR(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield W0(o)}}catch{n.releaseLock()}}async function*tR(t,e){for await(const n of t)yield W0(n)}function nR(t,e){if(typeof t=="string")return qA(t,e);if(t instanceof ArrayBuffer)return QA(t,e);if(Or(t))return GA(t,e);if(X0(t))return Fg(t,e);if(kr(t))return Fg(t.body,e);throw new Error("makeIterator")}const nv="Cannot convert supplied data type";function rR(t,e,n){if(e.text&&typeof t=="string")return t;if(hA(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(nv)}async function iR(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return rR(t,e);if(Or(t)&&(t=await K0(t)),kr(t)){const i=t;return await EA(i),e.binary?await i.arrayBuffer():await i.text()}if(X0(t)&&(t=nR(t,n)),cA(t)||uA(t))return rA(t);throw new Error(nv)}function rv(t,e){const n=Q0(),r=t||n;return typeof r.fetch=="function"?r.fetch:yo(r.fetch)?i=>xg(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:xg}function sR(t,e,n){if(n)return n;const r={fetch:rv(e,t),...t};if(r.url){const i=td(r.url);r.baseUrl=i,r.queryString=yA(r.url),r.filename=$0(i),r.baseUrl=aA(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function oR(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Ja(t,e,n,r){e&&!Array.isArray(e)&&!rd(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=ec(t),o=oR(e,r),a=await VA(t,o,n);return a?(n=MA(n,a,o,i),r=sR({url:i,_parse:Ja,loaders:o},n,r||null),await aR(a,t,n,r)):null}async function aR(t,e,n,r){if(Z1(t),n=B1(t.options,n),kr(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:h}=s,f=Object.fromEntries(s.headers.entries());r.response={headers:f,ok:o,redirected:a,status:l,statusText:c,type:u,url:h}}e=await iR(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(Q1(t,n))return await J1(t,e,n,r,Ja);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw Zn(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}const Dg=100;class lR{constructor(e,n){p(this,"schema");p(this,"options");p(this,"shape");p(this,"length",0);p(this,"rows",null);p(this,"cursor",0);p(this,"_headers",[]);if(this.options=n,this.schema=e,!Array.isArray(e)){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.shape="array-row-table",this.rows=this.rows||new Array(Dg),this.rows[this.length]=e,this.length++}addObjectRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.shape="object-row-table",this.rows=this.rows||new Array(Dg),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function iv(t,e){if(!t)throw new Error("null row");const n={};if(e)for(let r=0;r<e.length;r++)n[e[r]]=t[r];else for(let r=0;r<t.length;r++){const i=`column-${r}`;n[i]=t[r]}return n}function sv(t,e){if(!t)throw new Error("null row");if(e){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}return Object.values(t)}function cR(t){const e=[];for(let n=0;n<t.length;n++){const r=`column-${n}`;e.push(r)}return e}function uR(t){return Object.keys(t)}const Ug=100;class hR{constructor(e,n){p(this,"schema");p(this,"options");p(this,"length",0);p(this,"objectRows",null);p(this,"arrayRows",null);p(this,"cursor",0);p(this,"_headers",null);if(this.options=n,this.schema=e,e){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=cR(e)),this.options.shape){case"object-row-table":const r=iv(e,this._headers);this.addObjectRow(r,n);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(Ug),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=uR(e)),this.options.shape){case"array-row-table":const r=sv(e,this._headers);this.addArrayRow(r,n);break;case"object-row-table":this.objectRows=this.objectRows||new Array(Ug),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const fR=100;class dR{constructor(e,n){p(this,"schema");p(this,"length",0);p(this,"allocated",0);p(this,"columns",{});this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let n=0;for(const r in this.columns)this.columns[r][this.length]=e[n++];this.length++}addObjectRow(e){this._reallocateColumns();for(const n in e)this.columns[n][this.length]=e[n];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const r in this.schema){const i=this.schema[r];e[i.name]=this.columns[i.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:fR,this.columns={};for(const e in this.schema){const n=this.schema[e],r=n.type||Float32Array,i=this.columns[n.index];if(i&&ArrayBuffer.isView(i)){const s=new r(this.allocated);s.set(i),this.columns[n.index]=s}else i?(i.length=this.allocated,this.columns[n.index]=i):this.columns[n.index]=new r(this.allocated)}}}_pruneColumns(){for(const[e,n]of Object.entries(this.columns))this.columns[e]=n.slice(0,this.length)}}const pR={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},gR="TableBatchBuilder",Ds=class Ds{constructor(e,n){p(this,"schema");p(this,"options");p(this,"aggregator",null);p(this,"batchCount",0);p(this,"bytesUsed",0);p(this,"isChunkComplete",!1);p(this,"lastBatchEmittedMs",Date.now());p(this,"totalLength",0);p(this,"totalBytes",0);p(this,"rowBytes",0);this.schema=e,this.options={...pR,...n}}limitReached(){var e,n;return!!((e=this.options)!=null&&e.limit&&this.totalLength>=this.options.limit||(n=this.options)!=null&&n._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e!=null&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);const n=this.aggregator.getBatch();return n.count=this.batchCount,n.bytesUsed=this.bytesUsed,Object.assign(n,e),this.batchCount++,this.aggregator=null,n}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return hR;case"columnar-table":return dR;case"arrow-table":if(!Ds.ArrowBatch)throw new Error(gR);return Ds.ArrowBatch;default:return lR}}};p(Ds,"ArrowBatch");let yh=Ds;class Bg extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class _R{constructor(){p(this,"_values");p(this,"_settlers");p(this,"_closed");this._values=new Bg,this._settlers=new Bg,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const n=this._settlers.dequeue();e instanceof Error?n.reject(e):n.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,n)=>{this._settlers.enqueue({resolve:e,reject:n})})}}async function Ga(t,e,n,r){let i,s;!Array.isArray(e)&&!rd(e)?(i=[],s=e):(i=e,s=n);const o=rv(s);let a=t;return typeof t=="string"&&(a=await o(t)),Or(t)&&(a=await o(t)),Array.isArray(i)?await Ja(a,i,s):await Ja(a,i,s)}const mR="4.2.4";var Rm;const yR=(Rm=globalThis.loaders)==null?void 0:Rm.parseImageNode,vh=typeof Image<"u",Th=typeof ImageBitmap<"u",vR=!!yR,Eh=Gf?!0:vR;function TR(t){switch(t){case"auto":return Th||vh||Eh;case"imagebitmap":return Th;case"image":return vh;case"data":return Eh;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function ER(){if(Th)return"imagebitmap";if(vh)return"image";if(Eh)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function wR(t){const e=AR(t);if(!e)throw new Error("Not an image");return e}function SR(t){switch(wR(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function AR(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const RR=/^data:image\/svg\+xml/,bR=/\.svg((\?|#).*)?$/;function sd(t){return t&&(RR.test(t)||bR.test(t))}function CR(t,e){if(sd(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return ov(t,e)}function ov(t,e){if(sd(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function av(t,e,n){const r=CR(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await PR(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function PR(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const xR={};let Lg=!0;async function IR(t,e,n){let r;sd(n)?r=await av(t,e,n):r=ov(t,n);const i=e&&e.imagebitmap;return await MR(r,i)}async function MR(t,e=null){if((NR(e)||!Lg)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Lg=!1}return await createImageBitmap(t)}function NR(t){for(const e in t||xR)return!1;return!0}function kR(t){return!UR(t,"ftyp",4)||!(t[8]&96)?null:OR(t)}function OR(t){switch(FR(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function FR(t,e,n){return String.fromCharCode(...t.slice(e,n))}function DR(t){return[...t].map(e=>e.charCodeAt(0))}function UR(t,e,n=0){const r=DR(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Yt=!1,Ns=!0;function lv(t){const e=vo(t);return LR(e)||jR(e)||VR(e)||zR(e)||BR(e)}function BR(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=kR(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function LR(t){const e=vo(t);return e.byteLength>=24&&e.getUint32(0,Yt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Yt),height:e.getUint32(20,Yt)}:null}function VR(t){const e=vo(t);return e.byteLength>=10&&e.getUint32(0,Yt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ns),height:e.getUint16(8,Ns)}:null}function zR(t){const e=vo(t);return e.byteLength>=14&&e.getUint16(0,Yt)===16973&&e.getUint32(2,Ns)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ns),height:e.getUint32(22,Ns)}:null}function jR(t){const e=vo(t);if(!(e.byteLength>=3&&e.getUint16(0,Yt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=HR();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Yt);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Yt),width:e.getUint16(s+7,Yt)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Yt)}return null}function HR(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function vo(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function WR(t,e){var i;const{mimeType:n}=lv(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return qa(r),await r(t,n)}async function $R(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=XR(i);let a;switch(o){case"imagebitmap":a=await IR(t,e,s);break;case"image":a=await av(t,e,s);break;case"data":a=await WR(t);break;default:qa(!1)}return i==="data"&&(a=SR(a)),a}function XR(t){switch(t){case"auto":case"data":return ER();default:return TR(t),t}}const YR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],KR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],qR={image:{type:"auto",decode:!0}},ZR={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:mR,mimeTypes:KR,extensions:YR,parse:$R,tests:[t=>!!lv(new DataView(t))],options:qR},QR=new mo({id:"deck"}),ne=QR;let wh={};function JR(t){wh=t}function ze(t,e,n,r){ne.level>0&&wh[t]&&wh[t].call(null,e,n,r)}function GR(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const eb={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:GR,parseTextSync:JSON.parse};function tb(){const t="9.0.32",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ne.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ne,_registerLoggers:JR},DA([eb,[ZR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const nb=tb();function gr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Jc={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function rb(t){const e={};for(const[n,r]of Object.entries(t))e[n]=sb(r);return e}function ib(t,e,n){const r={};for(const[i,s]of Object.entries(e))t&&i in t&&!s.private?(s.validate&&gr(s.validate(t[i],s),`${n}: invalid ${i}`),r[i]=t[i]):r[i]=s.value;return r}function sb(t){let e=Vg(t);if(e!=="object")return{value:t,...Jc[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Jc[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Vg(t.value),{...t,...Jc[e],type:e}):{type:"object",value:null};throw new Error("props")}function Vg(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const ob=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,ab=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,lb={vertex:ob,fragment:ab},zg=/void\s+main\s*\([^)]*\)\s*\{\n?/,jg=/}\n?[^{}]*$/,Gc=[],wa="__LUMA_INJECT_DECLARATIONS__";function cb(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=ub(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function ub(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function el(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Gc.length=o.length;for(let l=0,c=o.length;l<c;++l)Gc[l]=o[l].injection;const a=`${Gc.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(wa,a));break;case"vs:#main-start":i&&(t=t.replace(zg,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(jg,l=>a+l));break;case"fs:#decl":i||(t=t.replace(wa,a));break;case"fs:#main-start":i||(t=t.replace(zg,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(jg,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(wa,""),r&&(t=t.replace(/\}\s*$/,s=>s+lb[e])),t}let hb=1;class _r{constructor(e){p(this,"name");p(this,"vs");p(this,"fs");p(this,"getModuleUniforms");p(this,"dependencies");p(this,"deprecations");p(this,"defines");p(this,"injections");p(this,"uniforms",{});p(this,"uniformTypes",{});const{name:n,vs:r,fs:i,dependencies:s=[],uniformTypes:o={},uniformPropTypes:a={},getUniforms:l,deprecations:c=[],defines:u={},inject:h={}}=e;gr(typeof n=="string"),this.name=n,this.vs=r,this.fs=i,this.getModuleUniforms=l,this.dependencies=_r.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(c),this.defines=u,this.injections=cb(h),this.uniformTypes=o,a&&(this.uniforms=rb(a))}static instantiateModules(e){return e.map(n=>{if(n instanceof _r)return n;gr(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${hb++}`);const r=new _r(n);return r.dependencies=_r.instantiateModules(n.dependencies||[]),r})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:gr(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):ib(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{var i;(i=r.regex)!=null&&i.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&gr(s.validate(e[i],s),`${this.name}: invalid ${i}`),n[i]=e[i]):n[i]=s.value}return n}}function Hg(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=Wg(t.platformInfo,t.vs);let n;return t.fs&&(n=Wg(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function Wg(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function tc(t){const e=_r.instantiateModules(t);return fb(e)}function fb(t){const e={},n={};return cv({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function cv(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&cv({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function db(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function pb(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=$g(t,gb),t;case"fragment":return t=$g(t,_b),t;default:throw new Error(e)}}const uv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],gb=[...uv,[Sh("attribute"),"in $1"],[Sh("varying"),"out $1"]],_b=[...uv,[Sh("varying"),"in $1"]];function $g(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Sh(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function hv(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function fv(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function mb(t,e){return{name:yb(t,e),language:"glsl",version:vb(t)}}function yb(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function vb(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const dv=`

${wa}
`,Tb=`precision highp float;
`;function Eb(t){const e=tc(t.modules||[]);return{source:Ah(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:od(e)}}function wb(t){const e=tc(t.modules||[]);return{vs:Ah(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:Ah(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:od(e)}}function Sb(t){const{vs:e,fs:n}=t,r=tc(t.modules||[]);return{vs:Xg(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Xg(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:od(r)}}function Ah(t,e){const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;gr(typeof n=="string","shader source must be a string");const l=n;let c="";const u=fv(s),h={},f={},m={};for(const w in o){const S=typeof o[w]=="string"?{injection:o[w],order:0}:o[w],_=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(_){const d=_[2],y=_[3];d?y==="decl"?f[w]=[S]:m[w]=[S]:h[w]=[S]}else m[w]=[S]}const E=t.type!=="webgpu"?i:[];for(const w of E){a&&w.checkDeprecations(l,a);const S=w.getModuleSource(r,"wgsl");c+=S;const _=w.injections[r];for(const d in _){const y=/^(v|f)s:#([\w-]+)$/.exec(d);if(y){const b=y[2]==="decl"?f:m;b[d]=b[d]||[],b[d].push(_[d])}else h[d]=h[d]||[],h[d].push(_[d])}}return c+=dv,c=el(c,r,f),c+=hv(u[r],h),c+=l,c=el(c,r,m),c}function Xg(t,e){const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=e;gr(typeof r=="string","shader source must be a string");const f=s==="glsl"?mb(r).version:-1,m=t.shaderLanguageVersion,E=f===100?"#version 100":"#version 300 es",S=r.split(`
`).slice(1).join(`
`),_={};o.forEach(k=>{Object.assign(_,k.getDefines())}),Object.assign(_,a);let d="";switch(s){case"wgsl":break;case"glsl":d=u?`${E}

// ----- PROLOGUE -------------------------
${Ab({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${db(t)}
${i==="fragment"?Tb:""}

// ----- APPLICATION DEFINES -------------------------

${Rb(_)}

`:`${E}
`;break}const y=fv(l),A={},b={},I={};for(const k in c){const M=typeof c[k]=="string"?{injection:c[k],order:0}:c[k],O=/^(v|f)s:(#)?([\w-]+)$/.exec(k);if(O){const F=O[2],V=O[3];F?V==="decl"?b[k]=[M]:I[k]=[M]:A[k]=[M]}else I[k]=[M]}for(const k of o){h&&k.checkDeprecations(S,h);const M=k.getModuleSource(i);d+=M;const O=k.injections[i];for(const F in O){const V=/^(v|f)s:#([\w-]+)$/.exec(F);if(V){const X=V[2]==="decl"?b:I;X[F]=X[F]||[],X[F].push(O[F])}else A[F]=A[F]||[],A[F].push(O[F])}}return d+="// ----- MAIN SHADER SOURCE -------------------------",d+=dv,d=el(d,i,b),d+=hv(y[i],A),d+=S,d=el(d,i,I),s==="glsl"&&f!==m&&(d=pb(d,i)),d.trim()}function od(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function Ab(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function Rb(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const ur=class ur{constructor(){p(this,"_hookFunctions",[]);p(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return ur.defaultShaderAssembler=ur.defaultShaderAssembler||new ur,ur.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,i=Hg(e);return{...Eb({platformInfo:e.platformInfo,...i,modules:n,hookFunctions:r}),modules:n}}assembleShaderPair(e){const n=Hg(e),r=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:s}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?wb({platformInfo:s,...n,modules:r,hookFunctions:i}):Sb({platformInfo:s,...n,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,_r.instantiateModules(n)}};p(ur,"defaultShaderAssembler");let tl=ur;const bb=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,Cb=`#version 300 es
${bb}`;function Pb(t){const{input:e,inputChannels:n,output:r}=t||{};if(!e)return Cb;if(!n)throw new Error("inputChannels");const i=xb(n),s=Ib(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function xb(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function Ib(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const B=new mo({id:"luma.gl"});class Mb{constructor(){p(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Gl({id:e})),this.stats.get(e)}}const ad=new Mb;function Nb(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(tr()&&B.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:B,stats:ad}),t}const kb=Nb();function Ob(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function no(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:Ob(t)}const eu={};function Fr(t="id"){eu[t]=eu[t]||1;const e=eu[t]++;return`${t}-${e}`}function nl(t){let e=!0;for(const n in t){e=!1;break}return e}var Su;let oe=(Su=class{constructor(e,n,r){p(this,"id");p(this,"props");p(this,"userData",{});p(this,"_device");p(this,"destroyed",!1);p(this,"allocatedBytes",0);p(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Fb(n,r);const i=this.props.id!=="undefined"?this.props.id:Fr(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},p(Su,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Su);function Fb(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const ke=class ke extends oe{constructor(n,r){const i={...r};(r.usage||0)&ke.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16"));super(n,i,ke.defaultProps);p(this,"usage");p(this,"indexType");p(this,"updateTimestamp");p(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,ke.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&i===n.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};p(ke,"defaultProps",{...oe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),p(ke,"MAP_READ",1),p(ke,"MAP_WRITE",2),p(ke,"COPY_SRC",4),p(ke,"COPY_DST",8),p(ke,"INDEX",16),p(ke,"VERTEX",32),p(ke,"UNIFORM",64),p(ke,"STORAGE",128),p(ke,"INDIRECT",256),p(ke,"QUERY_RESOLVE",512),p(ke,"DEBUG_DATA_MAX_LENGTH",32);let ge=ke;function pv(t){const e=Yg[t],n=Db(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:Yg[t],byteLength:n,integer:i,signed:s,normalized:r}}function Db(t){return Ub[t]}const Yg={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Ub={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Bb=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Lb=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function Vb(t){return Bb.some(e=>t.startsWith(e))}function gv(t){const e=Lb.exec(t);if(e){const[,n,r,i,s,o]=e;if(n){const a=`${i}${r}`,l=pv(a);return{format:n,components:n.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...l}}}return jb(t)}const zb={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function jb(t){var n;const e=zb[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class Hb{}class Wb{constructor(e=[],n){p(this,"features");p(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Us=class Us{constructor(e){p(this,"id");p(this,"props");p(this,"userData",{});p(this,"statsManager",ad);p(this,"_lumaData",{});p(this,"timestamp",0);this.props={...Us.defaultProps,...e},this.id=this.props.id||Fr(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return Vb(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&ge.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":B.warn("indices buffer content must be of integer type")()),n}};p(Us,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!B.get("debug"),spector:!!(B.get("spector")||B.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>B.error(e.message)}),p(Us,"VERSION",kb);let Ni=Us;function le(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const as=new Map,di=class di{static registerDevices(e){for(const n of e)le(n.type&&n.isSupported&&n.create),as.set(n.type,n)}static getAvailableDevices(){return Array.from(as).map(e=>e.type)}static getSupportedDevices(){return Array.from(as).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Ni.defaultProps,e)}static async attachDevice(e){const n=Kg(e.devices)||as;if(e.handle instanceof WebGL2RenderingContext){const r=n.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=n.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var s,o;e={...di.defaultProps,...e},e.gl&&(e.type="webgl");const n=Kg(e.devices)||as;let r,i;switch(e.type){case"webgpu":if(r=n.get("webgpu"),r)return await r.create(e);break;case"webgl":if(i=n.get("webgl"),i)return await i.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=n.get("webgpu"),(s=r==null?void 0:r.isSupported)!=null&&s.call(r))return await r.create(e);if(i=n.get("webgl"),(o=i==null?void 0:i.isSupported)!=null&&o.call(i))return await i.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const n=HTMLCanvasElement.prototype;if(!e&&n.originalGetContext){n.getContext=n.originalGetContext,n.originalGetContext=void 0;return}n.originalGetContext=n.getContext,n.getContext=function(r,i){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",i):this.originalGetContext(r,i)}}};p(di,"defaultProps",{...Ni.defaultProps,type:"best-available",devices:void 0}),p(di,"stats",ad),p(di,"log",B);let Ti=di;function Kg(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const $b=tr()&&typeof document<"u",nc=()=>$b&&document.readyState==="complete",Xb={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class ld{constructor(e){p(this,"id");p(this,"props");p(this,"canvas");p(this,"htmlCanvas");p(this,"offscreenCanvas");p(this,"type");p(this,"width",1);p(this,"height",1);p(this,"resizeObserver");p(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Xb,...e},e=this.props,!tr()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=qb(e.canvas):this.canvas=e.canvas;else{const n=Zb(e),r=Kb((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return nc()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return Qb(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(B.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);this.htmlCanvas.width=a,this.htmlCanvas.height=l;const[c,u]=this.getDrawingBufferSize();(c!==a||u!==l)&&(o=Math.min(c/r,u/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),B.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}p(ld,"pageLoaded",Yb());function Yb(){return nc()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function Kb(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!nc())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function qb(t){const e=document.getElementById(t);if(!e&&!nc())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function Zb(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function Qb(t,e,n,r,i){const s=t,o=qg(s[0],e,n);let a=Zg(s[1],e,r,i),l=qg(s[0]+1,e,n);const c=l===n-1?l:l-1;l=Zg(s[1]+1,e,r,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function qg(t,e,n){return Math.min(Math.round(t*e),n-1)}function Zg(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const an=class an extends oe{constructor(n,r,i=an.defaultProps){super(n,r,i);p(this,"dimension");p(this,"format");p(this,"width");p(this,"height");p(this,"depth");p(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};p(an,"defaultProps",{...oe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),p(an,"COPY_SRC",1),p(an,"COPY_DST",2),p(an,"TEXTURE_BINDING",4),p(an,"STORAGE_BINDING",8),p(an,"RENDER_ATTACHMENT",16);let vt=an;const wl=class wl extends oe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,wl.defaultProps)}};p(wl,"defaultProps",{...oe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let rl=wl;function Jb(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=_v(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=Qg(l,i,l.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=Qg(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Qg(t,e,n,r){if(r!=null&&r.inlineSource){const i=Gb(e,n),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${i}${s}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function Gb(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=_v(s,e,n))}return r}function _v(t,e,n){const r=n!=null&&n.html?t3(t):t;return`${e3(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function e3(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function t3(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function mv(t,e){return{name:n3(t,e),language:"glsl",version:r3(t)}}function n3(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function r3(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const Sl=class Sl extends oe{constructor(n,r){super(n,{id:i3(r),...r},Sl.defaultProps);p(this,"stage");p(this,"source");p(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var c;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=mv(this.source).name,i=`${this.stage} ${r}`;let s=Jb(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const l=document.getElementsByClassName("luma-compiler-log-error");(c=l[0])!=null&&c.scrollIntoView&&l[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};p(Sl,"defaultProps",{...oe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let il=Sl;function i3(t){return mv(t.source).name||t.id||Fr(`unnamed ${t.stage}-shader`)}const Al=class Al extends oe{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,Al.defaultProps)}};p(Al,"defaultProps",{...oe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let sl=Al;const Rl=class Rl extends oe{constructor(n,r={}){super(n,r,Rl.defaultProps);p(this,"width");p(this,"height");p(this,"colorAttachments",[]);p(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(B.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof vt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof vt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:vt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:vt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.device._createTexture({...this.colorAttachments[i].props,width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};p(Rl,"defaultProps",{...oe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let ol=Rl;const bl=class bl extends oe{constructor(n,r){super(n,r,bl.defaultProps);p(this,"shaderLayout");p(this,"bufferLayout");p(this,"linkStatus","pending");p(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};p(bl,"defaultProps",{...oe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let ki=bl;const Cl=class Cl extends oe{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,Cl.defaultProps)}};p(Cl,"defaultProps",{...oe.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Rh=Cl;const Pl=class Pl extends oe{constructor(n,r){super(n,r,Pl.defaultProps);p(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};p(Pl,"defaultProps",{...oe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let al=Pl;const xl=class xl extends oe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,xl.defaultProps)}};p(xl,"defaultProps",{...oe.defaultProps,measureExecutionTime:void 0});let bh=xl;const Il=class Il extends oe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Il.defaultProps)}};p(Il,"defaultProps",{...oe.defaultProps});let Ch=Il;function s3(t){const[e,n]=a3[t],r=e==="i32"||e==="u32",i=e!=="u32",s=l3[e]*n,o=o3(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function o3(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const a3={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},l3={f32:4,f16:2,i32:4,u32:4};function yv(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=pv(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function vv(t,e){const n={};for(const r of t.attributes)n[r.name]=u3(t,e,r.name);return n}function c3(t,e,n=16){const r=vv(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function u3(t,e,n){const r=h3(t,n),i=f3(e,n);if(!r)return null;const s=s3(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=yv(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function h3(t,e){const n=t.attributes.find(r=>r.name===e);return n||B.warn(`shader layout attribute "${e}" not present in shader`),n||null}function f3(t,e){d3(t);let n=p3(t,e);return n||(n=g3(t,e),n)?n:(B.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function d3(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&B.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function p3(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function g3(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=yv(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}function _3(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):B.warn(`shader layout attribute ${r.name} not present in shader`)}return n}const Ml=class Ml extends oe{constructor(n,r){super(n,r,Ml.defaultProps);p(this,"maxVertexAttributes");p(this,"attributeInfos");p(this,"indexBuffer",null);p(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=c3(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};p(Ml,"defaultProps",{...oe.defaultProps,renderPipeline:null});let Ph=Ml;const Nl=class Nl extends oe{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Nl.defaultProps)}};p(Nl,"defaultProps",{...oe.defaultProps,layout:void 0,buffers:{}});let xh=Nl;const kl=class kl extends oe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,kl.defaultProps)}};p(kl,"defaultProps",{...oe.defaultProps,type:void 0,count:void 0});let Ih=kl;const m3={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function y3(t){const e=m3[t];return le(t),e}function v3(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Qo;function Tv(t){return(!Qo||Qo.byteLength<t)&&(Qo=new ArrayBuffer(t)),Qo}function T3(t,e){const n=Tv(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function E3(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}const Jg=1024;class w3{constructor(e){p(this,"layout",{});p(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=y3(s),{type:a,components:l}=o;n=v3(n,l);const c=n;n+=l,this.layout[i]={type:a,size:l,offset:c}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,Jg)}getData(e){const n=Math.max(this.byteLength,Jg),r=Tv(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){B.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:c,offset:u}=a,h=i[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){B.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}h[u]=Number(o)}else{const f=no(o);if(!f){B.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}h.set(f,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function S3(t,e,n=16){if(t!==e)return!1;const r=no(t);if(!r)return!1;const i=no(e);if(i&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function A3(t){const e=no(t);return e?e.slice():t}class R3{constructor(e){p(this,"name");p(this,"uniforms",{});p(this,"modifiedUniforms",{});p(this,"modified",!0);p(this,"bindingLayout",{});p(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){S3(this.uniforms[e],n)||(this.uniforms[e]=A3(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class b3{constructor(e){p(this,"uniformBlocks",new Map);p(this,"uniformBufferLayouts",new Map);p(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new w3(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new R3({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,r]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:ge.UNIFORM|ge.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:ge.UNIFORM|ge.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&B.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let i=!1;if(r&&n.needsRedraw){i||(i=n.needsRedraw);const s=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(s);const a=this.uniformBlocks.get(e).getAllUniforms();B.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return i}}function Ev(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function wv(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function C3(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=Ev(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}function P3(t){return no(t)!==null||typeof t=="number"||typeof t=="boolean"}function cd(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];P3(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function x3(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const c=r[a]?`${t}.${r[a]}`:"N/A";B.removed(`${t}.${a}`,c)()}for(const a in i)if(a in e){const l=i[a];B.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const[a,l]of Object.entries(s))a in e&&(B.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]);return o||e}let I3="";async function M3(t,e){return await new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error(`Could not load image ${t}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=t.startsWith("http")?t:I3+t}catch(i){r(i)}})}async function Sv(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}function Mh(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Mh(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Mh(t[s],e[s],n-1))return!1;return!0}return!1}function N3(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function k3(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class O3{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Tn{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(ll.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(cl.instance)}}}class ll extends Tn{}ll.instance=new ll;class cl extends Tn{}cl.instance=new cl;class de extends Tn{constructor(){super()}}class Nh extends de{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class F3 extends de{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class D3 extends de{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class U3 extends de{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class B3 extends de{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class cr extends de{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Av extends de{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class kh extends de{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Gg extends de{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var Oi;(function(t){t.increment="++",t.decrement="--"})(Oi||(Oi={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Oi||(Oi={}));class L3 extends de{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var ro;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(ro||(ro={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(ro||(ro={}));class V3 extends de{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Rv extends de{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class z3 extends de{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class j3 extends de{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class H3 extends de{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class W3 extends de{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class $3 extends de{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class X3 extends de{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Y3 extends de{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class bv extends de{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class K3 extends de{constructor(){super()}get astNodeType(){return"discard"}}class q3 extends de{constructor(){super()}get astNodeType(){return"break"}}class Z3 extends de{constructor(){super()}get astNodeType(){return"continue"}}class Dr extends de{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class lr extends Dr{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class Cv extends Dr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class Q3 extends Dr{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Pv extends Dr{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class ys extends Dr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class Ft extends Tn{constructor(){super()}}class e_ extends Ft{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class ai extends Ft{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){e(this);for(const n of this.args)n.search(e)}}class xv extends Ft{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class Oh extends Ft{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class t_ extends Ft{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof ai){const i=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(i);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class n_ extends Ft{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class J3 extends Ft{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class G3 extends Ft{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class r_ extends Ft{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class eC extends Ft{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Iv extends Ft{constructor(){super()}}class tC extends Iv{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Vt extends Iv{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class Mv extends Tn{constructor(){super()}}class nC extends Mv{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class rC extends Mv{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class iC extends Tn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class sC extends Tn{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class oC extends Tn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let aC=class extends Tn{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var x,C;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(C||(C={}));class P{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class T{}x=T;T.none=new P("",C.reserved,"");T.eof=new P("EOF",C.token,"");T.reserved={asm:new P("asm",C.reserved,"asm"),bf16:new P("bf16",C.reserved,"bf16"),do:new P("do",C.reserved,"do"),enum:new P("enum",C.reserved,"enum"),f16:new P("f16",C.reserved,"f16"),f64:new P("f64",C.reserved,"f64"),handle:new P("handle",C.reserved,"handle"),i8:new P("i8",C.reserved,"i8"),i16:new P("i16",C.reserved,"i16"),i64:new P("i64",C.reserved,"i64"),mat:new P("mat",C.reserved,"mat"),premerge:new P("premerge",C.reserved,"premerge"),regardless:new P("regardless",C.reserved,"regardless"),typedef:new P("typedef",C.reserved,"typedef"),u8:new P("u8",C.reserved,"u8"),u16:new P("u16",C.reserved,"u16"),u64:new P("u64",C.reserved,"u64"),unless:new P("unless",C.reserved,"unless"),using:new P("using",C.reserved,"using"),vec:new P("vec",C.reserved,"vec"),void:new P("void",C.reserved,"void")};T.keywords={array:new P("array",C.keyword,"array"),atomic:new P("atomic",C.keyword,"atomic"),bool:new P("bool",C.keyword,"bool"),f32:new P("f32",C.keyword,"f32"),i32:new P("i32",C.keyword,"i32"),mat2x2:new P("mat2x2",C.keyword,"mat2x2"),mat2x3:new P("mat2x3",C.keyword,"mat2x3"),mat2x4:new P("mat2x4",C.keyword,"mat2x4"),mat3x2:new P("mat3x2",C.keyword,"mat3x2"),mat3x3:new P("mat3x3",C.keyword,"mat3x3"),mat3x4:new P("mat3x4",C.keyword,"mat3x4"),mat4x2:new P("mat4x2",C.keyword,"mat4x2"),mat4x3:new P("mat4x3",C.keyword,"mat4x3"),mat4x4:new P("mat4x4",C.keyword,"mat4x4"),ptr:new P("ptr",C.keyword,"ptr"),sampler:new P("sampler",C.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",C.keyword,"sampler_comparison"),struct:new P("struct",C.keyword,"struct"),texture_1d:new P("texture_1d",C.keyword,"texture_1d"),texture_2d:new P("texture_2d",C.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",C.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",C.keyword,"texture_3d"),texture_cube:new P("texture_cube",C.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",C.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",C.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",C.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",C.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",C.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",C.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",C.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",C.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",C.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",C.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",C.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",C.keyword,"texture_external"),u32:new P("u32",C.keyword,"u32"),vec2:new P("vec2",C.keyword,"vec2"),vec3:new P("vec3",C.keyword,"vec3"),vec4:new P("vec4",C.keyword,"vec4"),bitcast:new P("bitcast",C.keyword,"bitcast"),block:new P("block",C.keyword,"block"),break:new P("break",C.keyword,"break"),case:new P("case",C.keyword,"case"),continue:new P("continue",C.keyword,"continue"),continuing:new P("continuing",C.keyword,"continuing"),default:new P("default",C.keyword,"default"),diagnostic:new P("diagnostic",C.keyword,"diagnostic"),discard:new P("discard",C.keyword,"discard"),else:new P("else",C.keyword,"else"),enable:new P("enable",C.keyword,"enable"),fallthrough:new P("fallthrough",C.keyword,"fallthrough"),false:new P("false",C.keyword,"false"),fn:new P("fn",C.keyword,"fn"),for:new P("for",C.keyword,"for"),function:new P("function",C.keyword,"function"),if:new P("if",C.keyword,"if"),let:new P("let",C.keyword,"let"),const:new P("const",C.keyword,"const"),loop:new P("loop",C.keyword,"loop"),while:new P("while",C.keyword,"while"),private:new P("private",C.keyword,"private"),read:new P("read",C.keyword,"read"),read_write:new P("read_write",C.keyword,"read_write"),return:new P("return",C.keyword,"return"),requires:new P("requires",C.keyword,"requires"),storage:new P("storage",C.keyword,"storage"),switch:new P("switch",C.keyword,"switch"),true:new P("true",C.keyword,"true"),alias:new P("alias",C.keyword,"alias"),type:new P("type",C.keyword,"type"),uniform:new P("uniform",C.keyword,"uniform"),var:new P("var",C.keyword,"var"),override:new P("override",C.keyword,"override"),workgroup:new P("workgroup",C.keyword,"workgroup"),write:new P("write",C.keyword,"write"),r8unorm:new P("r8unorm",C.keyword,"r8unorm"),r8snorm:new P("r8snorm",C.keyword,"r8snorm"),r8uint:new P("r8uint",C.keyword,"r8uint"),r8sint:new P("r8sint",C.keyword,"r8sint"),r16uint:new P("r16uint",C.keyword,"r16uint"),r16sint:new P("r16sint",C.keyword,"r16sint"),r16float:new P("r16float",C.keyword,"r16float"),rg8unorm:new P("rg8unorm",C.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",C.keyword,"rg8snorm"),rg8uint:new P("rg8uint",C.keyword,"rg8uint"),rg8sint:new P("rg8sint",C.keyword,"rg8sint"),r32uint:new P("r32uint",C.keyword,"r32uint"),r32sint:new P("r32sint",C.keyword,"r32sint"),r32float:new P("r32float",C.keyword,"r32float"),rg16uint:new P("rg16uint",C.keyword,"rg16uint"),rg16sint:new P("rg16sint",C.keyword,"rg16sint"),rg16float:new P("rg16float",C.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",C.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",C.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",C.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",C.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",C.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",C.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",C.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",C.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",C.keyword,"rg11b10float"),rg32uint:new P("rg32uint",C.keyword,"rg32uint"),rg32sint:new P("rg32sint",C.keyword,"rg32sint"),rg32float:new P("rg32float",C.keyword,"rg32float"),rgba16uint:new P("rgba16uint",C.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",C.keyword,"rgba16sint"),rgba16float:new P("rgba16float",C.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",C.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",C.keyword,"rgba32sint"),rgba32float:new P("rgba32float",C.keyword,"rgba32float"),static_assert:new P("static_assert",C.keyword,"static_assert")};T.tokens={decimal_float_literal:new P("decimal_float_literal",C.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new P("hex_float_literal",C.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new P("int_literal",C.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",C.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new P("ident",C.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",C.token,"&"),and_and:new P("and_and",C.token,"&&"),arrow:new P("arrow ",C.token,"->"),attr:new P("attr",C.token,"@"),forward_slash:new P("forward_slash",C.token,"/"),bang:new P("bang",C.token,"!"),bracket_left:new P("bracket_left",C.token,"["),bracket_right:new P("bracket_right",C.token,"]"),brace_left:new P("brace_left",C.token,"{"),brace_right:new P("brace_right",C.token,"}"),colon:new P("colon",C.token,":"),comma:new P("comma",C.token,","),equal:new P("equal",C.token,"="),equal_equal:new P("equal_equal",C.token,"=="),not_equal:new P("not_equal",C.token,"!="),greater_than:new P("greater_than",C.token,">"),greater_than_equal:new P("greater_than_equal",C.token,">="),shift_right:new P("shift_right",C.token,">>"),less_than:new P("less_than",C.token,"<"),less_than_equal:new P("less_than_equal",C.token,"<="),shift_left:new P("shift_left",C.token,"<<"),modulo:new P("modulo",C.token,"%"),minus:new P("minus",C.token,"-"),minus_minus:new P("minus_minus",C.token,"--"),period:new P("period",C.token,"."),plus:new P("plus",C.token,"+"),plus_plus:new P("plus_plus",C.token,"++"),or:new P("or",C.token,"|"),or_or:new P("or_or",C.token,"||"),paren_left:new P("paren_left",C.token,"("),paren_right:new P("paren_right",C.token,")"),semicolon:new P("semicolon",C.token,";"),star:new P("star",C.token,"*"),tilde:new P("tilde",C.token,"~"),underscore:new P("underscore",C.token,"_"),xor:new P("xor",C.token,"^"),plus_equal:new P("plus_equal",C.token,"+="),minus_equal:new P("minus_equal",C.token,"-="),times_equal:new P("times_equal",C.token,"*="),division_equal:new P("division_equal",C.token,"/="),modulo_equal:new P("modulo_equal",C.token,"%="),and_equal:new P("and_equal",C.token,"&="),or_equal:new P("or_equal",C.token,"|="),xor_equal:new P("xor_equal",C.token,"^="),shift_right_equal:new P("shift_right_equal",C.token,">>="),shift_left_equal:new P("shift_left_equal",C.token,"<<=")};T.simpleTokens={"@":x.tokens.attr,"{":x.tokens.brace_left,"}":x.tokens.brace_right,":":x.tokens.colon,",":x.tokens.comma,"(":x.tokens.paren_left,")":x.tokens.paren_right,";":x.tokens.semicolon};T.literalTokens={"&":x.tokens.and,"&&":x.tokens.and_and,"->":x.tokens.arrow,"/":x.tokens.forward_slash,"!":x.tokens.bang,"[":x.tokens.bracket_left,"]":x.tokens.bracket_right,"=":x.tokens.equal,"==":x.tokens.equal_equal,"!=":x.tokens.not_equal,">":x.tokens.greater_than,">=":x.tokens.greater_than_equal,">>":x.tokens.shift_right,"<":x.tokens.less_than,"<=":x.tokens.less_than_equal,"<<":x.tokens.shift_left,"%":x.tokens.modulo,"-":x.tokens.minus,"--":x.tokens.minus_minus,".":x.tokens.period,"+":x.tokens.plus,"++":x.tokens.plus_plus,"|":x.tokens.or,"||":x.tokens.or_or,"*":x.tokens.star,"~":x.tokens.tilde,_:x.tokens.underscore,"^":x.tokens.xor,"+=":x.tokens.plus_equal,"-=":x.tokens.minus_equal,"*=":x.tokens.times_equal,"/=":x.tokens.division_equal,"%=":x.tokens.modulo_equal,"&=":x.tokens.and_equal,"|=":x.tokens.or_equal,"^=":x.tokens.xor_equal,">>=":x.tokens.shift_right_equal,"<<=":x.tokens.shift_left_equal};T.regexTokens={decimal_float_literal:x.tokens.decimal_float_literal,hex_float_literal:x.tokens.hex_float_literal,int_literal:x.tokens.int_literal,uint_literal:x.tokens.uint_literal,ident:x.tokens.ident};T.storage_class=[x.keywords.function,x.keywords.private,x.keywords.workgroup,x.keywords.uniform,x.keywords.storage];T.access_mode=[x.keywords.read,x.keywords.write,x.keywords.read_write];T.sampler_type=[x.keywords.sampler,x.keywords.sampler_comparison];T.sampled_texture_type=[x.keywords.texture_1d,x.keywords.texture_2d,x.keywords.texture_2d_array,x.keywords.texture_3d,x.keywords.texture_cube,x.keywords.texture_cube_array];T.multisampled_texture_type=[x.keywords.texture_multisampled_2d];T.storage_texture_type=[x.keywords.texture_storage_1d,x.keywords.texture_storage_2d,x.keywords.texture_storage_2d_array,x.keywords.texture_storage_3d];T.depth_texture_type=[x.keywords.texture_depth_2d,x.keywords.texture_depth_2d_array,x.keywords.texture_depth_cube,x.keywords.texture_depth_cube_array,x.keywords.texture_depth_multisampled_2d];T.texture_external_type=[x.keywords.texture_external];T.any_texture_type=[...x.sampled_texture_type,...x.multisampled_texture_type,...x.storage_texture_type,...x.depth_texture_type,...x.texture_external_type];T.texel_format=[x.keywords.r8unorm,x.keywords.r8snorm,x.keywords.r8uint,x.keywords.r8sint,x.keywords.r16uint,x.keywords.r16sint,x.keywords.r16float,x.keywords.rg8unorm,x.keywords.rg8snorm,x.keywords.rg8uint,x.keywords.rg8sint,x.keywords.r32uint,x.keywords.r32sint,x.keywords.r32float,x.keywords.rg16uint,x.keywords.rg16sint,x.keywords.rg16float,x.keywords.rgba8unorm,x.keywords.rgba8unorm_srgb,x.keywords.rgba8snorm,x.keywords.rgba8uint,x.keywords.rgba8sint,x.keywords.bgra8unorm,x.keywords.bgra8unorm_srgb,x.keywords.rgb10a2unorm,x.keywords.rg11b10float,x.keywords.rg32uint,x.keywords.rg32sint,x.keywords.rg32float,x.keywords.rgba16uint,x.keywords.rgba16sint,x.keywords.rgba16float,x.keywords.rgba32uint,x.keywords.rgba32sint,x.keywords.rgba32float];T.const_literal=[x.tokens.int_literal,x.tokens.uint_literal,x.tokens.decimal_float_literal,x.tokens.hex_float_literal,x.keywords.true,x.keywords.false];T.literal_or_ident=[x.tokens.ident,x.tokens.int_literal,x.tokens.uint_literal,x.tokens.decimal_float_literal,x.tokens.hex_float_literal];T.element_count_expression=[x.tokens.int_literal,x.tokens.uint_literal,x.tokens.ident];T.template_types=[x.keywords.vec2,x.keywords.vec3,x.keywords.vec4,x.keywords.mat2x2,x.keywords.mat2x3,x.keywords.mat2x4,x.keywords.mat3x2,x.keywords.mat3x3,x.keywords.mat3x4,x.keywords.mat4x2,x.keywords.mat4x3,x.keywords.mat4x4,x.keywords.atomic,x.keywords.bitcast,...x.any_texture_type];T.attribute_name=[x.tokens.ident,x.keywords.block,x.keywords.diagnostic];T.assignment_operators=[x.tokens.equal,x.tokens.plus_equal,x.tokens.minus_equal,x.tokens.times_equal,x.tokens.division_equal,x.tokens.modulo_equal,x.tokens.and_equal,x.tokens.or_equal,x.tokens.xor_equal,x.tokens.shift_right_equal,x.tokens.shift_left_equal];T.increment_operators=[x.tokens.plus_plus,x.tokens.minus_minus];class i_{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return T.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==T.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class lC{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new i_(T.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=T.simpleTokens[e];if(n)return this._addToken(n),!0;let r=T.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=T.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(T.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(T.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(T.tokens.minus_minus),!0;const l=this._tokens.length-1;if((T.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==T.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&T.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===T.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===T.none){let l=e,c=0;const u=2;for(let h=0;h<u;++h)if(l+=this._peekAhead(h),o=this._findType(l),o!==T.none){c=h;break}if(o===T.none)return r===T.none?!1:(this._current--,this._addToken(r),!0);e=l,this._current+=c+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r===T.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in T.regexTokens){const i=T.regexTokens[r];if(this._match(e,i.rule))return i}const n=T.literalTokens[e];return n||T.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new i_(e,n,this._line))}}class cC{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new O3,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Oh){const a=s.name,l=this._context.constants.get(a);if(l)try{const c=l.evaluate(this._context);i.count=c}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new lC(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==T.eof}_match(e){if(e instanceof P)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(T.tokens.semicolon)&&!this._isAtEnd(););if(this._match(T.keywords.alias)){const n=this._type_alias();return this._consume(T.tokens.semicolon,"Expected ';'"),n}if(this._match(T.keywords.diagnostic)){const n=this._diagnostic();return this._consume(T.tokens.semicolon,"Expected ';'"),n}if(this._match(T.keywords.requires)){const n=this._requires_directive();return this._consume(T.tokens.semicolon,"Expected ';'"),n}if(this._match(T.keywords.enable)){const n=this._enable_directive();return this._consume(T.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(T.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(T.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(T.keywords.fn))return null;const e=this._currentLine,n=this._consume(T.tokens.ident,"Expected function name.").toString();this._consume(T.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(T.tokens.paren_right))do{if(this._check(T.tokens.paren_right))break;const a=this._attribute(),l=this._consume(T.tokens.ident,"Expected argument name.").toString();this._consume(T.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,r.push(new iC(l,u,a)))}while(this._match(T.tokens.comma));this._consume(T.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(T.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return new Nh(n,r,i,s,e,o)}_compound_statement(){const e=[];for(this._consume(T.tokens.brace_left,"Expected '{' for block.");!this._check(T.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(T.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(T.tokens.semicolon)&&!this._isAtEnd(););if(this._check(T.tokens.attr)&&this._attribute(),this._check(T.keywords.if))return this._if_statement();if(this._check(T.keywords.switch))return this._switch_statement();if(this._check(T.keywords.loop))return this._loop_statement();if(this._check(T.keywords.for))return this._for_statement();if(this._check(T.keywords.while))return this._while_statement();if(this._check(T.keywords.continuing))return this._continuing_statement();if(this._check(T.keywords.static_assert))return this._static_assert_statement();if(this._check(T.tokens.brace_left))return this._compound_statement();let e=null;return this._check(T.keywords.return)?e=this._return_statement():this._check([T.keywords.var,T.keywords.let,T.keywords.const])?e=this._variable_statement():this._match(T.keywords.discard)?e=new K3:this._match(T.keywords.break)?e=new q3:this._match(T.keywords.continue)?e=new Z3:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(T.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(T.keywords.static_assert))return null;const e=this._optional_paren_expression();return new F3(e)}_while_statement(){if(!this._match(T.keywords.while))return null;const e=this._optional_paren_expression();this._check(T.tokens.attr)&&this._attribute();const n=this._compound_statement();return new D3(e,n)}_continuing_statement(){if(!this._match(T.keywords.continuing))return null;const e=this._compound_statement();return new U3(e)}_for_statement(){if(!this._match(T.keywords.for))return null;this._consume(T.tokens.paren_left,"Expected '('.");const e=this._check(T.tokens.semicolon)?null:this._for_init();this._consume(T.tokens.semicolon,"Expected ';'.");const n=this._check(T.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(T.tokens.semicolon,"Expected ';'.");const r=this._check(T.tokens.paren_right)?null:this._for_increment();this._consume(T.tokens.paren_right,"Expected ')'."),this._check(T.tokens.attr)&&this._attribute();const i=this._compound_statement();return new B3(e,n,r,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(T.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(T.tokens.equal)&&(n=this._short_circuit_or_expression()),new cr(e.name,e.type,e.storage,e.access,n)}if(this._match(T.keywords.let)){const e=this._consume(T.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(T.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(T.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new kh(e,n,null,null,r)}if(this._match(T.keywords.const)){const e=this._consume(T.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(T.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(T.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new Gg(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(T.increment_operators))return this._current=e,null;const r=this._consume(T.increment_operators,"Expected increment operator");return new L3(r.type===T.tokens.plus_plus?Oi.increment:Oi.decrement,n)}_assignment_statement(){let e=null;if(this._check(T.tokens.brace_right))return null;let n=this._match(T.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(T.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new V3(ro.parse(r.lexeme),e,i)}_func_call_statement(){if(!this._check(T.tokens.ident))return null;const e=this._current,n=this._consume(T.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new Rv(n.lexeme,r)}_loop_statement(){if(!this._match(T.keywords.loop))return null;this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.push(i);else e.push(n);n=this._statement()}let r=null;return this._match(T.keywords.continuing)&&(r=this._compound_statement()),this._consume(T.tokens.brace_right,"Expected '}' for loop."),new z3(e,r)}_switch_statement(){if(!this._match(T.keywords.switch))return null;const e=this._optional_paren_expression();this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(T.tokens.brace_right,"Expected '}' for switch."),new j3(e,n)}_switch_body(){const e=[];if(this._match(T.keywords.case)){const n=this._case_selectors();this._match(T.tokens.colon),this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(T.tokens.brace_right,"Exected '}' for switch case."),e.push(new nC(n,r))}if(this._match(T.keywords.default)){this._match(T.tokens.colon),this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(T.tokens.brace_right,"Exected '}' for switch default."),e.push(new rC(n))}if(this._check([T.keywords.default,T.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(T.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(T.keywords.fallthrough))return this._consume(T.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(T.keywords.if))return null;const e=this._optional_paren_expression();this._check(T.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(T.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(T.keywords.else)&&(this._check(T.tokens.attr)&&this._attribute(),i=this._compound_statement()),new H3(e,n,r,i)}_match_elseif(){return this._tokens[this._current].type===T.keywords.else&&this._tokens[this._current+1].type===T.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new sC(n,r)),this._match_elseif()&&(this._check(T.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(T.keywords.return))return null;const e=this._short_circuit_or_expression();return new W3(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(T.tokens.or_or);)e=new Vt(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(T.tokens.and_and);)e=new Vt(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(T.tokens.or);)e=new Vt(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(T.tokens.xor);)e=new Vt(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(T.tokens.and);)e=new Vt(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([T.tokens.equal_equal,T.tokens.not_equal])?new Vt(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([T.tokens.less_than,T.tokens.greater_than,T.tokens.less_than_equal,T.tokens.greater_than_equal]);)e=new Vt(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([T.tokens.shift_left,T.tokens.shift_right]);)e=new Vt(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([T.tokens.plus,T.tokens.minus]);)e=new Vt(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([T.tokens.star,T.tokens.forward_slash,T.tokens.modulo]);)e=new Vt(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([T.tokens.minus,T.tokens.bang,T.tokens.tilde,T.tokens.star,T.tokens.and])?new tC(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(T.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(T.tokens.bracket_right,"Expected ']'.");const n=new eC(e),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(T.tokens.period)){const e=this._consume(T.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new e_(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(T.tokens.ident)){const r=this._previous().toString();if(this._check(T.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new ai(s,i):new xv(r,i)}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return new t_(r,i.value)}return new Oh(r)}if(this._match(T.const_literal))return new n_(parseFloat(this._previous().toString()));if(this._check(T.tokens.paren_left))return this._paren_expression();if(this._match(T.keywords.bitcast)){this._consume(T.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(T.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new J3(r,i)}const e=this._type_decl(),n=this._argument_expression_list();return new G3(e,n)}_argument_expression_list(){if(!this._match(T.tokens.paren_left))return null;const e=[];do{if(this._check(T.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(T.tokens.comma));return this._consume(T.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(T.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(T.tokens.paren_right),new r_([e])}_paren_expression(){this._consume(T.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(T.tokens.paren_right,"Expected ')'."),new r_([e])}_struct_decl(){if(!this._match(T.keywords.struct))return null;const e=this._currentLine,n=this._consume(T.tokens.ident,"Expected name for struct.").toString();this._consume(T.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(T.tokens.brace_right);){const o=this._attribute(),a=this._consume(T.tokens.ident,"Expected variable name.").toString();this._consume(T.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(T.tokens.brace_right)?this._match(T.tokens.comma):this._consume(T.tokens.comma,"Expected ',' for struct member."),r.push(new oC(a,c,o))}this._consume(T.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=new lr(n,r,e,i);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(T.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(T.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(T.keywords.const))return null;const e=this._consume(T.tokens.ident,"Expected variable name");let n=null;if(this._match(T.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(T.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof ai)r=s;else if(s instanceof t_&&s.initializer instanceof ai)r=s.initializer;else try{const o=s.evaluate(this._context);r=new n_(o)}catch{r=s}}const i=new Gg(e.toString(),n,"","",r);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(T.keywords.let))return null;const e=this._consume(T.tokens.ident,"Expected variable name");let n=null;if(this._match(T.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;return this._match(T.tokens.equal)&&(r=this._const_expression()),new kh(e.toString(),n,"","",r)}_const_expression(){if(this._match(T.const_literal))return new e_(this._previous().toString());const e=this._type_decl();this._consume(T.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(T.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(T.tokens.comma));)this._advance();return this._consume(T.tokens.paren_right,"Expected ')'."),new ai(e,n)}_variable_decl(){if(!this._match(T.keywords.var))return null;let e="",n="";this._match(T.tokens.less_than)&&(e=this._consume(T.storage_class,"Expected storage_class.").toString(),this._match(T.tokens.comma)&&(n=this._consume(T.access_mode,"Expected access_mode.").toString()),this._consume(T.tokens.greater_than,"Expected '>'."));const r=this._consume(T.tokens.ident,"Expected variable name");let i=null;if(this._match(T.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return new cr(r.toString(),i,e,n,null)}_override_decl(){if(!this._match(T.keywords.override))return null;const e=this._consume(T.tokens.ident,"Expected variable name");let n=null;if(this._match(T.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new Av(e.toString(),n,null)}_diagnostic(){this._consume(T.tokens.paren_left,"Expected '('");const e=this._consume(T.tokens.ident,"Expected severity control name.");this._consume(T.tokens.comma,"Expected ','");const n=this._consume(T.tokens.ident,"Expected diagnostic rule name.");return this._consume(T.tokens.paren_right,"Expected ')'"),new Y3(e.toString(),n.toString())}_enable_directive(){const e=this._consume(T.tokens.ident,"identity expected.");return new $3(e.toString())}_requires_directive(){const e=[this._consume(T.tokens.ident,"identity expected.").toString()];for(;this._match(T.tokens.comma);){const n=this._consume(T.tokens.ident,"identity expected.");e.push(n.toString())}return new X3(e)}_type_alias(){const e=this._consume(T.tokens.ident,"identity expected.");this._consume(T.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new bv(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([T.tokens.ident,...T.texel_format,T.keywords.bool,T.keywords.f32,T.keywords.i32,T.keywords.u32])){const r=this._advance(),i=r.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new Dr(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(T.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(T.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(T.tokens.comma)&&(s=this._consume(T.access_mode,"Expected access_mode for pointer").toString()),this._consume(T.tokens.greater_than,"Expected '>' for type.")),new Cv(r,i,s)}if(this._match(T.keywords.ptr)){let r=this._previous().toString();this._consume(T.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(T.storage_class,"Expected storage_class for pointer");this._consume(T.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(T.tokens.comma)&&(o=this._consume(T.access_mode,"Expected access_mode for pointer").toString()),this._consume(T.tokens.greater_than,"Expected '>' for pointer."),new Q3(r,i.toString(),s,o)}const n=this._attribute();if(this._match(T.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(T.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let l="";if(this._match(T.tokens.comma)){o=this._shift_expression();try{l=o.evaluate(this._context).toString(),o=null}catch{l="1"}}this._consume(T.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}const a=new Pv(s.toString(),n,r,i);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(T.sampler_type))return new ys(this._previous().toString(),null,null);if(this._match(T.depth_texture_type))return new ys(this._previous().toString(),null,null);if(this._match(T.sampled_texture_type)||this._match(T.multisampled_texture_type)){const e=this._previous();this._consume(T.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(T.tokens.greater_than,"Expected '>' for sampler type."),new ys(e.toString(),n,null)}if(this._match(T.storage_texture_type)){const e=this._previous();this._consume(T.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(T.texel_format,"Invalid texel format.").toString();this._consume(T.tokens.comma,"Expected ',' after texel format.");const r=this._consume(T.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(T.tokens.greater_than,"Expected '>' for sampler type."),new ys(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(T.tokens.attr);){const n=this._consume(T.attribute_name,"Expected attribute name"),r=new aC(n.toString(),null);if(this._match(T.tokens.paren_left)){if(r.value=this._consume(T.literal_or_ident,"Expected attribute value").toString(),this._check(T.tokens.comma)){this._advance();do{const i=this._consume(T.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(T.tokens.comma))}this._consume(T.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Ei{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class s_{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Jo extends Ei{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class tu extends Ei{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class o_ extends Ei{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}}var xn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(xn||(xn={}));class Go{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class uC{constructor(e,n){this.name=e,this.type=n}}class ea{constructor(e,n){this.align=e,this.size=n}}class hC{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class a_{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class fC{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class dC{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class pC{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class gC{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class fn{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new dC,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new cC().parse(e);for(const i of r)i instanceof Nh&&this._functions.set(i.name,new gC(i));for(const i of r)if(i instanceof lr){const s=this._getTypeInfo(i,null);s instanceof Jo&&this.structs.push(s)}for(const i of r){if(i instanceof bv){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof Av){const s=i,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new pC(s.name,a,s.attributes,o));continue}if(this._isUniformVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new Go(s.name,l,o,a,s.attributes,xn.Uniform,s.access);this.uniforms.push(c);continue}if(this._isStorageVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new Go(s.name,l,o,a,s.attributes,c?xn.StorageTexture:xn.Storage,s.access);this.storage.push(u);continue}if(this._isTextureVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new Go(s.name,l,o,a,s.attributes,c?xn.StorageTexture:xn.Texture,s.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new Go(s.name,l,o,a,s.attributes,xn.Sampler,s.access);this.samplers.push(c);continue}if(i instanceof Nh){const s=this._getAttribute(i,"vertex"),o=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=s||o||a,c=new fC(i.name,l==null?void 0:l.name);c.startLine=i.startLine,c.endLine=i.endLine,this.functions.push(c),this._functions.get(i.name).info=c,l&&(this._functions.get(i.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(i,!!l),c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(c));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n){for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof ll)s.push({});else if(o instanceof cl)s.pop();else if(o instanceof cr){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof ai){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof kh){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Oh){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const l=i._findResource(a.name);l&&r.push(l)}else if(o instanceof xv){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}else if(o instanceof Rv){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof lr)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof lr)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new a_(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new a_("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof lr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof lr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new hC(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new uC(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof Pv){const i=e,s=this._getTypeInfo(i.format,i.attributes),o=new tu(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof lr){const i=e,s=new Jo(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new s_(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof ys){const i=e,s=i.format instanceof Dr,o=i.format?s?this._getTypeInfo(i.format,null):new Ei(i.format,null):null,a=new o_(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Cv){const i=e,s=i.format?this._getTypeInfo(i.format,null):null,o=new o_(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new Ei(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const i=this._getTypeSize(e);if(e.size=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,e instanceof tu){const s=this._getTypeSize(e.format);e.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof Jo&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const h=u.align,f=u.size;r=this._roundUp(h,r+i),i=f,s=r,o=Math.max(o,h),c.offset=r,c.size=f,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof s_&&(e=e.type),e instanceof Ei){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=fn._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new ea(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=fn._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new ea(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof tu){let o=e,a=8,l=8;const c=this._getTypeSize(o.format);c!==null&&(l=c.size,a=c.align);const u=o.count,h=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,l));return l=u*h,i&&(l=i),new ea(Math.max(s,a),Math.max(i,l))}if(e instanceof Jo){let o=0,a=0,l=0,c=0,u=0;for(const h of e.members){const f=this._getTypeSize(h.type);f!==null&&(o=Math.max(f.align,o),l=this._roundUp(f.align,l+c),c=f.size,u=l)}return a=this._roundUp(o,u+c),new ea(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof cr&&e.storage=="uniform"}_isStorageVar(e){return e instanceof cr&&e.storage=="storage"}_isTextureVar(e){return e instanceof cr&&e.type!==null&&fn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof cr&&e.type!==null&&fn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}fn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};fn._textureTypes=T.any_texture_type.map(t=>t.name);fn._samplerTypes=T.sampler_type.map(t=>t.name);function _C(t){var s;const e={attributes:[],bindings:[]};let n;try{n=mC(t)}catch(o){return B.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const l of((s=o.type)==null?void 0:s.members)||[])a.push({name:l.name,type:l_(l.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const l=l_(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function l_(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function mC(t){try{return new fn(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const yC=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,vC={name:"fp32",vs:yC},TC=[0,1,1,1],EC=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,wC=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,c_={name:"picking",vs:EC,fs:wC,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:TC},getUniforms:SC};function SC(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}function Nv(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function AC(t){return t-Math.fround(t)}function RC(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;Nv(t[r*4+n],e,i*2)}return e}const bC=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,CC={ONE:1};function PC(){return CC}const xC={name:"fp64-arithmetic",vs:bC,getUniforms:PC,fp64ify:Nv,fp64LowPart:AC,fp64ifyMatrix4:RC},IC={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...IC}};const lt=globalThis.mathgl.config;function MC(t,{precision:e=lt.precision}={}){return t=NC(t),`${parseFloat(t.toPrecision(e))}`}function Fi(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Fn(t,e,n){return OC(t,r=>Math.max(e,Math.min(n,r)))}function ul(t,e,n){return Fi(t)?t.map((r,i)=>ul(r,e[i],n)):n*e+(1-n)*t}function io(t,e,n){const r=lt.EPSILON;n&&(lt.EPSILON=n);try{if(t===e)return!0;if(Fi(t)&&Fi(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!io(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=lt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{lt.EPSILON=r}}function NC(t){return Math.round(t/lt.EPSILON)*lt.EPSILON}function kC(t){return t.clone?t.clone():new Array(t.length)}function OC(t,e,n){if(Fi(t)){const r=t;n=n||kC(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class kv extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Fi(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(lt)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+MC(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!io(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(lt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function FC(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ot(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function nu(t,e,n=""){if(lt.debug&&!FC(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function u_(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class DC extends kv{get x(){return this[0]}set x(e){this[0]=ot(e)}get y(){return this[1]}set y(e){this[1]=ot(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return ot(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return ot(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return u_(e>=0&&e<this.ELEMENTS,"index is out of range"),ot(this[e])}setComponent(e,n){return u_(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const Sa=1e-6;let Di=typeof Float32Array<"u"?Float32Array:Array;function UC(){const t=new Di(2);return Di!=Float32Array&&(t[0]=0,t[1]=0),t}function h_(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function BC(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Ov(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function LC(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=UC();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function VC(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function Fv(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function zC(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function jC(){const t=new Di(3);return Di!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function HC(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function WC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function $C(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function XC(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function Dv(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function YC(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function KC(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=i*c-s*l,h=s*a-r*c,f=r*l-i*a,m=i*f-s*h,E=s*u-r*f,w=r*h-i*u;const S=o*2;return u*=S,h*=S,f*=S,m*=2,E*=2,w*=2,t[0]=a+u+m,t[1]=l+h+E,t[2]=c+f+w,t}function qC(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function ZC(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function QC(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function JC(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),c=l&&$C(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const GC=HC;(function(){const t=jC();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const ru=[0,0,0];let ta;class Gt extends DC{static get ZERO(){return ta||(ta=new Gt(0,0,0),Object.freeze(ta)),ta}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Fi(e)?this.copy(e):(lt.debug&&(ot(e),ot(n),ot(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return lt.debug&&(ot(e.x),ot(e.y),ot(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ot(e)}angle(e){return JC(this,e)}cross(e){return XC(this,this,e),this.check()}rotateX({radians:e,origin:n=ru}){return qC(this,this,n,e),this.check()}rotateY({radians:e,origin:n=ru}){return ZC(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=ru}){return QC(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Dv(this,this,e),this.check()}transformAsVector(e){return Fv(this,this,e),this.check()}transformByMatrix3(e){return YC(this,this,e),this.check()}transformByMatrix2(e){return zC(this,this,e),this.check()}transformByQuaternion(e){return KC(this,this,e),this.check()}}class eP extends kv{toString(){let e="[";if(lt.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=ot(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function tP(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nP(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Fh(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],m=e[11],E=e[12],w=e[13],S=e[14],_=e[15],d=n*a-r*o,y=n*l-i*o,A=n*c-s*o,b=r*l-i*a,I=r*c-s*a,k=i*c-s*l,M=u*w-h*E,O=u*S-f*E,F=u*_-m*E,V=h*S-f*w,z=h*_-m*w,X=f*_-m*S;let $=d*X-y*z+A*V+b*F-I*O+k*M;return $?($=1/$,t[0]=(a*X-l*z+c*V)*$,t[1]=(i*z-r*X-s*V)*$,t[2]=(w*k-S*I+_*b)*$,t[3]=(f*I-h*k-m*b)*$,t[4]=(l*F-o*X-c*O)*$,t[5]=(n*X-i*F+s*O)*$,t[6]=(S*A-E*k-_*y)*$,t[7]=(u*k-f*A+m*y)*$,t[8]=(o*z-a*F+c*M)*$,t[9]=(r*F-n*z-s*M)*$,t[10]=(E*I-w*A+_*d)*$,t[11]=(h*A-u*I-m*d)*$,t[12]=(a*O-o*V-l*M)*$,t[13]=(n*V-r*O+i*M)*$,t[14]=(w*y-E*b-S*d)*$,t[15]=(u*b-h*y+f*d)*$,t):null}function rP(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11],m=t[12],E=t[13],w=t[14],S=t[15],_=e*o-n*s,d=e*a-r*s,y=n*a-r*o,A=c*E-u*m,b=c*w-h*m,I=u*w-h*E,k=e*I-n*b+r*A,M=s*I-o*b+a*A,O=c*y-u*d+h*_,F=m*y-E*d+w*_;return l*k-i*M+S*O-f*F}function Er(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],m=e[10],E=e[11],w=e[12],S=e[13],_=e[14],d=e[15];let y=n[0],A=n[1],b=n[2],I=n[3];return t[0]=y*r+A*a+b*h+I*w,t[1]=y*i+A*l+b*f+I*S,t[2]=y*s+A*c+b*m+I*_,t[3]=y*o+A*u+b*E+I*d,y=n[4],A=n[5],b=n[6],I=n[7],t[4]=y*r+A*a+b*h+I*w,t[5]=y*i+A*l+b*f+I*S,t[6]=y*s+A*c+b*m+I*_,t[7]=y*o+A*u+b*E+I*d,y=n[8],A=n[9],b=n[10],I=n[11],t[8]=y*r+A*a+b*h+I*w,t[9]=y*i+A*l+b*f+I*S,t[10]=y*s+A*c+b*m+I*_,t[11]=y*o+A*u+b*E+I*d,y=n[12],A=n[13],b=n[14],I=n[15],t[12]=y*r+A*a+b*h+I*w,t[13]=y*i+A*l+b*f+I*S,t[14]=y*s+A*c+b*m+I*_,t[15]=y*o+A*u+b*E+I*d,t}function hl(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,c,u,h,f,m,E,w,S,_;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],f=e[6],m=e[7],E=e[8],w=e[9],S=e[10],_=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=f,t[7]=m,t[8]=E,t[9]=w,t[10]=S,t[11]=_,t[12]=o*r+u*i+E*s+e[12],t[13]=a*r+h*i+w*s+e[13],t[14]=l*r+f*i+S*s+e[14],t[15]=c*r+m*i+_*s+e[15]),t}function ud(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function iP(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,c,u,h,f,m,E,w,S,_,d,y,A,b,I,k,M,O,F,V,z,X,$,G;return a<Sa?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,h=e[0],f=e[1],m=e[2],E=e[3],w=e[4],S=e[5],_=e[6],d=e[7],y=e[8],A=e[9],b=e[10],I=e[11],k=i*i*u+l,M=s*i*u+o*c,O=o*i*u-s*c,F=i*s*u-o*c,V=s*s*u+l,z=o*s*u+i*c,X=i*o*u+s*c,$=s*o*u-i*c,G=o*o*u+l,t[0]=h*k+w*M+y*O,t[1]=f*k+S*M+A*O,t[2]=m*k+_*M+b*O,t[3]=E*k+d*M+I*O,t[4]=h*F+w*V+y*z,t[5]=f*F+S*V+A*z,t[6]=m*F+_*V+b*z,t[7]=E*F+d*V+I*z,t[8]=h*X+w*$+y*G,t[9]=f*X+S*$+A*G,t[10]=m*X+_*$+b*G,t[11]=E*X+d*$+I*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Uv(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+h*r,t[7]=l*i+f*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=h*i-a*r,t[11]=f*i-l*r,t}function sP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-h*r,t[3]=l*i-f*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+h*i,t[11]=l*r+f*i,t}function Bv(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+h*r,t[3]=l*i+f*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=h*i-a*r,t[7]=f*i-l*r,t}function oP(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,h=r*a,f=i*o,m=i*a,E=i*l,w=s*o,S=s*a,_=s*l;return t[0]=1-h-E,t[1]=u+_,t[2]=f-S,t[3]=0,t[4]=u-_,t[5]=1-c-E,t[6]=m+w,t[7]=0,t[8]=f+S,t[9]=m-w,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function aP(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function lP(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const cP=lP;function uP(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}const hP=uP;function fP(t,e,n,r){let i,s,o,a,l,c,u,h,f,m;const E=e[0],w=e[1],S=e[2],_=r[0],d=r[1],y=r[2],A=n[0],b=n[1],I=n[2];return Math.abs(E-A)<Sa&&Math.abs(w-b)<Sa&&Math.abs(S-I)<Sa?tP(t):(h=E-A,f=w-b,m=S-I,i=1/Math.sqrt(h*h+f*f+m*m),h*=i,f*=i,m*=i,s=d*m-y*f,o=y*h-_*m,a=_*f-d*h,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=f*a-m*o,c=m*s-h*a,u=h*o-f*s,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=m,t[11]=0,t[12]=-(s*E+o*w+a*S),t[13]=-(l*E+c*w+u*S),t[14]=-(h*E+f*w+m*S),t[15]=1,t)}function dP(){const t=new Di(4);return Di!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function pP(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function To(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=dP();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Dh;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Dh||(Dh={}));const gP=45*Math.PI/180,_P=1,iu=.1,su=500,mP=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class en extends eP{static get IDENTITY(){return vP()}static get ZERO(){return yP()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Dh}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,h,f,m,E,w,S){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=h,this[11]=f,this[12]=m,this[13]=E,this[14]=w,this[15]=S,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,h,f,m,E,w,S){return this[0]=e,this[1]=s,this[2]=c,this[3]=m,this[4]=n,this[5]=o,this[6]=u,this[7]=E,this[8]=r,this[9]=a,this[10]=h,this[11]=w,this[12]=i,this[13]=l,this[14]=f,this[15]=S,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(mP)}fromObject(e){return this.check()}fromQuaternion(e){return oP(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=iu,far:a=su}=e;return a===1/0?TP(this,n,r,i,s,o):aP(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return fP(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=iu,far:a=su}=e;return hP(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=gP,aspect:r=_P,focalDistance:i=1,near:s=iu,far:o=su}=e;f_(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return f_(n),cP(this,n,r,i,s),this.check()}determinant(){return rP(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return nP(this,this),this.check()}invert(){return Fh(this,this),this.check()}multiplyLeft(e){return Er(this,e,this),this.check()}multiplyRight(e){return Er(this,this,e),this.check()}rotateX(e){return Uv(this,this,e),this.check()}rotateY(e){return sP(this,this,e),this.check()}rotateZ(e){return Bv(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return iP(this,this,e,n),this.check()}scale(e){return ud(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return hl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=To(n||[-0,-0,-0,-0],e,this),nu(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=LC(n||[-0,-0],e,this);break;case 3:i=Dv(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return nu(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=VC(n||[-0,-0],e,this);break;case 3:r=Fv(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return nu(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let na,ra;function yP(){return na||(na=new en([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(na)),na}function vP(){return ra||(ra=new en,Object.freeze(ra)),ra}function f_(t){if(t>Math.PI*2)throw Error("expected radians")}function TP(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,h=-1,f=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}const d_=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,EP={lightSources:{}};function ou(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/255)}function wP({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=ou(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((i,s)=>{r[`lighting_uPointLight[${s}].color`]=ou(i),r[`lighting_uPointLight[${s}].position`]=i.position,r[`lighting_uPointLight[${s}].attenuation`]=i.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,n.forEach((i,s)=>{r[`lighting_uDirectionalLight[${s}].color`]=ou(i),r[`lighting_uDirectionalLight[${s}].direction`]=i.direction}),r.lighting_uDirectionalLightCount=n.length,r}function Lv(t=EP){var e,n;if("lightSources"in t){const{ambientLight:r,pointLights:i,directionalLights:s}=t.lightSources||{};return r||i&&i.length>0||s&&s.length>0?Object.assign({},wP({ambientLight:r,pointLights:i,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const i of t.lights||[])switch(i.type){case"ambient":r.ambientLight=i;break;case"directional":(e=r.directionalLights)==null||e.push(i);break;case"point":(n=r.pointLights)==null||n.push(i);break}return Lv({lightSources:r})}return{}}const Vv={name:"lights",vs:d_,fs:d_,getUniforms:Lv,defines:{MAX_LIGHTS:3}},zv=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,SP={};function AP(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(s=>s/255)}}function jv(t=SP){if(!("material"in t))return{};const{material:e}=t;return e?AP(e):{lighting_uEnabled:!1}}const RP={name:"gouraud-lighting",dependencies:[Vv],vs:zv,defines:{LIGHTING_VERTEX:1},getUniforms:jv},bP={name:"phong-lighting",dependencies:[Vv],fs:zv,defines:{LIGHTING_FRAGMENT:1},getUniforms:jv},Hv="#define SMOOTH_EDGE_RADIUS 0.5",CP=`
${Hv}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,PP=`
${Hv}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,xP={name:"geometry",vs:CP,fs:PP},te={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(te,"IDENTITY",{get:()=>(ne.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Kt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},fl={common:0,meters:1,pixels:2},Uh={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},IP=Object.keys(te).map(t=>`const int COORDINATE_SYSTEM_${t} = ${te[t]};`).join(""),MP=Object.keys(Kt).map(t=>`const int PROJECTION_MODE_${t} = ${Kt[t]};`).join(""),NP=Object.keys(fl).map(t=>`const int UNIT_${t.toUpperCase()} = ${fl[t]};`).join(""),kP=`${IP}
${MP}
${NP}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function OP(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Eo(t){let e={},n;return r=>{for(const i in r)if(!OP(r[i],e[i])){n=t(r),e=r;break}return n}}const p_=[0,0,0,0],FP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Wv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],DP=[0,0,0],$v=[0,0,0],UP=Eo(VP);function Xv(t,e,n=$v){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===te.LNGLAT_OFFSETS||e===te.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Kt.WEB_MERCATOR:(e===te.LNGLAT||e===te.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Kt.WEB_MERCATOR_AUTO_OFFSET:e===te.LNGLAT?r=i:e===te.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Kt.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Kt.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function BP(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=p_,l=p_,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=Xv(t,e,n);return f&&(l=t.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=To([],l,o),s=r||s,o=Er([],i,s),o=Er([],o,FP)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}function LP({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=te.DEFAULT,coordinateOrigin:i=$v,autoWrapLongitude:s=!1}){r===te.DEFAULT&&(r=t.isGeospatial?te.LNGLAT:te.CARTESIAN);const o=UP({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||Wv,o}function VP({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=BP(t,n,r),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=To([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,m={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:DP,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Wv,project_uCameraPosition:a};if(c){const E=t.getDistanceScales(c);switch(n){case te.METER_OFFSETS:m.project_uCommonUnitsPerWorldUnit=E.unitsPerMeter,m.project_uCommonUnitsPerWorldUnit2=E.unitsPerMeter2;break;case te.LNGLAT:case te.LNGLAT_OFFSETS:t._pseudoMeters||(m.project_uCommonUnitsPerMeter=E.unitsPerMeter),m.project_uCommonUnitsPerWorldUnit=E.unitsPerDegree,m.project_uCommonUnitsPerWorldUnit2=E.unitsPerDegree2;break;case te.CARTESIAN:m.project_uCommonUnitsPerWorldUnit=[1,1,E.unitsPerMeter[2]],m.project_uCommonUnitsPerWorldUnit2=[0,0,E.unitsPerMeter2[2]];break}}return m}const zP={};function jP(t=zP){return"viewport"in t?LP(t):{}}const hd={name:"project",dependencies:[vC,xP],vs:kP,getUniforms:jP},HP=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,WP={name:"project32",dependencies:[hd],vs:HP};function $P(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wi(t,e){const n=To([],e,t);return pP(n,n,1/n[3]),n}function g_(t,e){const n=t%e;return n<0?e+n:n}function Bh(t,e,n){return t<e?e:t>n?n:t}function XP(t){return Math.log(t)*Math.LOG2E}const fd=Math.log2||XP;function yn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const It=Math.PI,Yv=It/4,Et=It/180,Lh=180/It,Ui=512,dl=4003e4,ia=85.051129,YP=1.5;function KP(t){return fd(t)}function pl(t){const[e,n]=t;yn(Number.isFinite(e)),yn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Et,i=n*Et,s=Ui*(r+It)/(2*It),o=Ui*(It+Math.log(Math.tan(Yv+i*.5)))/(2*It);return[s,o]}function Bi(t){const[e,n]=t,r=e/Ui*(2*It)-It,i=2*(Math.atan(Math.exp(n/Ui*(2*It)-It))-Yv);return[r*Lh,i*Lh]}function qP(t){const{latitude:e}=t;yn(Number.isFinite(e));const n=Math.cos(e*Et);return KP(dl*n)-9}function au(t){const e=Math.cos(t*Et);return Ui/dl/e}function Vh(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;yn(Number.isFinite(e)&&Number.isFinite(n));const i=Ui,s=Math.cos(e*Et),o=i/360,a=o/s,l=i/dl/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=Et*Math.tan(e*Et)/s,h=o*u/2,f=i/dl*u,m=f/a*l;c.unitsPerDegree2=[0,h,f],c.unitsPerMeter2=[m,0,m]}return c}function Kv(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Vh({longitude:n,latitude:r,highPrecision:!0}),u=pl(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=Bi(u),f=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[h[0],h[1],f]:h}function ZP(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=$P();hl(a,a,[0,0,-i]),Uv(a,a,-n*Et),Bv(a,a,r*Et);const l=s/e;return ud(a,a,[l,l,l]),o&&hl(a,a,WC([],o)),a}function QP(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=gl(YP)}=t;r!==void 0&&(u=gl(r));const h=u*Et,f=i*Et,m=qv(u);let E=m;o&&(E+=o[2]*a/Math.cos(f)/n);const w=h*(.5+(s?s[1]:0)/n),S=Math.sin(w)*E/Math.sin(Bh(Math.PI/2-f-w,.01,Math.PI-.01)),_=Math.sin(f)*S+E,d=E*10,y=Math.min(_*c,d);return{fov:h,aspect:e/n,focalDistance:m,near:l,far:y}}function gl(t){return 2*Math.atan(.5/t)*Lh}function qv(t){return .5/Math.tan(.5*t*Et)}function Zv(t,e){const[n,r,i=0]=t;return yn(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),wi(e,[n,r,i,1])}function dd(t,e,n=0){const[r,i,s]=t;if(yn(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return wi(e,[r,i,s,1]);const o=wi(e,[r,i,0,1]),a=wi(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return Ov([],o,a,u)}function JP(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,h=GP(t.padding),f=pl([a,Bh(u,-ia,ia)]),m=pl([c,Bh(l,-ia,ia)]),E=[Math.max(Math.abs(m[0]-f[0]),i),Math.max(Math.abs(m[1]-f[1]),i)],w=[e-h.left-h.right-Math.abs(o[0])*2,n-h.top-h.bottom-Math.abs(o[1])*2];yn(w[0]>0&&w[1]>0);const S=w[0]/E[0],_=w[1]/E[1],d=(h.right-h.left)/2/S,y=(h.top-h.bottom)/2/_,A=[(m[0]+f[0])/2+d,(m[1]+f[1])/2+y],b=Bi(A),I=Math.min(s,fd(Math.abs(Math.min(S,_))));return yn(Number.isFinite(I)),{longitude:b[0],latitude:b[1],zoom:I}}function GP(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(yn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const __=Math.PI/180;function e2(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*__:Math.atan(.5/t.altitude),h=(90-t.pitch)*__;return u>h-.01?(l=m_(t,0,e),c=m_(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function m_(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=wi(r,[e,0,1,1]),s=wi(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=Ov([],i,s,a),c=Bi(l);return c.push(n),c}const y_=512;function t2(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=g_(i+180,360)-180),(a<-180||a>180)&&(a=g_(a+180,360)-180);const l=fd(n/y_);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=Bi([0,c])[1];if(s<u)s=u;else{const h=Bi([0,y_-c])[1];s>h&&(s=h)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const n2=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,r2=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,i2=Eo(c2),s2=Eo(u2),o2=[0,0,0,1],a2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function l2(t,e){const[n,r,i]=t,s=dd([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function c2({viewport:t,center:e}){return new en(t.viewProjectionMatrix).invert().transform(e)}function u2({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>l2(o,r));for(const o of e){const a=o.clone().translate(new Gt(t.center).negate()),l=s.map(u=>a.transform(u)),c=new en().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function h2(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||o2,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=i2({viewport:t.viewport,center:e.project_uCenter}),s=[],o=s2({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new Gt(t.viewport.center).negate());e.project_uCoordinateSystem===te.LNGLAT&&e.project_uProjectionMode===Kt.WEB_MERCATOR?(o[a]=c,s[a]=i):(o[a]=l.clone().multiplyRight(a2),s[a]=c.transform(i))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=s[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const v_={name:"shadow",dependencies:[hd],vs:n2,fs:r2,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?h2(t,e):{}},f2={...c_,defaultUniforms:{...c_.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},d2=[hd],p2=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function g2(){const t=tl.getDefaultShaderAssembler();for(const e of d2)t.addDefaultModule(e);for(const e of p2)t.addShaderHook(e);return t}const _2=[255,255,255],m2=1;let y2=0;class Qv{constructor(e={}){this.type="ambient";const{color:n=_2}=e,{intensity:r=m2}=e;this.id=e.id||`ambient-${y2++}`,this.color=n,this.intensity=r}}const v2=[255,255,255],T2=1,E2=[0,0,-1];let w2=0;class T_{constructor(e={}){this.type="directional";const{color:n=v2}=e,{intensity:r=T2}=e,{direction:i=E2}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${w2++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Gt(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class S2{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class pd extends S2{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,l=e.colorMask??15,c={viewport:[0,0,n,r]};e.colorMask&&(c.colorMask=l),e.scissorRect&&(c.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end()}}_drawLayers(e,n){const{target:r,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,n),m=u.subViewports||[u];for(const E of m){const w=this._drawLayersInViewport(e,{target:r,moduleParameters:i,viewport:E,view:h,pass:n.pass,layers:n.layers},f);c.push(w)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){var E;const u=[],h=Jv(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},m={};for(let w=0;w<n.length;w++){const S=n[w],_=this._shouldDrawLayer(S,f,s,m),d={shouldDrawLayer:_};_&&!c&&(d.layerRenderIndex=h(S,_),d.moduleParameters=this._getModuleParameters(S,a,r,l),d.layerParameters={...(E=S.context.deck)==null?void 0:E.props.parameters,...this.getLayerParameters(S,w,e)}),u[w]=d}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const c=A2(this.device,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(h))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let h=0;h<n.length;h++){const f=n[h],{shouldDrawLayer:m,layerRenderIndex:E,moduleParameters:w,layerParameters:S}=l[h];if(m&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(m){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,E),w.viewport=o,f.context.renderPass=e;try{f._drawLayer({renderPass:e,moduleParameters:w,uniforms:{layerIndex:E},parameters:S})}catch(_){f.raiseError(_,`drawing ${f} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const c of n)Object.assign(o,(l=c.getModuleParameters)==null?void 0:l.call(c,e));return Object.assign(o,this.getModuleParameters(e,n),i)}}function Jv(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||Jv(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function A2(t,{moduleParameters:e,target:n,viewport:r}){const i=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}class R2 extends pd{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const b2={color:[255,255,255],intensity:1},E_=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],C2=[0,0,0,200/255];class gd{constructor(e={}){this.id="lighting-effect",this.shadowColor=C2,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(v_),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(v_))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new en().lookAt({eye:new Gt(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new R2(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new Qv(b2),this.directionalLights.push(new T_(E_[0]),new T_(E_[1])))}}class P2{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let h=1/0;l&&(h=l*r+s);const f=this._allocate(c,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const so=new P2;function vs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function x2(t){return[t[12],t[13],t[14]]}function I2(t){return{left:Hr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Hr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Hr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Hr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Hr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Hr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const w_=new Gt;function Hr(t,e,n,r){w_.set(t,e,n);const i=w_.len();return{distance:r/i,normal:new Gt(-t/i,-e/i,-n/i)}}function M2(t){return t-Math.fround(t)}let ls;function lu(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;ls=so.allocate(ls,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];ls[a+l]=c,ls[a+l+n]=M2(c)}a+=n*2}return ls.subarray(0,s*n*2)}function N2(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const k2=Math.PI/180,O2=vs(),S_=[0,0,0],F2={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function D2({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new en().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new en().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:h=0,top:f=0,bottom:m=0}=s,E=Fn((u+t-h)/2,0,t)-t/2,w=Fn((f+e-m)/2,0,e)-e/2;c[8]-=E*2/t,c[9]+=w*2/e}return c}class rc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||F2,this.focalDistance=e.focalDistance||1,this.position=e.position||S_,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Kt.WEB_MERCATOR:Kt.WEB_MERCATOR_AUTO_OFFSET:Kt.IDENTITY}equals(e){return e instanceof rc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&io(e.projectionMatrix,this.projectionMatrix)&&io(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=Zv(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=dd([i,a,o],this.pixelUnprojectionMatrix,l),[u,h,f]=this.unprojectPosition(c);return Number.isFinite(o)?[u,h,f]:Number.isFinite(r)?[u,h,r]:[u,h]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=pl(e);return n[1]=Fn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Bi(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?Vh({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,I2(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=qP({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Vh({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=S_;if(s&&(a=o?new en(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new Gt(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=O2,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new en().multiplyRight(n).translate(new Gt(this.center).negate()),this.projectionMatrix=r||D2({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*k2,focalDistance:u,padding:c,near:a,far:l});const h=vs();Er(h,h,this.projectionMatrix),Er(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Fh([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=x2(this.viewMatrixInverse);const f=vs(),m=vs();ud(f,f,[this.width/2,-this.height/2,1]),hl(f,f,[1,-1,0]),Er(m,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=m,this.pixelUnprojectionMatrix=Fh(vs(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ne.warn("Pixel project matrix not invertible")()}}rc.displayName="Viewport";const Gv=rc;class oo extends Gv{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:m=!1,worldOffset:E=0,position:w,padding:S,legacyMeterSizes:_=!1}=e;let{width:d,height:y,altitude:A=1.5}=e;const b=Math.pow(2,i);d=d||1,y=y||1;let I,k=null;if(f)A=f[5]/2,I=gl(A);else{e.fovy?(I=e.fovy,A=qv(I)):I=gl(A);let O;if(S){const{top:F=0,bottom:V=0}=S;O=[0,Fn((F+y-V)/2,0,y)-y/2]}k=QP({width:d,height:y,scale:b,center:w&&[0,0,w[2]*au(n)],offset:O,pitch:s,fovy:I,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(k.near=c),Number.isFinite(u)&&(k.far=u)}let M=ZP({height:y,pitch:s,bearing:o,scale:b,altitude:A});E&&(M=new en().translate([512*E,0,0]).multiplyLeft(M)),super({...e,width:d,height:y,viewMatrix:M,longitude:r,latitude:n,zoom:i,...k,fovy:I,focalDistance:A}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=A,this.fovy=I,this.orthographic=h,this._subViewports=m?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new oo({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*au(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/au(r);return[n,r,i]}addMetersToLngLat(e,n){return Kv(e,n)}panByPosition(e,n){const r=dd(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=h_([],i,BC([],r)),o=h_([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=e2(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=JP({width:r,height:i,bounds:e,...n});return new oo({width:r,height:i,longitude:s,latitude:o,zoom:a})}}oo.displayName="WebMercatorViewport";const eT=oo,A_=[0,0,0];function cu(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof eT){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function U2(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===te.DEFAULT&&(i=e.isGeospatial?te.LNGLAT:te.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function tT(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=To([],[o,a,l,1],n)),r){case te.LNGLAT:return cu([o,a,l],e,s);case te.LNGLAT_OFFSETS:return cu([o+i[0],a+i[1],l+(i[2]||0)],e,s);case te.METER_OFFSETS:return cu(Kv(i,[o,a,l]),e,s);case te.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function nT(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=U2(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=A_,shaderCoordinateOrigin:u=A_,offsetMode:h=!1}=l?Xv(n,r,i):{},f=tT(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const m=n.projectPosition(c||u);GC(f,f,m)}return f}const B2=[255,255,255],L2=1,V2=[0,0,1],z2=[0,0,1];let j2=0;class rT{constructor(e={}){this.type="point";const{color:n=B2}=e,{intensity:r=L2}=e,{position:i=z2}=e;this.id=e.id||`point-${j2++}`,this.color=n,this.intensity=r,this.type="point",this.position=i,this.attenuation=H2(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,r=e.context.viewport,{coordinateSystem:i,coordinateOrigin:s}=e.props,o=nT(this.position,{viewport:r,coordinateSystem:i,coordinateOrigin:s,fromCoordinateSystem:r.isGeospatial?te.LNGLAT:te.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=o,n}}function H2(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:V2}let W2=1,$2=1;class iT{constructor(){p(this,"time",0);p(this,"channels",new Map);p(this,"animations",new Map);p(this,"playing",!1);p(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=W2++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=$2++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let X2=0;const Y2={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Ti.stats.get(`animation-loop-${X2++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class K2{constructor(e){p(this,"device",null);p(this,"canvas",null);p(this,"props");p(this,"animationProps",null);p(this,"timeline",null);p(this,"stats");p(this,"cpuTime");p(this,"gpuTime");p(this,"frameRate");p(this,"display");p(this,"needsRedraw","initialized");p(this,"_initialized",!1);p(this,"_running",!1);p(this,"_animationFrameId",null);p(this,"_nextFramePromise",null);p(this,"_resolveNextFrame",null);p(this,"_cpuStartTime",0);if(this.props={...Y2,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Gl({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=N3(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(k3(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class R_{constructor(e){p(this,"id");p(this,"userData",{});p(this,"topology");p(this,"bufferLayout",[]);p(this,"vertexCount");p(this,"indices");p(this,"attributes");this.id=e.id||Fr("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&le(this.indices.usage===ge.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function q2(t,e){if(e instanceof R_)return e;const n=Z2(t,e),{attributes:r,bufferLayout:i}=Q2(t,e);return new R_({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function Z2(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:ge.INDEX,data:n})}function Q2(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:C3(l,c,u)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}class J2{constructor(e){p(this,"modules");p(this,"moduleUniforms");p(this,"moduleBindings");p(this,"moduleUniformsChanged");const n=tc(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;B.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e)){const s=r;this.moduleUniforms[s]=i.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i],o=this.modules[i];if(!o){B.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=this.moduleBindings[i],c=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:u,bindings:h}=cd(c);this.moduleUniforms[i]={...a,...u},this.moduleBindings[i]={...l,...h}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}}const Ol=class Ol{constructor(e){p(this,"device");p(this,"_hashCounter",0);p(this,"_hashes",{});p(this,"_renderPipelineCache",{});p(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Ol(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...ki.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...al.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof al?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};p(Ol,"defaultProps",{...ki.defaultProps});let zh=Ol;const Fl=class Fl{constructor(e){p(this,"device");p(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new Fl(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};p(Fl,"defaultProps",{...il.defaultProps});let jh=Fl;function G2(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s.accessor)}}return n}let Pe=null,uu=null;function ex(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){Pe||(Pe=document.createElement("canvas"),Pe.id=e,Pe.title=e,Pe.style.zIndex="100",Pe.style.position="absolute",Pe.style.top=i,Pe.style.left=s,Pe.style.border="blue 1px solid",Pe.style.transform="scaleY(-1)",document.body.appendChild(Pe),uu=Pe.getContext("2d")),(Pe.width!==t.width||Pe.height!==t.height)&&(Pe.width=t.width/2,Pe.height=t.height/2,Pe.style.width="400px",Pe.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=uu.createImageData(t.width,t.height),c=0;for(let u=0;u<a.length;u+=4)l.data[c+u+0]=a[u+0]*o,l.data[c+u+1]=a[u+1]*o,l.data[c+u+2]=a[u+2]*o,l.data[c+u+3]=r?255:a[u+3]*o;uu.putImageData(l,0,0)}const Wr=2,tx=1e4,Dl=class Dl{constructor(e,n){p(this,"device");p(this,"id");p(this,"source");p(this,"vs");p(this,"fs");p(this,"pipelineFactory");p(this,"shaderFactory");p(this,"userData",{});p(this,"parameters");p(this,"topology");p(this,"bufferLayout");p(this,"isInstanced");p(this,"instanceCount",0);p(this,"vertexCount");p(this,"indexBuffer",null);p(this,"bufferAttributes",{});p(this,"constantAttributes",{});p(this,"bindings",{});p(this,"uniforms",{});p(this,"vertexArray");p(this,"transformFeedback",null);p(this,"pipeline");p(this,"shaderInputs");p(this,"_uniformStore");p(this,"_attributeInfos",{});p(this,"_gpuGeometry",null);p(this,"_getModuleUniforms");p(this,"props");p(this,"_pipelineNeedsUpdate","newly created");p(this,"_needsRedraw","initializing");p(this,"_destroyed",!1);p(this,"_lastDrawTimestamp",-1);p(this,"_lastLogTime",0);p(this,"_logOpen",!1);p(this,"_drawCount",0);var a,l,c,u;this.props={...Dl.defaultProps,...n},n=this.props,this.id=n.id||Fr("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(h=>[h.name,h]))||[]);this.setShaderInputs(n.shaderInputs||new J2(r));const i=nx(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(c=this.shaderInputs)==null?void 0:c.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=_C(this.props.source));const{source:h,getUniforms:f}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:s});this.source=h,this._getModuleUniforms=f}else{const{vs:h,fs:f,getUniforms:m}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:s});this.vs=h,this.fs=f,this._getModuleUniforms=m}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||zh.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||jh.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),nl(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,i=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&q2(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=b_(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?b_(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Mh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new b3(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&B.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,i]of Object.entries(e)){const s=this.bufferLayout.find(l=>C_(l).includes(r));if(!s){B.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=C_(s);let a=!1;for(const l of o){const c=this._attributeInfos[l];c&&(this.vertexArray.setBuffer(c.location,i),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&B.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||B.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){nl(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:r}=cd(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof rl?e=Math.max(e,n.texture.updateTimestamp):n instanceof ge||n instanceof vt?e=Math.max(e,n.updateTimestamp):n instanceof sl||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(B.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:i}),this._attributeInfos=vv(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=B.level>3?0:tx;B.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,B.group(Wr,`>>> DRAWING MODEL ${this.id}`,{collapsed:B.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=G2(this.pipeline.shaderLayout,this.id);B.table(Wr,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};B.table(Wr,n)();const r=this._getAttributeDebugTable();B.table(Wr,this._attributeInfos)(),B.table(Wr,r)(),B.groupEnd(Wr)(),this._logOpen=!1}}_logFramebuffer(e){const n=B.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&ex(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos))e[r.location]={name:n,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=wv(n);return(e instanceof ge?new r(e.debugData):e).toString()}};p(Dl,"defaultProps",{...ki.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:tl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Li=Dl;function b_(t,e){const n=[...t];for(const r of e){const i=n.findIndex(s=>s.name===r.name);i<0?n.push(r):n[i]=r}return n}function nx(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function C_(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class ao{constructor(e,n=Li.defaultProps){p(this,"device");p(this,"model");p(this,"transformFeedback");le(ao.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Li(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||Pb(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof ge)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}}class rx{constructor(e){p(this,"id");p(this,"topology");p(this,"vertexCount");p(this,"indices");p(this,"attributes");p(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||Fr("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;le(ArrayBuffer.isView(a.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(le(!this.indices),this.indices=a):this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o>=1&&(r=Math.min(r,s.length/o))}return le(Number.isFinite(r)),r}}const ix={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class sT extends pd{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:h,effects:f,pass:m="picking",pickZ:E,moduleParameters:w}){this.pickZ=E;const S=this._resetColorEncoder(E),_=[a,l,c,u],d=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:h,effects:f==null?void 0:f.filter(A=>A.useInPicking),pass:m,isPicking:!0,moduleParameters:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});return this._colorEncoderState=null,{decodePickingColor:S&&ox.bind(null,S),stats:d}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,r){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,ix),i.blend=!0,i.blendColor=sx(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function sx(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(ne.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function ox(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Yr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},_l=Symbol.for("component"),Xn=Symbol.for("propTypes"),hu=Symbol.for("deprecatedProps"),Si=Symbol.for("asyncPropDefaults"),Pr=Symbol.for("asyncPropOriginal"),Dn=Symbol.for("asyncPropResolved");function _d(t,e=()=>!0){return Array.isArray(t)?oT(t,e,[]):e(t)?[t]:[]}function oT(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?oT(i,e,n):e(i)&&n.push(i)}return n}function ax({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class lx{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Ga(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class cx{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new lx(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const ux="layerManager.setLayers",hx="layerManager.activateViewport";class fx{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{ze(hx,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new cx({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:g2(),defaultShaderModules:[],renderPass:void 0,stats:i||new Gl({id:"deck.gl"}),viewport:s||new Gv({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new iT,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){ze(ux,this,n,e),this._lastRenderedLayers=e;const r=_d(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?ne.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&ne.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Yr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Yr.MATCHED,n!==e&&(e.lifecycle=Yr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Yr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Yr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Mt(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Mt(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Mt(t[s],e[s],n-1))return!1;return!0}return!1}class dx{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=_d(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Mt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ne.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const px=/([0-9]+\.?[0-9]*)(%|px)/;function Sn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=px.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function An(t,e){return t.relative?Math.round(t.position*e):t.position}class Vi{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Sn(r),this._y=Sn(i),this._width=Sn(s),this._height=Sn(o),this._padding=a&&{left:Sn(a.left||0),right:Sn(a.right||0),top:Sn(a.top||0),bottom:Sn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Mt(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:An(this._x,e),y:An(this._y,n),width:An(this._width,e),height:An(this._height,n)};return this._padding&&(r.padding={left:An(this._padding.left,e),top:An(this._padding.top,n),right:An(this._padding.right,e),bottom:An(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class ic{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const P_=()=>{},Hh={BREAK:1,SNAP_TO_END:2,IGNORE:3},gx=t=>t,_x=Hh.BREAK;class mx{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ic(e.timeline),this.onViewStateChange=e.onViewStateChange||P_,this.onStateChange=e.onStateChange||P_}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Hh.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Hh.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||gx,interpolator:s,interruption:n.transitionInterruption||_x,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function He(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class yx{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!io(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];He(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const vx=["longitude","latitude","zoom","bearing","pitch"],Tx=["longitude","latitude","zoom"];class aT extends yx{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:vx,required:Tx},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=ul(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,ul(e.around,n.around,r)))}return i}}const Rn={transitionDuration:0},Ex=300,sa=t=>1-(1-t)*(1-t),$r={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},sr={};class wx{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new mx({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?Ex:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents($r.WHEEL,u&&r),this.toggleEvents($r.PAN,u),this.toggleEvents($r.PINCH,u&&(a||l)),this.toggleEvents($r.TRIPLE_PAN,u&&l),this.toggleEvents($r.DOUBLE_TAP,u&&o),this.toggleEvents($r.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Rn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Rn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:sa},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Rn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:sa},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Rn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Rn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:sa},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return sr._startPinchRotation=e.rotation,sr._lastPinchEvent=e,this.updateViewport(r,Rn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:sr._startPinchRotation-r})}return this.updateViewport(n,Rn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),sr._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=sr;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:sa},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return sr._startPinchRotation=null,sr._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Rn:e?{...n,transitionInterpolator:new aT({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class Sx{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const x_=5,Ax=1.2;class Rx extends Sx{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:m=60,minPitch:E=0,startPanLngLat:w,startZoomLngLat:S,startRotatePos:_,startBearing:d,startPitch:y,startZoom:A,normalize:b=!0}=e;He(Number.isFinite(s)),He(Number.isFinite(i)),He(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:h,minZoom:f,maxPitch:m,minPitch:E,normalize:b,position:u},{startPanLngLat:w,startZoomLngLat:S,startRotatePos:_,startBearing:d,startPitch:y,startZoom:A}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=Fn(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Fn(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=Fn(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,t2(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),h=s/c;let f=0;o>0?Math.abs(u-l)>x_&&(f=o/(l-u)*Ax):o<0&&l>x_&&(f=1-a/l),f=Fn(f,-1,1);const{minPitch:m,maxPitch:E}=this.getViewportProps(),w=i+180*h;let S=r;return f>0?S=r+f*(E-r):f<0&&(S=r-f*(m-r)),{pitch:S,bearing:w}}}class bx extends wx{constructor(){super(...arguments),this.ControllerState=Rx,this.transition={transitionDuration:300,transitionInterpolator:new aT({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class lT extends Vi{constructor(e={}){super(e)}get ViewportType(){return eT}get ControllerType(){return bx}}lT.displayName="MapView";const Cx=lT,Px=new gd;function xx(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class Ix{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>xx(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Mt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof gd)||this._resolvedEffects.push(Px),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Mx extends pd{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const Nx="deckRenderer.renderLayers";class kx{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Mx(e),this.pickLayersPass=new sT(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,ze(Nx,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const Ox={pickedColor:null,pickedObjectIndex:-1};function Fx({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,h=-1,f=0;for(let m=0;m<c;m++){const E=m+a-r,w=E*E;if(w>u)f+=4*l;else for(let S=0;S<l;S++){if(t[f+3]-1>=0){const d=S+o-n,y=d*d+w;y<=u&&(u=y,h=f)}f+=4}}if(h>=0){const m=t.slice(h,h+4),E=e(m);if(E){const w=Math.floor(h/4/l),S=h/4-w*l;return{...E,pickedColor:m,pickedX:o+S,pickedY:a+w}}ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Ox}function Dx({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function cT({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=Bx((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function Ux(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const h=n.index,f=n.layerId,m=o?o.props.id:null;if(m!==f||a!==h){if(m!==f){const E=i.find(w=>w.props.id===f);E&&l.unshift(E)}n.layerId=m,n.index=a,n.info=null}}const c=cT(t),u=new Map;return u.set(null,c),l.forEach(h=>{let f={...c};h===o&&(f.color=s,f.index=a,f.picked=!0),f=uT({layer:h,info:f,mode:r});const m=f.layer;h===o&&r==="hover"&&(n.info=f),u.set(m.id,f),r==="hover"&&m.updateAutoHighlight(f)}),u}function uT({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function Bx(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class Lx{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new sT(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(f=>f.id===o):null,c=a&&i.find(f=>f.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),m=this._getPickable(e);if(!m||r.length===0)return{result:[],emptyInfo:cT({viewports:r,x:i,y:s,pixelRatio:f})};this._resizeBuffer();const E=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[E.x+Math.floor(E.width/2),E.y+Math.floor(E.height/2)],S=Math.round(o*f),{width:_,height:d}=this.pickingFBO,y=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:S,deviceWidth:_,deviceHeight:d}),A={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let b;const I=[],k=new Set;for(let M=0;M<a;M++){let O;if(y){const V=this._drawAndSample({layers:m,views:n,viewports:r,onViewportActive:u,deviceRect:y,cullRect:A,effects:h,pass:`picking:${l}`});O=Fx({...V,deviceX:w[0],deviceY:w[1],deviceRadius:S,deviceRect:y})}else O={pickedColor:null,pickedObjectIndex:-1};let F;if(O.pickedLayer&&c&&this.depthFBO){const{pickedColors:V}=this._drawAndSample({layers:[O.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:O.pickedX,y:O.pickedY,width:1,height:1},cullRect:A,effects:h,pass:`picking:${l}:z`},!0);V[3]&&(F=V[0])}O.pickedLayer&&M+1<a&&(k.add(O.pickedLayer),O.pickedLayer.disablePickingIndex(O.pickedObjectIndex)),b=Ux({pickInfo:O,lastPickedInfo:this.lastPickedInfo,mode:l,layers:m,viewports:r,x:i,y:s,z:F,pixelRatio:f});for(const V of b.values())V.layer&&I.push(V);if(!O.pickedColor)break}for(const M of k)M.restorePickingColors();return{result:I,emptyInfo:b.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||r.length===0)return[];this._resizeBuffer();const m=this.device.canvasContext.cssToDeviceRatio(),E=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=E.x,S=E.y+E.height,_=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),d=_.x+_.width,y=_.y,A={x:w,y,width:d-w,height:S-y},b=this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:A,cullRect:{x:i,y:s,width:o,height:a},effects:h,pass:`picking:${l}`}),I=Dx(b),k=new Map,M=[],O=Number.isFinite(c);for(let F=0;F<I.length&&!(O&&M.length>=c);F++){const V=I[F];let z={color:V.pickedColor,layer:null,index:V.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:m};z=uT({layer:V.pickedLayer,info:z,mode:l});const X=z.layer.id;k.has(X)||k.set(X,new Set);const $=k.get(X),G=z.object??z.index;$.has(G)||($.add(G),M.push(z))}return M}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const d of a)d.useInPicking&&(h.preRenderStats[d.id]=d.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:m,y:E,width:w,height:S}=s,_=new(c?Float32Array:Uint8Array)(w*S*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:m,sourceY:E,sourceWidth:w,sourceHeight:S,target:_}),{pickedColors:_,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const Vx={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},zx="top-left",I_="__root";class jx{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Mt(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=zx}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||I_;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,Vx[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===I_||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const r=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const c=r[l];c&&(a.onViewportChange&&!c.equals(i[l])&&a.onViewportChange(c),(s=a.onRedraw)==null||s.call(a,{viewports:[c],layers:n}))}else{if(a.onViewportChange)for(const c of e)c.equals(i[c.id])||a.onViewportChange(c);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=Uh[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r.handler])==null||s.call(o,e,n))}}}const Hx={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Wx{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,Hx),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var li;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(li||(li={}));const md={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Se=(t,e,n)=>e?t.enable(n):t.disable(n),M_=(t,e,n)=>t.hint(n,e),it=(t,e,n)=>t.pixelStorei(n,e),N_=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},cs=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function fu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const $x={3042:Se,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Se,2885:(t,e)=>t.cullFace(e),2929:Se,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Se,35723:M_,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:N_,36010:N_,34964:cs,36662:cs,36663:cs,35053:cs,35055:cs,2886:(t,e)=>t.frontFace(e),33170:M_,2849:(t,e)=>t.lineWidth(e),32823:Se,32824:"polygonOffset",10752:"polygonOffset",35977:Se,32926:Se,32928:Se,32938:"sampleCoverage",32939:"sampleCoverage",3089:Se,3088:(t,e)=>t.scissor(...e),2960:Se,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Se,10754:Se,12288:Se,12289:Se,12290:Se,12291:Se,12292:Se,12293:Se,12294:Se,12295:Se,3333:it,3317:it,37440:it,37441:it,37443:it,3330:it,3332:it,3331:it,3314:it,32878:it,3316:it,3315:it,32877:it,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=fu(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=fu(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=fu(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function ye(t,e,n){return e[t]!==void 0?e[t]:n[t]}const Xx={blendEquation:(t,e,n)=>t.blendEquationSeparate(ye(32777,e,n),ye(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ye(32969,e,n),ye(32968,e,n),ye(32971,e,n),ye(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ye(32824,e,n),ye(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ye(32938,e,n),ye(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ye(2962,e,n),ye(2967,e,n),ye(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ye(34816,e,n),ye(36003,e,n),ye(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ye(2964,e,n),ye(2965,e,n),ye(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ye(34817,e,n),ye(34818,e,n),ye(34819,e,n))},k_={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},zt=(t,e)=>t.isEnabled(e),O_={3042:zt,2884:zt,2929:zt,3024:zt,32823:zt,32926:zt,32928:zt,3089:zt,2960:zt,35977:zt},Yx=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function $i(t,e){if(qx(e))return;const n={};for(const i in e){const s=Number(i),o=$x[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=Xx[i];s(t,e,r)}}function hT(t,e=md){if(typeof e=="number"){const i=e,s=O_[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=O_[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function Kx(t){$i(t,md)}function qx(t){for(const e in t)return!1;return!0}function Zx(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class Qx{constructor(e,{copyState:n=!1,log:r=()=>{}}={}){p(this,"gl");p(this,"program",null);p(this,"stateStack",[]);p(this,"enable",!0);p(this,"cache");p(this,"log");this.gl=e,this.cache=n?hT(e):Object.assign({},md),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){le(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];$i(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){le(s!==void 0);const o=e[s],a=this.cache[s];Zx(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function xr(t){return t.state}function fT(t,e){const{enable:n=!0,copyState:r}=e;if(le(r!==void 0),!t.state){t.state=new Qx(t,{copyState:r}),Gx(t);for(const s in k_){const o=k_[s];Jx(t,s,o)}F_(t,"getParameter"),F_(t,"isEnabled")}const i=xr(t);return i.enable=n,t}function sc(t){let e=xr(t);e||(fT(t,{copyState:!1}),e=xr(t)),e.push()}function lo(t){const e=xr(t);le(e),e.pop()}function F_(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||Yx.has(i))return n(i);const s=xr(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Jx(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=xr(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Gx(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=xr(t);i.program!==r&&(e(r),i.program=r)}}const eI={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function tI(t,e){e={...eI,...e};let n=null;const r=s=>n=s.statusMessage||n;t.addEventListener("webglcontextcreationerror",r,!1);let i=null;if(i||(i=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!i)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:s}=e;t.addEventListener("webglcontextlost",o=>s(o),!1)}if(e.onContextRestored){const{onContextRestored:s}=e;t.addEventListener("webglcontextrestored",o=>s(o),!1)}return i}function Qn(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function nI(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Qn(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,c=t.getParameter(7938),u=dT(a,l),h=rI(a,l),f=iI(a,l);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function dT(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function rI(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function iI(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(dT(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function pT(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Ve="texture-compression-bc",ie="texture-compression-astc",jt="texture-compression-etc2",sI="texture-compression-etc1-webgl",oa="texture-compression-pvrtc-webgl",du="texture-compression-atc-webgl",us="float32-renderable-webgl",pu="float16-renderable-webgl",oI="rgb9e5ufloat_renderable-webgl",gu="snorm8-renderable-webgl",hs="norm16-renderable-webgl",_u="snorm16-renderable-webgl",aa="float32-filterable",D_="float16-filterable-webgl",Ts="WEBGL_compressed_texture_s3tc",Es="WEBGL_compressed_texture_s3tc_srgb",ci="EXT_texture_compression_rgtc",ui="EXT_texture_compression_bptc",aI="WEBGL_compressed_texture_etc",lI="WEBGL_compressed_texture_astc",cI="WEBGL_compressed_texture_etc1",uI="WEBGL_compressed_texture_pvrtc",hI="WEBGL_compressed_texture_atc",U_="EXT_texture_norm16",B_="EXT_render_snorm",fI="EXT_color_buffer_float",yd={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[B_],"norm16-renderable-webgl":[U_],"snorm16-renderable-webgl":[U_,B_],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ts,Es,ci,ui],"texture-compression-bc5-webgl":[ci],"texture-compression-bc7-webgl":[ui],"texture-compression-etc2":[aI],"texture-compression-astc":[lI],"texture-compression-etc1-webgl":[cI],"texture-compression-pvrtc-webgl":[uI],"texture-compression-atc-webgl":[hI]};function dI(t){return t in yd}function pI(t,e,n){return(yd[e]||[]).every(i=>Qn(t,i,n))}const oc={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:gu},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:gu},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:pu,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:hs,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:_u},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:gu},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:pu,filter:D_,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:hs},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:_u},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:us,filter:aa},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:oI},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:us,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:hs},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:hs},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:us,filter:aa,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:pu,filter:D_},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:hs,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:_u},"rgb32float-webgl":{gl:34837,render:us,filter:aa,gl2ext:fI,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:us,filter:aa,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ts,f:Ve},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Es,f:Ve},"bc1-rgba-unorm":{gl:33777,x:Ts,f:Ve},"bc1-rgba-unorm-srgb":{gl:35916,x:Es,f:Ve},"bc2-rgba-unorm":{gl:33778,x:Ts,f:Ve},"bc2-rgba-unorm-srgb":{gl:35918,x:Es,f:Ve},"bc3-rgba-unorm":{gl:33779,x:Ts,f:Ve},"bc3-rgba-unorm-srgb":{gl:35919,x:Es,f:Ve},"bc4-r-unorm":{gl:36283,x:ci,f:Ve},"bc4-r-snorm":{gl:36284,x:ci,f:Ve},"bc5-rg-unorm":{gl:36285,x:ci,f:Ve},"bc5-rg-snorm":{gl:36286,x:ci,f:Ve},"bc6h-rgb-ufloat":{gl:36495,x:ui,f:Ve},"bc6h-rgb-float":{gl:36494,x:ui,f:Ve},"bc7-rgba-unorm":{gl:36492,x:ui,f:Ve},"bc7-rgba-unorm-srgb":{gl:36493,x:ui,f:Ve},"etc2-rgb8unorm":{gl:37492,f:jt},"etc2-rgb8unorm-srgb":{gl:37494,f:jt},"etc2-rgb8a1unorm":{gl:37496,f:jt},"etc2-rgb8a1unorm-srgb":{gl:37497,f:jt},"etc2-rgba8unorm":{gl:37493,f:jt},"etc2-rgba8unorm-srgb":{gl:37495,f:jt},"eac-r11unorm":{gl:37488,f:jt},"eac-r11snorm":{gl:37489,f:jt},"eac-rg11unorm":{gl:37490,f:jt},"eac-rg11snorm":{gl:37491,f:jt},"astc-4x4-unorm":{gl:37808,f:ie},"astc-4x4-unorm-srgb":{gl:37840,f:ie},"astc-5x4-unorm":{gl:37809,f:ie},"astc-5x4-unorm-srgb":{gl:37841,f:ie},"astc-5x5-unorm":{gl:37810,f:ie},"astc-5x5-unorm-srgb":{gl:37842,f:ie},"astc-6x5-unorm":{gl:37811,f:ie},"astc-6x5-unorm-srgb":{gl:37843,f:ie},"astc-6x6-unorm":{gl:37812,f:ie},"astc-6x6-unorm-srgb":{gl:37844,f:ie},"astc-8x5-unorm":{gl:37813,f:ie},"astc-8x5-unorm-srgb":{gl:37845,f:ie},"astc-8x6-unorm":{gl:37814,f:ie},"astc-8x6-unorm-srgb":{gl:37846,f:ie},"astc-8x8-unorm":{gl:37815,f:ie},"astc-8x8-unorm-srgb":{gl:37847,f:ie},"astc-10x5-unorm":{gl:37819,f:ie},"astc-10x5-unorm-srgb":{gl:37851,f:ie},"astc-10x6-unorm":{gl:37817,f:ie},"astc-10x6-unorm-srgb":{gl:37849,f:ie},"astc-10x8-unorm":{gl:37818,f:ie},"astc-10x8-unorm-srgb":{gl:37850,f:ie},"astc-10x10-unorm":{gl:37819,f:ie},"astc-10x10-unorm-srgb":{gl:37851,f:ie},"astc-12x10-unorm":{gl:37820,f:ie},"astc-12x10-unorm-srgb":{gl:37852,f:ie},"astc-12x12-unorm":{gl:37821,f:ie},"astc-12x12-unorm-srgb":{gl:37853,f:ie},"pvrtc-rgb4unorm-webgl":{gl:35840,f:oa},"pvrtc-rgba4unorm-webgl":{gl:35842,f:oa},"pvrtc-rbg2unorm-webgl":{gl:35841,f:oa},"pvrtc-rgba2unorm-webgl":{gl:35843,f:oa},"etc1-rbg-unorm-webgl":{gl:36196,f:sI},"atc-rgb-unorm-webgl":{gl:35986,f:du},"atc-rgba-unorm-webgl":{gl:35986,f:du},"atc-rgbai-unorm-webgl":{gl:34798,f:du}},gI={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},_I={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function vd(t,e,n){const r=oc[e];if(!r||r.gl===void 0)return!1;const i=r.x||r.gl2ext;return i?!!Qn(t,i,n):!0}function gT(t){const e=oc[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function mI(t,e,n){if(!vd(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(gv(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Qn(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!Qn(t,"OES_texture_half_float_linear, extensions",n):!0}function yI(t,e,n){return!(!vd(t,e,n)||typeof e=="number")}function ml(t){var i;const e=oc[t],n=gT(t),r=gv(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||TI(r.format,r.integer,r.normalized,n),type:r.dataType?pT(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed}}function vI(t){const e=oc[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function L_(t){const e=ml(t),n=gI[e.dataFormat]||4,r=_I[e.type]||1;return n*r}function TI(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const V_={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class EI extends Wb{constructor(n,r,i){super([],i);p(this,"gl");p(this,"extensions");p(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Qn(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),dI(n)&&pI(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(V_),...Object.keys(yd)]}getWebGLFeature(n){const r=V_[n];return typeof r=="string"?!!Qn(this.gl,r,this.extensions):!!r}}class wI extends Hb{constructor(n){super();p(this,"gl");p(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function Un(t,e,n){if(SI(e))return n(t);const{nocatch:r=!0}=e;sc(t),$i(t,e);let i;if(r)i=n(t),lo(t);else try{i=n(t)}finally{lo(t)}return i}function SI(t){for(const e in t)return!1;return!0}function AI(t,e,n,r){if(nl(e))return r(t);const i=t;sc(i.gl);try{return RI(t,e),$i(i.gl,n),r(t)}finally{lo(i.gl)}}function RI(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(wr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=wr("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=wr("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(CI("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Wh("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&B.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Wh("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=mu("stencilPassOperation",e.stencilPassOperation),s=mu("stencilFailOperation",e.stencilFailOperation),o=mu("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const i=z_("blendColorOperation",e.blendColorOperation||"add"),s=z_("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=la("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=la("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=la("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=la("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,c)}}function Wh(t,e){return wr(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function mu(t,e){return wr(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function z_(t,e){return wr(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function la(t,e){return wr(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function bI(t,e){return`Illegal parameter ${e} for ${t}`}function wr(t,e,n){if(!(e in n))throw new Error(bI(t,e));return n[e]}function CI(t,e){return e}function _T(t){const e={};return t.addressModeU&&(e[10242]=yu(t.addressModeU)),t.addressModeV&&(e[10243]=yu(t.addressModeV)),t.addressModeW&&(e[32882]=yu(t.addressModeW)),t.magFilter&&(e[10240]=mT(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=PI(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Wh("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function yu(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function mT(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function PI(t,e){if(!e)return mT(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Yn extends ge{constructor(n,r={}){super(n,r);p(this,"device");p(this,"gl");p(this,"handle");p(this,"glTarget");p(this,"glUsage");p(this,"glIndexType",5123);p(this,"byteLength");p(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=xI(this.props.usage),this.glUsage=II(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){le(n>=0);let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function xI(t){return t&ge.INDEX?34963:t&ge.VERTEX?34962:t&ge.UNIFORM?35345:34962}function II(t){return t&ge.INDEX||t&ge.VERTEX?35044:t&ge.UNIFORM?35048:35044}class $h extends sl{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"parameters");this.device=n,this.parameters=_T(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class hi extends rl{constructor(n,r){super(n,{...vt.defaultProps,...r});p(this,"device");p(this,"gl");p(this,"handle");p(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const MI={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Bs=class Bs extends vt{constructor(n,r){var i;super(n,{...MI,format:"rgba8unorm",...r});p(this,"MAX_ATTRIBUTES");p(this,"device");p(this,"gl");p(this,"handle");p(this,"sampler");p(this,"view");p(this,"glFormat");p(this,"type");p(this,"dataFormat");p(this,"mipmaps");p(this,"target");p(this,"textureUnit");p(this,"loaded",!1);p(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=NI(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:M3(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new hi(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let r=n.data;if(r instanceof Promise)return r.then(_=>this.initialize(Object.assign({},n,{pixels:_,data:_}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:s={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:l=void 0,mipmaps:c=!0}=n;r||(r=o);let{width:u,height:h,dataFormat:f,type:m,compressed:E=!1}=n;const{depth:w=0}=n,S=gT(n.format);return{width:u,height:h,compressed:E,dataFormat:f,type:m}=this._deduceParameters({format:n.format,type:m,dataFormat:f,compressed:E,data:r,width:u,height:h}),this.width=u,this.height=h,this.glFormat=S,this.type=m,this.dataFormat=f,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=c,this.setImageData({data:r,width:u,height:h,depth:w,format:n.format,type:m,dataFormat:f,parameters:a,compressed:E}),this.setSampler(n.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),c&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(n){const{mipmaps:r=!0,parameters:i={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,r&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(i)}),this}setSampler(n={}){let r;n instanceof $h?(this.sampler=n,r=n.props):(this.sampler=new $h(this.device,n),r=n);const i=_T(r);return this._setSamplerParameters(i),this}resize(n){const{height:r,width:i,mipmaps:s=!1}=n;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:n,parameters:r,lastTime:i}=this._video;if(i===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Un(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:s=0,glFormat:o=this.glFormat,offset:a=0,parameters:l={}}=n;let{data:c=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:m=this.dataFormat,compressed:E=!1}=n;c||(c=i),{type:u,dataFormat:m,compressed:E,width:h,height:f}=this._deduceParameters({format:this.props.format,type:u,dataFormat:m,compressed:E,data:c,width:h,height:f});const{gl:w}=this;w.bindTexture(this.target,this.handle);let S=null;if({data:c,dataType:S}=this._getDataType({data:c,compressed:E}),Un(this.gl,l,()=>{switch(S){case"null":w.texImage2D(r,s,o,h,f,0,m,u,c);break;case"typed-array":w.texImage2D(r,s,o,h,f,0,m,u,c,a);break;case"buffer":this.device.gl.bindBuffer(35052,c.handle||c),this.device.gl.texImage2D(r,s,o,h,f,0,m,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":w.texImage2D(r,s,o,h,f,0,m,u,c);break;case"compressed":for(const[_,d]of c.entries())w.compressedTexImage2D(r,_,d.format,d.width,d.height,0,d.data);break;default:le(!1,"Unknown image data type")}}),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const _=L_(this.props.format);this.trackAllocatedMemory(this.width*this.height*_,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,glFormat:u=this.glFormat,type:h=this.type,dataFormat:f=this.dataFormat,compressed:m=!1,offset:E=0,parameters:w={}}){if({type:h,dataFormat:f,compressed:m,width:a,height:l}=this._deduceParameters({format:this.props.format,type:h,dataFormat:f,compressed:m,data:i,width:a,height:l}),le(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const S=i;i=S.data,a=S.shape[0],l=S.shape[1]}i instanceof Yn&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Un(this.gl,w,()=>{m?this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,i):i===null?this.gl.texSubImage2D(n,c,s,o,a,l,f,h,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(n,c,s,o,a,l,f,h,i,E):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(n,c,s,o,a,l,f,h,E),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,c,s,o,a,l,f,h,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return B.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,null),n}_getDataType({data:n,compressed:r=!1}){return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Yn?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:r,data:i}=n;let{width:s,height:o,dataFormat:a,type:l,compressed:c}=n;const u=ml(r);return a=a||u.dataFormat,l=l||u.type,c=c||u.compressed,{width:s,height:o}=this._deduceImageSize(i,s,o),{dataFormat:a,type:l,compressed:c,width:s,height:o,format:r,data:i}}_deduceImageSize(n,r,i){let s;return typeof ImageData<"u"&&n instanceof ImageData?s={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?s={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?s={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?s={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?s={width:n.videoWidth,height:n.videoHeight}:n?s={width:r,height:i}:s={width:r>=0?r:1,height:i>=0?i:1},le(s,"Could not deduced texture size"),le(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),le(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(n){const{gl:r}=this,{width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,u=o||a,h=await Promise.all(Bs.FACES.map(f=>{const m=u[f];return Promise.all(Array.isArray(m)?m:[m])}));this.bind(),Bs.FACES.forEach((f,m)=>{h[m].length>1&&this.props.mipmaps!==!1&&B.warn(`${this.id} has mipmap and multiple LODs.`)(),h[m].forEach((E,w)=>{i&&s?r.texImage2D(f,w,l,i,s,0,l,c,E):r.texImage2D(f,w,l,l,c,E)})}),this.unbind()}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,{gl:u}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},n,{face:r,data:f,pixels:f}))):this.width||this.height?u.texImage2D(r,0,l,i,s,0,l,c,h):u.texImage2D(r,0,l,l,c,h),this}setImageData3D(n){const{level:r=0,dataFormat:i,format:s,type:o,width:a,height:l,depth:c=1,offset:u=0,data:h,parameters:f={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const m=ml(s);if(Un(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,r,m.format,a,l,c,0,m.dataFormat,m.type,h),h instanceof Yn&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,r,i,a,l,c,0,s,o,u))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const E=L_(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*E,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!nl(n)){kI(n),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};p(Bs,"FACES",[34069,34070,34071,34072,34073,34074]);let qt=Bs;function NI(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function kI(t){B.log(1,"texture sampler parameters",t)()}class ks extends ol{constructor(n,r){super(n,r);p(this,"device");p(this,"gl");p(this,"handle");const i=r.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],l=36064+o;a&&this._attachOne(l,a)}if(this.depthStencilAttachment&&this._attachOne(vI(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${FI(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new qt(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:n,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:r}),this}_attachOne(n,r){if(Array.isArray(r)){const[i,s=0,o=0]=r;return this._attachTexture(n,i,s,o),i}if(r instanceof qt)return this._attachTexture(n,r,0,0),r;if(r instanceof hi){const i=r;return this._attachTexture(n,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(n,r,i,s){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const a=OI(i);o.framebufferTexture2D(36160,n,a,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:le(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function OI(t){return t<34069?t+34069:t}function FI(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class DI extends ld{constructor(n,r){super(r);p(this,"device");p(this,"presentationSize");p(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ks(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}const UI={spector:B.get("spector")||B.get("spectorjs")},BI="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",LI=1;let se=null,j_=!1;async function VI(t){if(!globalThis.SPECTOR)try{await Sv(BI)}catch(e){B.warn(String(e))}}function zI(t){if(t={...UI,...t},!(t!=null&&t.spector)||(!se&&globalThis.SPECTOR&&(B.probe(LI,"SPECTOR found and initialized")(),se=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=se)),!se))return null;if(j_||(j_=!0,se.spyCanvases(),se==null||se.onCaptureStarted.add(e=>B.info("Spector capture started:",e)()),se==null||se.onCapture.add(e=>{B.info("Spector capture complete:",e)(),se==null||se.getResultUI(),se==null||se.resultView.display(),se==null||se.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return se;se==null||se.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{B.info("Spector capture stopped after 2 seconds")(),se==null||se.stopCapture()})}return se}const jI="https://unpkg.com/webgl-debug@2.0.1/index.js";function yT(t){return t.luma=t.luma||{},t.luma}async function HI(){tr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Sv(jI))}function WI(t,e={}){return t?e.debug?XI(t,e):$I(t):null}function $I(t){const e=yT(t);return e.realContext?e.realContext:t}function XI(t,e){if(!globalThis.WebGLDebugUtils)return B.warn("webgl-debug not loaded")(),t;const n=yT(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...li,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,YI.bind(null,e),KI.bind(null,e));for(const o in li)!(o in r)&&typeof li[o]=="number"&&(r[o]=li[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function vu(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function YI(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;B.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function KI(t,e,n){let r="";if(B.level>=1&&(r=vu(e,n),B.log(1,r)()),t.break&&t.break.length>0&&(r=r||vu(e,n),t.break.every(s=>r.indexOf(s)!==-1)))debugger;for(const i of n)if(i===void 0){if(r=r||vu(e,n),t.throwOnError)throw new Error(`Undefined argument: ${r}`);B.error(`Undefined argument: ${r}`)();debugger}}function qI(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[h,f]=i;n.push({message:f.trim(),type:H_(h),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:H_(s),lineNum:c,linePos:u})}return n}function H_(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class ZI extends il{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return qI(n)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(n){n=(s=>s.startsWith("#version ")?s:`#version 100
${s}`)(n);const{gl:i}=this.device;if(i.shaderSource(this.handle,n),i.compileShader(this.handle),B.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}B.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),B.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const QI=256,JI=1024,GI=16384,Tu=6144,eM=[1,2,4,8];class tM extends Rh{constructor(n,r){super(n,r);p(this,"device");p(this,"glParameters");this.device=n,sc(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){lo(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=eM.map(i=>!!(i&n.colorMask))),this.glParameters=r,$i(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=GI,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=QI,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=JI,n.clearStencil=this.props.clearStencil),r!==0&&Un(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){Un(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(Tu,n,r);break;case Uint32Array:this.device.gl.clearBufferuiv(Tu,n,r);break;case Float32Array:default:this.device.gl.clearBufferfv(Tu,n,r);break}})}}const nM="Failed to deduce GL constant from typed array";function rM(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(nM)}}function Xh(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const iM={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},sM={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Os{constructor(...e){p(this,"offset");p(this,"stride");p(this,"type");p(this,"size");p(this,"divisor");p(this,"normalized");p(this,"integer");p(this,"buffer");p(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return Xh(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return le(e.size),Xh(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Os(iM,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Os.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Os.getBytesPerVertex(this)}_assign(e={}){return e=x3("Accessor",e,sM),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function oM(t){return aM.includes(t)}const aM=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],vT={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function TT(t){const e=vT[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function lM(t){const e=vT[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function cM(t,e){const n={attributes:[],bindings:[]};n.attributes=uM(t,e);const r=dM(t,e);for(const a of r){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=fM(t,e);let s=0;for(const a of i)if(oM(a.type)){const{viewDimension:l,sampleType:c}=gM(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=hM(t,e);return o!=null&&o.length&&(n.varyings=o),n}function uM(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:c}=lM(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((i,s)=>i.location-s.location),n}function hM(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:c,components:u}=TT(a),h=new Os({type:c,size:l*u}),f={location:i,name:o,accessor:h};n.push(f)}return n.sort((i,s)=>i.location-s.location),n}function fM(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=_M(o);let h=t.getUniformLocation(e,c);const f={location:h,name:c,size:a,type:l,isArray:u};if(n.push(f),f.size>1)for(let m=0;m<f.size;m++){const E=`${c}[${m}]`;h=t.getUniformLocation(e,E);const w={...f,name:E,location:h};n.push(w)}}return n}function dM(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),h=t.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const m=t.getActiveUniform(e,a[f]);if(!m)throw new Error("activeInfo");o.uniforms.push({name:m.name,format:TT(l[f]).format,type:l[f],arrayLength:c[f],byteOffset:u[f],byteStride:h[f]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const pM={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function gM(t){const e=pM[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function _M(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function mM(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function yM(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function vM(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const W_=4;class TM extends ki{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"vs");p(this,"fs");p(this,"introspectedLayout");p(this,"uniforms",{});p(this,"bindings",{});p(this,"varyings",null);p(this,"_uniformCount",0);p(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),B.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=cM(this.device.gl,this.handle),B.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=_3(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":B.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||B.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(s||B.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Yn)&&!(s.buffer instanceof Yn))throw new Error("buffer value");break;case"texture":if(!(s instanceof hi||s instanceof qt||s instanceof ks))throw new Error("texture value");break;case"sampler":B.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var S;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:c=!1,firstVertex:u=0,transformFeedback:h}=n,f=yM(s),m=!!o.indexBuffer,E=(S=o.indexBuffer)==null?void 0:S.glIndexType;if(this.linkStatus!=="success")return B.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),h&&h.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=r;return AI(this.device,i,w.glParameters,()=>{m&&c?this.device.gl.drawElementsInstanced(f,a||0,E,u,l||0):m?this.device.gl.drawElements(f,a||0,E,u):c?this.device.gl.drawArraysInstanced(f,u,a||0,l||0):this.device.gl.drawArrays(f,u,a||0),h&&h.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=cd(n);Object.keys(r).forEach(i=>{B.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),B.time(W_,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),B.timeEnd(W_,`linkProgram for ${this.id}`)(),B.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}B.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),B.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(n){var r;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,r]of Object.entries(this.bindings))r instanceof qt&&(r.update(),n=n&&r.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof Yn?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof hi||o instanceof qt||o instanceof ks))throw new Error("texture");let c;if(o instanceof hi)c=o.texture;else if(o instanceof qt)c=o;else if(o instanceof ks&&o.colorAttachments[0]instanceof hi)B.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(c.target,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&mM(this.device.gl,i,s,a)}}}class EM extends Ch{constructor(n){super(n,{});p(this,"device");p(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":wM(this.device,r.options);break;case"copy-buffer-to-texture":SM(this.device,r.options);break;case"copy-texture-to-buffer":AM(this.device,r.options);break;case"copy-texture-to-texture":RM(this.device,r.options);break}}}function wM(t,e){const n=e.source,r=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function SM(t,e){throw new Error("Not implemented")}function AM(t,e){const{source:n,mipLevel:r=0,aspect:i="all",width:s=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(i!=="all")throw new Error("not supported");if(r!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:m,destroyFramebuffer:E}=ET(n);let w;try{const S=c,_=s||m.width,d=o||m.height,y=ml(m.texture.props.format),A=y.dataFormat,b=y.type;t.gl.bindBuffer(35051,S.handle),w=t.gl.bindFramebuffer(36160,m.handle),t.gl.readPixels(l[0],l[1],_,d,A,b,u)}finally{t.gl.bindBuffer(35051,null),w!==void 0&&t.gl.bindFramebuffer(36160,w),E&&m.destroy()}}function RM(t,e){const{source:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destination:o}=e;let{width:a=e.destination.width,height:l=e.destination.height}=e;const{framebuffer:c,destroyFramebuffer:u}=ET(n),[h,f]=i,[m,E,w]=s,S=t.gl.bindFramebuffer(36160,c.handle);let _=null,d;if(o instanceof qt)_=o,a=Number.isFinite(a)?a:_.width,l=Number.isFinite(l)?l:_.height,_.bind(0),d=_.target;else throw new Error("invalid destination");switch(d){case 3553:case 34067:t.gl.copyTexSubImage2D(d,r,m,E,h,f,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(d,r,m,E,w,h,f,a,l);break}_&&_.unbind(),t.gl.bindFramebuffer(36160,S),u&&c.destroy()}function ET(t){if(t instanceof vt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class bM extends bh{constructor(n,r){super(n,r);p(this,"device");p(this,"commandBuffer");this.device=n,this.commandBuffer=new EM(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}class Td extends Ph{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"buffer",null);p(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return C1()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:h}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,h||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=pT(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=Td.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=CM(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!PM(i,this.bufferValue),a){const l=T3(r.constructor,o);E3({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function CM(t){return Array.isArray(t)?new Float32Array(t):t}function PM(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class xM extends xh{constructor(n,r){super(n,r);p(this,"device");p(this,"gl");p(this,"handle");p(this,"layout");p(this,"buffers",{});p(this,"unusedBuffers",{});p(this,"bindOnUse",!0);p(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(vM(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,B.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if($_(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof Yn)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if($_(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function $_(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class IM extends Ih{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"target",null);p(this,"_queryPending",!1);p(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function wT(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return le(!1),0}}function MM(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return le(!1),0}}function NM(t,e){var S,_;const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408,sourceAttachment:s=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:h}=ST(t);le(u);const{gl:f,handle:m}=u;a=a||u.width,l=l||u.height;const E=s-36064;c=c||((_=(S=u.colorAttachments[E])==null?void 0:S.texture)==null?void 0:_.type)||5121,o=FM(o,c,i,a,l),c=c||rM(o);const w=f.bindFramebuffer(36160,m);return f.readPixels(n,r,a,l,i,c,o),f.bindFramebuffer(36160,w||null),h&&u.destroy(),o}function kM(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:h}=ST(t);le(u),a=a||u.width,l=l||u.height;const f=u;c=c||5121;let m=n;if(!m){const w=wT(s),S=MM(c),_=o+a*l*w*S;m=f.device.createBuffer({byteLength:_})}const E=t.device.createCommandEncoder();return E.copyTextureToBuffer({source:t,width:a,height:l,origin:[r,i],destination:m,byteOffset:o}),E.destroy(),h&&u.destroy(),m}function ST(t){return t instanceof ol?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:OM(t),deleteFramebuffer:!0}}function OM(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function FM(t,e,n,r,i){if(t)return t;e=e||5121;const s=Xh(e,{clamped:!1}),o=wT(n);return new s(r*i*o)}const DM=256,UM=1024,BM=16384,LM="clear: bad arguments";function VM(t,e){const{framebuffer:n=null,color:r=null,depth:i=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=BM,r!==!0&&(o.clearColor=r)),i&&(a|=DM,i!==!0&&(o.clearDepth=i)),s&&(a|=UM,i!==!0&&(o.clearStencil=i)),le(a!==0,LM);const l=t.gl;Un(l,o,()=>{l.clear(a)})}const fs=1,hr=class hr extends Ni{constructor(n){var l,c;super({...n,id:n.id||Fr("webgl-device")});p(this,"type","webgl");p(this,"handle");p(this,"features");p(this,"limits");p(this,"info");p(this,"canvasContext");p(this,"lost");p(this,"_resolveContextLost");p(this,"renderPass",null);p(this,"gl");p(this,"debug",!1);p(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});p(this,"_extensions",{});p(this,"_polyfilled",!1);p(this,"spectorJS");p(this,"_constants");const r=(l=n.gl)==null?void 0:l.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=((c=n.gl)==null?void 0:c.canvas)||n.canvas;this.canvasContext=new DI(this,{...n,canvas:i}),this.lost=new Promise(u=>{this._resolveContextLost=u});let s=n.gl||null;if(s||(s=tI(this.canvasContext.canvas,{...n,onContextLost:u=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,n.spector&&(this.spectorJS=zI({...this.props,canvas:this.handle.canvas})),this.info=nI(this.gl,this._extensions),this.limits=new wI(this.gl),this.features=new EI(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;fT(this.gl,{enable:o,copyState:a,log:(...u)=>B.log(1,...u)()}),n.debug&&(this.gl=WI(this.gl,{...n,throwOnError:!0}),this.debug=!0,B.level=Math.max(B.level,1),B.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof hr)return n;if((n==null?void 0:n.device)instanceof Ni)return n.device;if(!zM(n))throw new Error("Invalid WebGL2RenderingContext");return new hr({gl:n})}static async create(n={}){var a;B.groupCollapsed(fs,"WebGLDevice created")();const r=[];n.debug&&r.push(HI()),n.spector&&r.push(VI()),typeof n.canvas=="string"&&r.push(ld.pageLoaded);const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&B.error(`Failed to initialize debug libraries ${l.reason}`)();if(B.probe(fs+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return B.warn("reattaching existing device")(),hr.attach(n.gl);const s=new hr(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return B.probe(fs,o)(),B.table(fs,s.info)(),B.groupEnd(fs)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return vd(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return mI(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return yI(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._getBufferProps(n);return new Yn(this,r)}_createTexture(n){return new qt(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new $h(this,n)}createShader(n){return new ZI(this,n)}createFramebuffer(n){return new ks(this,n)}createVertexArray(n){return new Td(this,n)}createTransformFeedback(n){return new xM(this,n)}createQuerySet(n){return new IM(this,n)}createRenderPipeline(n){return new TM(this,n)}beginRenderPass(n){return new tM(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new bM(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return NM(n,r)}readPixelsToBufferWebGL(n,r){return kM(n,r)}setParametersWebGL(n){$i(this.gl,n)}getParametersWebGL(n){return hT(this.gl,n)}withParametersWebGL(n,r){return Un(this.gl,n,r)}clearWebGL(n){VM(this,n)}resetWebGL(){B.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Kx(this.gl)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){sc(this.gl)}popState(){lo(this.gl)}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){r=r||this.gl2||this.gl;const i=Number(n);for(const s in r)if(r[s]===i)return`GL.${s}`;return String(n)}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&$M(s,r)&&B.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:jM(this,n,r);break;case Int32Array:HM(this,n,r);break;case Uint32Array:WM(this,n,r);break;default:le(!1)}}getExtension(n){return Qn(this.gl,n,this._extensions),this._extensions}};p(hr,"type","webgl");let Fs=hr;function zM(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function jM(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:le(!1)}}function HM(t,e,n){t.gl.vertexAttribI4iv(e,n)}function WM(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function $M(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var AT={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function h(g,v,R){return setTimeout(y(g,R),v)}function f(g,v,R){return Array.isArray(g)?(m(g,R[v],R),!0):!1}function m(g,v,R){var N;if(g)if(g.forEach)g.forEach(v,R);else if(g.length!==i)for(N=0;N<g.length;)v.call(R,g[N],N,g),N++;else for(N in g)g.hasOwnProperty(N)&&v.call(R,g[N],N,g)}function E(g,v,R){var N="DEPRECATED METHOD: "+v+`
`+R+` AT 
`;return function(){var D=new Error("get-stack-trace"),H=D&&D.stack?D.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Z=e.console&&(e.console.warn||e.console.log);return Z&&Z.call(e.console,N,H),g.apply(this,arguments)}}var w;typeof Object.assign!="function"?w=function(v){if(v===i||v===null)throw new TypeError("Cannot convert undefined or null to object");for(var R=Object(v),N=1;N<arguments.length;N++){var D=arguments[N];if(D!==i&&D!==null)for(var H in D)D.hasOwnProperty(H)&&(R[H]=D[H])}return R}:w=Object.assign;var S=E(function(v,R,N){for(var D=Object.keys(R),H=0;H<D.length;)(!N||N&&v[D[H]]===i)&&(v[D[H]]=R[D[H]]),H++;return v},"extend","Use `assign`."),_=E(function(v,R){return S(v,R,!0)},"merge","Use `assign`.");function d(g,v,R){var N=v.prototype,D;D=g.prototype=Object.create(N),D.constructor=g,D._super=N,R&&w(D,R)}function y(g,v){return function(){return g.apply(v,arguments)}}function A(g,v){return typeof g==a?g.apply(v&&v[0]||i,v):g}function b(g,v){return g===i?v:g}function I(g,v,R){m(F(v),function(N){g.addEventListener(N,R,!1)})}function k(g,v,R){m(F(v),function(N){g.removeEventListener(N,R,!1)})}function M(g,v){for(;g;){if(g==v)return!0;g=g.parentNode}return!1}function O(g,v){return g.indexOf(v)>-1}function F(g){return g.trim().split(/\s+/g)}function V(g,v,R){if(g.indexOf&&!R)return g.indexOf(v);for(var N=0;N<g.length;){if(R&&g[N][R]==v||!R&&g[N]===v)return N;N++}return-1}function z(g){return Array.prototype.slice.call(g,0)}function X(g,v,R){for(var N=[],D=[],H=0;H<g.length;){var Z=v?g[H][v]:g[H];V(D,Z)<0&&N.push(g[H]),D[H]=Z,H++}return R&&(v?N=N.sort(function(Ne,$e){return Ne[v]>$e[v]}):N=N.sort()),N}function $(g,v){for(var R,N,D=v[0].toUpperCase()+v.slice(1),H=0;H<s.length;){if(R=s[H],N=R?R+D:v,N in g)return N;H++}return i}var G=1;function dt(){return G++}function Qe(g){var v=g.ownerDocument||g;return v.defaultView||v.parentWindow||e}var j=/mobile|tablet|ip(ad|hone|od)|android/i,Y="ontouchstart"in e,q=$(e,"PointerEvent")!==i,K=Y&&j.test(navigator.userAgent),J="touch",he="pen",Ue="mouse",At="kinect",tn=25,Ee=1,nr=2,we=4,Je=8,So=1,Xi=2,Yi=4,Ki=8,qi=16,Dt=Xi|Yi,rr=Ki|qi,kd=Dt|rr,Od=["x","y"],Ao=["clientX","clientY"];function pt(g,v){var R=this;this.manager=g,this.callback=v,this.element=g.element,this.target=g.options.inputTarget,this.domHandler=function(N){A(g.options.enable,[g])&&R.handler(N)},this.init()}pt.prototype={handler:function(){},init:function(){this.evEl&&I(this.element,this.evEl,this.domHandler),this.evTarget&&I(this.target,this.evTarget,this.domHandler),this.evWin&&I(Qe(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(Qe(this.element),this.evWin,this.domHandler)}};function iE(g){var v,R=g.options.inputClass;return R?v=R:q?v=fc:K?v=Co:Y?v=dc:v=bo,new v(g,sE)}function sE(g,v,R){var N=R.pointers.length,D=R.changedPointers.length,H=v&Ee&&N-D===0,Z=v&(we|Je)&&N-D===0;R.isFirst=!!H,R.isFinal=!!Z,H&&(g.session={}),R.eventType=v,oE(g,R),g.emit("hammer.input",R),g.recognize(R),g.session.prevInput=R}function oE(g,v){var R=g.session,N=v.pointers,D=N.length;R.firstInput||(R.firstInput=Fd(v)),D>1&&!R.firstMultiple?R.firstMultiple=Fd(v):D===1&&(R.firstMultiple=!1);var H=R.firstInput,Z=R.firstMultiple,Ce=Z?Z.center:H.center,Ne=v.center=Dd(N);v.timeStamp=u(),v.deltaTime=v.timeStamp-H.timeStamp,v.angle=hc(Ce,Ne),v.distance=Ro(Ce,Ne),aE(R,v),v.offsetDirection=Bd(v.deltaX,v.deltaY);var $e=Ud(v.deltaTime,v.deltaX,v.deltaY);v.overallVelocityX=$e.x,v.overallVelocityY=$e.y,v.overallVelocity=c($e.x)>c($e.y)?$e.x:$e.y,v.scale=Z?uE(Z.pointers,N):1,v.rotation=Z?cE(Z.pointers,N):0,v.maxPointers=R.prevInput?v.pointers.length>R.prevInput.maxPointers?v.pointers.length:R.prevInput.maxPointers:v.pointers.length,lE(R,v);var Bt=g.element;M(v.srcEvent.target,Bt)&&(Bt=v.srcEvent.target),v.target=Bt}function aE(g,v){var R=v.center,N=g.offsetDelta||{},D=g.prevDelta||{},H=g.prevInput||{};(v.eventType===Ee||H.eventType===we)&&(D=g.prevDelta={x:H.deltaX||0,y:H.deltaY||0},N=g.offsetDelta={x:R.x,y:R.y}),v.deltaX=D.x+(R.x-N.x),v.deltaY=D.y+(R.y-N.y)}function lE(g,v){var R=g.lastInterval||v,N=v.timeStamp-R.timeStamp,D,H,Z,Ce;if(v.eventType!=Je&&(N>tn||R.velocity===i)){var Ne=v.deltaX-R.deltaX,$e=v.deltaY-R.deltaY,Bt=Ud(N,Ne,$e);H=Bt.x,Z=Bt.y,D=c(Bt.x)>c(Bt.y)?Bt.x:Bt.y,Ce=Bd(Ne,$e),g.lastInterval=v}else D=R.velocity,H=R.velocityX,Z=R.velocityY,Ce=R.direction;v.velocity=D,v.velocityX=H,v.velocityY=Z,v.direction=Ce}function Fd(g){for(var v=[],R=0;R<g.pointers.length;)v[R]={clientX:l(g.pointers[R].clientX),clientY:l(g.pointers[R].clientY)},R++;return{timeStamp:u(),pointers:v,center:Dd(v),deltaX:g.deltaX,deltaY:g.deltaY}}function Dd(g){var v=g.length;if(v===1)return{x:l(g[0].clientX),y:l(g[0].clientY)};for(var R=0,N=0,D=0;D<v;)R+=g[D].clientX,N+=g[D].clientY,D++;return{x:l(R/v),y:l(N/v)}}function Ud(g,v,R){return{x:v/g||0,y:R/g||0}}function Bd(g,v){return g===v?So:c(g)>=c(v)?g<0?Xi:Yi:v<0?Ki:qi}function Ro(g,v,R){R||(R=Od);var N=v[R[0]]-g[R[0]],D=v[R[1]]-g[R[1]];return Math.sqrt(N*N+D*D)}function hc(g,v,R){R||(R=Od);var N=v[R[0]]-g[R[0]],D=v[R[1]]-g[R[1]];return Math.atan2(D,N)*180/Math.PI}function cE(g,v){return hc(v[1],v[0],Ao)+hc(g[1],g[0],Ao)}function uE(g,v){return Ro(v[0],v[1],Ao)/Ro(g[0],g[1],Ao)}var hE={mousedown:Ee,mousemove:nr,mouseup:we},fE="mousedown",dE="mousemove mouseup";function bo(){this.evEl=fE,this.evWin=dE,this.pressed=!1,pt.apply(this,arguments)}d(bo,pt,{handler:function(v){var R=hE[v.type];R&Ee&&v.button===0&&(this.pressed=!0),R&nr&&v.which!==1&&(R=we),this.pressed&&(R&we&&(this.pressed=!1),this.callback(this.manager,R,{pointers:[v],changedPointers:[v],pointerType:Ue,srcEvent:v}))}});var pE={pointerdown:Ee,pointermove:nr,pointerup:we,pointercancel:Je,pointerout:Je},gE={2:J,3:he,4:Ue,5:At},Ld="pointerdown",Vd="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ld="MSPointerDown",Vd="MSPointerMove MSPointerUp MSPointerCancel");function fc(){this.evEl=Ld,this.evWin=Vd,pt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}d(fc,pt,{handler:function(v){var R=this.store,N=!1,D=v.type.toLowerCase().replace("ms",""),H=pE[D],Z=gE[v.pointerType]||v.pointerType,Ce=Z==J,Ne=V(R,v.pointerId,"pointerId");H&Ee&&(v.button===0||Ce)?Ne<0&&(R.push(v),Ne=R.length-1):H&(we|Je)&&(N=!0),!(Ne<0)&&(R[Ne]=v,this.callback(this.manager,H,{pointers:R,changedPointers:[v],pointerType:Z,srcEvent:v}),N&&R.splice(Ne,1))}});var _E={touchstart:Ee,touchmove:nr,touchend:we,touchcancel:Je},mE="touchstart",yE="touchstart touchmove touchend touchcancel";function zd(){this.evTarget=mE,this.evWin=yE,this.started=!1,pt.apply(this,arguments)}d(zd,pt,{handler:function(v){var R=_E[v.type];if(R===Ee&&(this.started=!0),!!this.started){var N=vE.call(this,v,R);R&(we|Je)&&N[0].length-N[1].length===0&&(this.started=!1),this.callback(this.manager,R,{pointers:N[0],changedPointers:N[1],pointerType:J,srcEvent:v})}}});function vE(g,v){var R=z(g.touches),N=z(g.changedTouches);return v&(we|Je)&&(R=X(R.concat(N),"identifier",!0)),[R,N]}var TE={touchstart:Ee,touchmove:nr,touchend:we,touchcancel:Je},EE="touchstart touchmove touchend touchcancel";function Co(){this.evTarget=EE,this.targetIds={},pt.apply(this,arguments)}d(Co,pt,{handler:function(v){var R=TE[v.type],N=wE.call(this,v,R);N&&this.callback(this.manager,R,{pointers:N[0],changedPointers:N[1],pointerType:J,srcEvent:v})}});function wE(g,v){var R=z(g.touches),N=this.targetIds;if(v&(Ee|nr)&&R.length===1)return N[R[0].identifier]=!0,[R,R];var D,H,Z=z(g.changedTouches),Ce=[],Ne=this.target;if(H=R.filter(function($e){return M($e.target,Ne)}),v===Ee)for(D=0;D<H.length;)N[H[D].identifier]=!0,D++;for(D=0;D<Z.length;)N[Z[D].identifier]&&Ce.push(Z[D]),v&(we|Je)&&delete N[Z[D].identifier],D++;if(Ce.length)return[X(H.concat(Ce),"identifier",!0),Ce]}var SE=2500,jd=25;function dc(){pt.apply(this,arguments);var g=y(this.handler,this);this.touch=new Co(this.manager,g),this.mouse=new bo(this.manager,g),this.primaryTouch=null,this.lastTouches=[]}d(dc,pt,{handler:function(v,R,N){var D=N.pointerType==J,H=N.pointerType==Ue;if(!(H&&N.sourceCapabilities&&N.sourceCapabilities.firesTouchEvents)){if(D)AE.call(this,R,N);else if(H&&RE.call(this,N))return;this.callback(v,R,N)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function AE(g,v){g&Ee?(this.primaryTouch=v.changedPointers[0].identifier,Hd.call(this,v)):g&(we|Je)&&Hd.call(this,v)}function Hd(g){var v=g.changedPointers[0];if(v.identifier===this.primaryTouch){var R={x:v.clientX,y:v.clientY};this.lastTouches.push(R);var N=this.lastTouches,D=function(){var H=N.indexOf(R);H>-1&&N.splice(H,1)};setTimeout(D,SE)}}function RE(g){for(var v=g.srcEvent.clientX,R=g.srcEvent.clientY,N=0;N<this.lastTouches.length;N++){var D=this.lastTouches[N],H=Math.abs(v-D.x),Z=Math.abs(R-D.y);if(H<=jd&&Z<=jd)return!0}return!1}var Wd=$(o.style,"touchAction"),$d=Wd!==i,Xd="compute",Yd="auto",pc="manipulation",ir="none",Zi="pan-x",Qi="pan-y",Po=CE();function gc(g,v){this.manager=g,this.set(v)}gc.prototype={set:function(g){g==Xd&&(g=this.compute()),$d&&this.manager.element.style&&Po[g]&&(this.manager.element.style[Wd]=g),this.actions=g.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var g=[];return m(this.manager.recognizers,function(v){A(v.options.enable,[v])&&(g=g.concat(v.getTouchAction()))}),bE(g.join(" "))},preventDefaults:function(g){var v=g.srcEvent,R=g.offsetDirection;if(this.manager.session.prevented){v.preventDefault();return}var N=this.actions,D=O(N,ir)&&!Po[ir],H=O(N,Qi)&&!Po[Qi],Z=O(N,Zi)&&!Po[Zi];if(D){var Ce=g.pointers.length===1,Ne=g.distance<2,$e=g.deltaTime<250;if(Ce&&Ne&&$e)return}if(!(Z&&H)&&(D||H&&R&Dt||Z&&R&rr))return this.preventSrc(v)},preventSrc:function(g){this.manager.session.prevented=!0,g.preventDefault()}};function bE(g){if(O(g,ir))return ir;var v=O(g,Zi),R=O(g,Qi);return v&&R?ir:v||R?v?Zi:Qi:O(g,pc)?pc:Yd}function CE(){if(!$d)return!1;var g={},v=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(R){g[R]=v?e.CSS.supports("touch-action",R):!0}),g}var xo=1,gt=2,Ur=4,En=8,nn=En,Ji=16,Ut=32;function rn(g){this.options=w({},this.defaults,g||{}),this.id=dt(),this.manager=null,this.options.enable=b(this.options.enable,!0),this.state=xo,this.simultaneous={},this.requireFail=[]}rn.prototype={defaults:{},set:function(g){return w(this.options,g),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(g){if(f(g,"recognizeWith",this))return this;var v=this.simultaneous;return g=Io(g,this),v[g.id]||(v[g.id]=g,g.recognizeWith(this)),this},dropRecognizeWith:function(g){return f(g,"dropRecognizeWith",this)?this:(g=Io(g,this),delete this.simultaneous[g.id],this)},requireFailure:function(g){if(f(g,"requireFailure",this))return this;var v=this.requireFail;return g=Io(g,this),V(v,g)===-1&&(v.push(g),g.requireFailure(this)),this},dropRequireFailure:function(g){if(f(g,"dropRequireFailure",this))return this;g=Io(g,this);var v=V(this.requireFail,g);return v>-1&&this.requireFail.splice(v,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(g){return!!this.simultaneous[g.id]},emit:function(g){var v=this,R=this.state;function N(D){v.manager.emit(D,g)}R<En&&N(v.options.event+Kd(R)),N(v.options.event),g.additionalEvent&&N(g.additionalEvent),R>=En&&N(v.options.event+Kd(R))},tryEmit:function(g){if(this.canEmit())return this.emit(g);this.state=Ut},canEmit:function(){for(var g=0;g<this.requireFail.length;){if(!(this.requireFail[g].state&(Ut|xo)))return!1;g++}return!0},recognize:function(g){var v=w({},g);if(!A(this.options.enable,[this,v])){this.reset(),this.state=Ut;return}this.state&(nn|Ji|Ut)&&(this.state=xo),this.state=this.process(v),this.state&(gt|Ur|En|Ji)&&this.tryEmit(v)},process:function(g){},getTouchAction:function(){},reset:function(){}};function Kd(g){return g&Ji?"cancel":g&En?"end":g&Ur?"move":g&gt?"start":""}function qd(g){return g==qi?"down":g==Ki?"up":g==Xi?"left":g==Yi?"right":""}function Io(g,v){var R=v.manager;return R?R.get(g):g}function Rt(){rn.apply(this,arguments)}d(Rt,rn,{defaults:{pointers:1},attrTest:function(g){var v=this.options.pointers;return v===0||g.pointers.length===v},process:function(g){var v=this.state,R=g.eventType,N=v&(gt|Ur),D=this.attrTest(g);return N&&(R&Je||!D)?v|Ji:N||D?R&we?v|En:v&gt?v|Ur:gt:Ut}});function Mo(){Rt.apply(this,arguments),this.pX=null,this.pY=null}d(Mo,Rt,{defaults:{event:"pan",threshold:10,pointers:1,direction:kd},getTouchAction:function(){var g=this.options.direction,v=[];return g&Dt&&v.push(Qi),g&rr&&v.push(Zi),v},directionTest:function(g){var v=this.options,R=!0,N=g.distance,D=g.direction,H=g.deltaX,Z=g.deltaY;return D&v.direction||(v.direction&Dt?(D=H===0?So:H<0?Xi:Yi,R=H!=this.pX,N=Math.abs(g.deltaX)):(D=Z===0?So:Z<0?Ki:qi,R=Z!=this.pY,N=Math.abs(g.deltaY))),g.direction=D,R&&N>v.threshold&&D&v.direction},attrTest:function(g){return Rt.prototype.attrTest.call(this,g)&&(this.state&gt||!(this.state&gt)&&this.directionTest(g))},emit:function(g){this.pX=g.deltaX,this.pY=g.deltaY;var v=qd(g.direction);v&&(g.additionalEvent=this.options.event+v),this._super.emit.call(this,g)}});function _c(){Rt.apply(this,arguments)}d(_c,Rt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ir]},attrTest:function(g){return this._super.attrTest.call(this,g)&&(Math.abs(g.scale-1)>this.options.threshold||this.state&gt)},emit:function(g){if(g.scale!==1){var v=g.scale<1?"in":"out";g.additionalEvent=this.options.event+v}this._super.emit.call(this,g)}});function mc(){rn.apply(this,arguments),this._timer=null,this._input=null}d(mc,rn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Yd]},process:function(g){var v=this.options,R=g.pointers.length===v.pointers,N=g.distance<v.threshold,D=g.deltaTime>v.time;if(this._input=g,!N||!R||g.eventType&(we|Je)&&!D)this.reset();else if(g.eventType&Ee)this.reset(),this._timer=h(function(){this.state=nn,this.tryEmit()},v.time,this);else if(g.eventType&we)return nn;return Ut},reset:function(){clearTimeout(this._timer)},emit:function(g){this.state===nn&&(g&&g.eventType&we?this.manager.emit(this.options.event+"up",g):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function yc(){Rt.apply(this,arguments)}d(yc,Rt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ir]},attrTest:function(g){return this._super.attrTest.call(this,g)&&(Math.abs(g.rotation)>this.options.threshold||this.state&gt)}});function vc(){Rt.apply(this,arguments)}d(vc,Rt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Dt|rr,pointers:1},getTouchAction:function(){return Mo.prototype.getTouchAction.call(this)},attrTest:function(g){var v=this.options.direction,R;return v&(Dt|rr)?R=g.overallVelocity:v&Dt?R=g.overallVelocityX:v&rr&&(R=g.overallVelocityY),this._super.attrTest.call(this,g)&&v&g.offsetDirection&&g.distance>this.options.threshold&&g.maxPointers==this.options.pointers&&c(R)>this.options.velocity&&g.eventType&we},emit:function(g){var v=qd(g.offsetDirection);v&&this.manager.emit(this.options.event+v,g),this.manager.emit(this.options.event,g)}});function No(){rn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}d(No,rn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pc]},process:function(g){var v=this.options,R=g.pointers.length===v.pointers,N=g.distance<v.threshold,D=g.deltaTime<v.time;if(this.reset(),g.eventType&Ee&&this.count===0)return this.failTimeout();if(N&&D&&R){if(g.eventType!=we)return this.failTimeout();var H=this.pTime?g.timeStamp-this.pTime<v.interval:!0,Z=!this.pCenter||Ro(this.pCenter,g.center)<v.posThreshold;this.pTime=g.timeStamp,this.pCenter=g.center,!Z||!H?this.count=1:this.count+=1,this._input=g;var Ce=this.count%v.taps;if(Ce===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=nn,this.tryEmit()},v.interval,this),gt):nn}return Ut},failTimeout:function(){return this._timer=h(function(){this.state=Ut},this.options.interval,this),Ut},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==nn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function sn(g,v){return v=v||{},v.recognizers=b(v.recognizers,sn.defaults.preset),new Tc(g,v)}sn.VERSION="2.0.7",sn.defaults={domEvents:!1,touchAction:Xd,enable:!0,inputTarget:null,inputClass:null,preset:[[yc,{enable:!1}],[_c,{enable:!1},["rotate"]],[vc,{direction:Dt}],[Mo,{direction:Dt},["swipe"]],[No],[No,{event:"doubletap",taps:2},["tap"]],[mc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var PE=1,Zd=2;function Tc(g,v){this.options=w({},sn.defaults,v||{}),this.options.inputTarget=this.options.inputTarget||g,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=g,this.input=iE(this),this.touchAction=new gc(this,this.options.touchAction),Qd(this,!0),m(this.options.recognizers,function(R){var N=this.add(new R[0](R[1]));R[2]&&N.recognizeWith(R[2]),R[3]&&N.requireFailure(R[3])},this)}Tc.prototype={set:function(g){return w(this.options,g),g.touchAction&&this.touchAction.update(),g.inputTarget&&(this.input.destroy(),this.input.target=g.inputTarget,this.input.init()),this},stop:function(g){this.session.stopped=g?Zd:PE},recognize:function(g){var v=this.session;if(!v.stopped){this.touchAction.preventDefaults(g);var R,N=this.recognizers,D=v.curRecognizer;(!D||D&&D.state&nn)&&(D=v.curRecognizer=null);for(var H=0;H<N.length;)R=N[H],v.stopped!==Zd&&(!D||R==D||R.canRecognizeWith(D))?R.recognize(g):R.reset(),!D&&R.state&(gt|Ur|En)&&(D=v.curRecognizer=R),H++}},get:function(g){if(g instanceof rn)return g;for(var v=this.recognizers,R=0;R<v.length;R++)if(v[R].options.event==g)return v[R];return null},add:function(g){if(f(g,"add",this))return this;var v=this.get(g.options.event);return v&&this.remove(v),this.recognizers.push(g),g.manager=this,this.touchAction.update(),g},remove:function(g){if(f(g,"remove",this))return this;if(g=this.get(g),g){var v=this.recognizers,R=V(v,g);R!==-1&&(v.splice(R,1),this.touchAction.update())}return this},on:function(g,v){if(g!==i&&v!==i){var R=this.handlers;return m(F(g),function(N){R[N]=R[N]||[],R[N].push(v)}),this}},off:function(g,v){if(g!==i){var R=this.handlers;return m(F(g),function(N){v?R[N]&&R[N].splice(V(R[N],v),1):delete R[N]}),this}},emit:function(g,v){this.options.domEvents&&xE(g,v);var R=this.handlers[g]&&this.handlers[g].slice();if(!(!R||!R.length)){v.type=g,v.preventDefault=function(){v.srcEvent.preventDefault()};for(var N=0;N<R.length;)R[N](v),N++}},destroy:function(){this.element&&Qd(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Qd(g,v){var R=g.element;if(R.style){var N;m(g.options.cssProps,function(D,H){N=$(R.style,H),v?(g.oldCssProps[N]=R.style[N],R.style[N]=D):R.style[N]=g.oldCssProps[N]||""}),v||(g.oldCssProps={})}}function xE(g,v){var R=n.createEvent("Event");R.initEvent(g,!0,!0),R.gesture=v,v.target.dispatchEvent(R)}w(sn,{INPUT_START:Ee,INPUT_MOVE:nr,INPUT_END:we,INPUT_CANCEL:Je,STATE_POSSIBLE:xo,STATE_BEGAN:gt,STATE_CHANGED:Ur,STATE_ENDED:En,STATE_RECOGNIZED:nn,STATE_CANCELLED:Ji,STATE_FAILED:Ut,DIRECTION_NONE:So,DIRECTION_LEFT:Xi,DIRECTION_RIGHT:Yi,DIRECTION_UP:Ki,DIRECTION_DOWN:qi,DIRECTION_HORIZONTAL:Dt,DIRECTION_VERTICAL:rr,DIRECTION_ALL:kd,Manager:Tc,Input:pt,TouchAction:gc,TouchInput:Co,MouseInput:bo,PointerEventInput:fc,TouchMouseInput:dc,SingleTouchInput:zd,Recognizer:rn,AttrRecognizer:Rt,Tap:No,Pan:Mo,Swipe:vc,Pinch:_c,Rotate:yc,Press:mc,on:I,off:k,each:m,merge:_,extend:S,assign:w,inherit:d,bindFn:y,prefixed:$});var IE=typeof e<"u"?e:typeof self<"u"?self:{};IE.Hammer=sn,typeof i=="function"&&i.amd?i(function(){return sn}):t.exports?t.exports=sn:e[r]=sn})(window,document,"Hammer")})(AT);var wo=AT.exports;const XM=bm(wo),Ht=kE({__proto__:null,default:XM},[wo]),RT=1,bT=2,Yh=4,YM={mousedown:RT,mousemove:bT,mouseup:Yh};function KM(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function qM(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(KM(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function ZM(t){t.prototype.handler=function(n){let r=YM[n.type];r&RT&&n.button>=0&&(this.pressed=!0),r&bT&&n.buttons===0&&(r=Yh),this.pressed&&(r&Yh&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}qM(wo.PointerEventInput);ZM(wo.MouseInput);const QM=wo.Manager;class ac{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const JM=Ht?[[Ht.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ht.Rotate,{enable:!1}],[Ht.Pinch,{enable:!1}],[Ht.Swipe,{enable:!1}],[Ht.Pan,{threshold:0,enable:!1}],[Ht.Press,{enable:!1}],[Ht.Tap,{event:"doubletap",taps:2,enable:!1}],[Ht.Tap,{event:"anytap",enable:!1}],[Ht.Tap,{enable:!1}]]:null,X_={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},GM={doubletap:["tap"]},eN={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ed={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},tN={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Y_={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},nN=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",fi=typeof window<"u"?window:global;let Kh=!1;try{const t={get passive(){return Kh=!0,!0}};fi.addEventListener("test",null,t),fi.removeEventListener("test",null)}catch{Kh=!1}const rN=nN.indexOf("firefox")!==-1,{WHEEL_EVENTS:iN}=Ed,K_="wheel",q_=4.000244140625,sN=40,oN=.25;class aN extends ac{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;fi.WheelEvent&&(rN&&i.deltaMode===fi.WheelEvent.DOM_DELTA_PIXEL&&(s/=fi.devicePixelRatio),i.deltaMode===fi.WheelEvent.DOM_DELTA_LINE&&(s*=sN)),s!==0&&s%q_===0&&(s=Math.floor(s/q_)),i.shiftKey&&s&&(s=s*oN),this.callback({type:K_,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(iN),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,Kh?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===K_&&(this.options.enable=n)}}const{MOUSE_EVENTS:lN}=Ed,Z_="pointermove",Q_="pointerover",J_="pointerout",G_="pointerenter",em="pointerleave";class cN extends ac{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(lN),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Z_&&(this.enableMoveEvent=n),e===Q_&&(this.enableOverEvent=n),e===J_&&(this.enableOutEvent=n),e===G_&&(this.enableEnterEvent=n),e===em&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Q_,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(J_,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(G_,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(em,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(Z_,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:uN}=Ed,tm="keydown",nm="keyup";class hN extends ac{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:tm,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:nm,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(uN),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===tm&&(this.enableDownEvent=n),e===nm&&(this.enableUpEvent=n)}}const rm="contextmenu";class fN extends ac{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:rm,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===rm&&(this.options.enable=n)}}const im=1,qh=2,sm=4,dN={pointerdown:im,pointermove:qh,pointerup:sm,mousedown:im,mousemove:qh,mouseup:sm},pN=0,gN=1,_N=2,mN=1,yN=2,vN=4;function TN(t){const e=dN[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===qh?(i=!!(n&mN),s=!!(n&vN),o=!!(n&yN)):(i=r===pN,s=r===gN,o=r===_N),{leftButton:i,middleButton:s,rightButton:o}}function EN(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const Eu={srcElement:"root",priority:0};class wN{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=Eu;typeof r=="string"||r&&r.addEventListener?l={...Eu,srcElement:r}:r&&(l={...Eu,...r});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=c.length-1;for(;h>=0&&!(c[h].priority>=u.priority);)h--;c.splice(h+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:h}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),h&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...TN(e),...EN(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const SN={events:null,recognizers:null,recognizerOptions:{},Manager:QM,touchAction:"none",tabIndex:0};class AN{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=eN[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...SN,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||JM}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(X_).forEach(i=>{const s=this.manager.get(i);s&&X_[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new aN(e,this._onOtherEvent,{enable:!1}),this.moveInput=new cN(e,this._onOtherEvent,{enable:!1}),this.keyInput=new hN(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new fN(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=GM[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,l=Y_[e]||e;let c=a.get(l);c||(c=new wN(this),a.set(l,c),c.recognizerName=tN[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,r,i,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=Y_[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function bn(){}const RN=({isDragging:t})=>t?"grabbing":"grab",CT={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:bn,onWebGLInitialized:bn,onResize:bn,onViewStateChange:bn,onInteractionStateChange:bn,onBeforeRender:bn,onAfterRender:bn,onLoad:bn,onError:t=>ne.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:RN,getTooltip:null,debug:!1,drawPickingColors:!1};class wd{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Gl({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=Uh[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i.handler]||l.props[i.handler]),u=this.props[i.handler];let h=!1;c&&(h=c.call(l,a,r)),h||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...CT,...e},e=this.props,e.viewState&&e.initialViewState&&ne.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&ne.error("WebGL1 context not supported.")(),this.device=Fs.attach(e.gl));let n=this.device;n||(Ti.registerDevices([Fs]),n=Ti.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&so.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ne.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ne.removed("onLayerClick","onClick")(),e.initialViewState&&!Mt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return He(this.viewManager),this.viewManager.views}getViewports(e){return He(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){He(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),He(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new K2({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new Cx({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const c of s)a=c,l=((n=c.layer)==null?void 0:n.onHover(c,e.event))||l;l||((i=(r=this.props).onHover)==null||i.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Fs&&this.props.onWebGLInitialized(this.device.gl);const n=new iT;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new AN(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Uh)this.eventManager.on(o,this._onEvent);this.viewManager=new dx({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new fx(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new Ix({deck:this,device:this.device}),this.deckRenderer=new kx(this.device),this.deckPicker=new Lx(this.device),this.widgetManager=new jx({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new Wx),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ne.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Ti.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}wd.defaultProps=CT;wd.VERSION=nb;const bN=wd;function CN(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return wv(t)}}const PN=Ev;function ca(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function mr(t){return t.stride||t.size*t.bytesPerElement}function xN(t,e){return t.type===e.type&&t.size===e.size&&mr(t)===mr(e)&&(t.offset||0)===(e.offset||0)}function Zh(t,e){e.offset&&ne.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=mr(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function IN(t,e){const n=Zh(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class MN{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=CN(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*mr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),so.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=Zh(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:mr(r),attributes:i};if(this.doublePrecision){const o=IN(r,n||{});i.push(ca(e,{...r,...o.high}),ca(`${e}64Low`,{...r,...o.low}))}else if(n){const o=Zh(r,n);i.push(ca(e,{...r,...o}))}else i.push(ca(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof ge?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=PN(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=mr(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=mr(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=lu(s,i)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?lu(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=so.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?lu(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ne.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:n?ge.INDEX:ge.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const om=[],am=[];function PT(t,e=0,n=1/0){let r=om;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(am.length=t.length,r=am):r=om,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function xT(t){return t&&t[Symbol.asyncIterator]}function NN(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(h,{index:f,target:m})=>{if(!s){const _=f*l+c;for(let d=0;d<n;d++)m[d]=t[_+d];return m}const E=s[f],w=s[f+1]||u;let S;if(o){S=new Array(w-E);for(let _=E;_<w;_++){const d=_*l+c;m=new Array(n);for(let y=0;y<n;y++)m[y]=t[d+y];S[_-E]=m}}else if(l===n)S=t.subarray(E*n+c,w*n+c);else{S=new t.constructor((w-E)*n);let _=0;for(let d=E;d<w;d++){const y=d*l+c;for(let A=0;A<n;A++)S[_++]=t[y+A]}}return S}}const kN=[],Aa=[[0,1/0]];function ON(t,e){if(t===Aa||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const FN={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function IT(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...FN[n],...e,...t,type:n}}class MT extends MN{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Aa}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!xN(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return IT(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=ON(this.state.updateRanges,[r,i])}else this.state.updateRanges=Aa}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=kN}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Aa),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const h=Number.isFinite(c)?this.getVertexOffset(c):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;He(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=NN(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=e,{accessor:f,transform:m}=a,E=l.binaryAccessor||(typeof f=="function"?f:s[f]);He(typeof E=="function",`accessor "${f}" is not a function`);let w=e.getVertexOffset(r);const{iterable:S,objectInfo:_}=PT(n,r,i);for(const d of S){_.index++;let y=E(d,_);if(m&&(y=m.call(this,y)),h){const A=(_.index<h.length-1?h[_.index+1]:o)-h[_.index];if(y&&Array.isArray(y[0])){let b=w;for(const I of y)e._normalizeValue(I,c,b),b+=u}else y&&y.length>u?c.set(y,w):(e._normalizeValue(y,_.target,0),ax({target:c,source:_.target,start:w,count:A}));w+=A*u}else e._normalizeValue(y,c,w),w+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function wu(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let h=0;h<i;h++)n[r+c]=u[h]||0,c++}}function DN({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return wu({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,h)=>r(u+a,h)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const h=i[u]*n,f=s[u]*n;wu({source:t.subarray(o,h),target:e,start:a,end:f,size:n,getData:l}),o=h,a=f}return a<e.length&&wu({source:[],target:e,start:a,size:n,getData:l}),e}function UN(t){const{device:e,settings:n,value:r}=t,i=new MT(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function NT(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function kT(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function OT(t){t.push(t.shift())}function BN(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function FT({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function DT({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,f=s&&h,m=n.isConstant;if(!f&&e&&r>=i)return e;const E=n.value instanceof Float64Array?Float32Array:n.value.constructor,w=m?n.value:new E(n.getBuffer().readSyncWebGL(c,i*E.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!m){const y=o;o=(A,b)=>n.normalizeConstant(y(A,b))}const S=m?(y,A)=>o(w,A):(y,A)=>o(w.subarray(y+c,y+c+l),A),_=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),d=new Float32Array(i);return DN({source:_,target:d,sourceStartIndices:s,targetStartIndices:h,size:l,getData:S}),(!e||e.byteLength<d.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:d.byteLength+u,usage:35050})),e.write(d,u),e}class UT{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new ic(r),this.attribute=n,this.attributeInTransition=UN(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=BN(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class LN extends UT{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=jN(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;OT(s),s[0]=DT({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=FT({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;let c=Math.floor(this.currentLength/o.size);BT(o)&&(c/=2),l.setVertexCount(c),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform;s.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const VN=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,zN=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function BT(t){return t.doublePrecision&&t.value instanceof Float64Array}function jN(t,e){const n=e.size,r=NT(n),i=kT(n),s=e.getBufferLayout();return BT(e)?new ao(t,{vs:zN,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[xC],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new ao(t,{vs:VN,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class HN extends UT{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=YN(e),this.framebuffer=KN(e,this.texture),this.transform=XN(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=DT({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=FT({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),OT(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const WN=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,$N=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function XN(t,e){const n=NT(e.size),r=kT(e.size);return new ao(t,{vs:WN,fs:$N,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function YN(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function KN(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const qN={interpolation:LN,spring:HN};class ZN{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=qN[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(ne.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const lm="attributeManager.invalidate",QN="attributeManager.updateStart",JN="attributeManager.updateEnd",GN="attribute.updateStart",ek="attribute.allocate",tk="attribute.updateEnd";class LT{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Eo(N2),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new ZN(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);ze(lm,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);ze(lm,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;ze(QN,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],h=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&ne.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(s[h])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&ze(JN,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new MT(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(ze(GN,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&ze(ek,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,ze(tk,n,r))}}class nk extends ic{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=ul(n,r,o)}}const cm=1e-5;function um(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function rk(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=um(t[o],e[o],n[o],r,i);return s}return um(t,e,n,r,i)}function hm(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class ik extends ic{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=rk(s,o,n,r,i);const l=hm(a,n),c=hm(a,o);l<cm&&c<cm&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const sk={interpolation:nk,spring:ik};class ok{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=IT(i),!i)return;const o=sk[i.type];if(!o){ne.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function ak(t){const e=t[Xn];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function lk(t,e){const n=Sd({newProps:t,oldProps:e,propTypes:t[Xn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=uk(t,e);let i=!1;return r||(i=hk(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:fk(t,e),transitionsChanged:ck(t,e)}}function ck(t,e){if(!t.transitions)return!1;const n={},r=t[Xn];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Qh(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function Sd({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=Qh(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Qh(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Qh(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function uk(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function hk(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&fm(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&fm(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function fk(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function fm(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},Sd({oldProps:i,newProps:r,triggerName:n})}const dk="count(): argument not an object",pk="count(): argument not a container";function gk(t){if(!mk(t))throw new Error(dk);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(_k(t))return Object.keys(t).length;throw new Error(pk)}function _k(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function mk(t){return t!==null&&typeof t=="object"}function dm(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const yk={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Jh={};function vk(t,e,n,r){if(n instanceof vt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...yk,...i,...r}});return Jh[s.id]=t,s}function Tk(t,e){!e||!(e instanceof vt)||Jh[e.id]===t&&(e.delete(),delete Jh[e.id])}const Ek={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Gh(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Mt(t,e,1)}},accessor:{validate(t,e){const n=yl(t);return n==="function"||n===yl(e.value)},equal(t,e,n){return typeof e=="function"?!0:Mt(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Gh(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Mt(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Mt(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:vk(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{Tk(n.id,t)}}};function wk(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=Sk(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function Sk(t,e){switch(yl(e)){case"object":return ds(t,e);case"array":return ds(t,{type:"array",value:e,compare:!1});case"boolean":return ds(t,{type:"boolean",value:e});case"number":return ds(t,{type:"number",value:e});case"function":return ds(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ds(t,e){return"type"in e?{name:t,...Ek[e.type],...e}:"value"in e?{name:t,type:yl(e.value),...e}:{name:t,type:"object",value:e}}function Gh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function yl(t){return Gh(t)?"array":t===null?"null":typeof t}function Ak(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=ef(t.constructor,n),i=Object.create(r);i[_l]=t,i[Pr]={},i[Dn]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const Rk="_mergedDefaultProps";function ef(t,e){let n=Rk;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=VT(t,n);return r||(t[n]=bk(t,e||[]))}function bk(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=ef(r),s=VT(t,"defaultProps")||{},o=wk(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[Xn],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[hu],o.deprecatedProps);for(const u of e){const h=ef(u.constructor);h&&(Object.assign(a,h),Object.assign(l,h[Xn]),Object.assign(c,h[hu]))}return Ck(a,t),xk(a,l),Pk(a,c),a[Xn]=l,a[hu]=c,e.length===0&&!Ad(t,"_propTypes")&&(t._propTypes=l),a}function Ck(t,e){const n=Mk(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function Pk(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])Ad(this,s)||(this[s]=r);ne.deprecated(i,e[n].join("/"))()}})}function xk(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=Ik(o))}t[Si]=n,t[Pr]={},Object.defineProperties(t,r)}function Ik(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||xT(e)?this[Pr][t]=e:this[Dn][t]=e},get(){if(this[Dn]){if(t in this[Dn])return this[Dn][t]||this[Si][t];if(t in this[Pr]){const e=this[_l]&&this[_l].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Si][t]}}return this[Si][t]}}}function Ad(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function VT(t,e){return Ad(t,e)&&t[e]}function Mk(t){const e=t.componentName;return e||ne.warn(`${t.name}.componentName not specified`)(),e||t.name}let Nk=0;class Rd{constructor(...e){this.props=Ak(this,e),this.id=this.props.id,this.count=Nk++}clone(e){const{props:n}=this,r={};for(const i in n[Si])i in n[Dn]?r[i]=n[Dn][i]:i in n[Pr]&&(r[i]=n[Pr][i]);return new this.constructor({...n,...r,...e})}}Rd.componentName="Component";Rd.defaultProps={};const kk=Rd,Ok=Object.freeze({});class Fk{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Ok}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[_l]||this.component;const n=e[Dn]||{},r=e[Pr]||e,i=e[Si]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(xT(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Xn];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class Dk extends Fk{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const Uk="layer.changeFlag",Bk="layer.initialize",Lk="layer.update",Vk="layer.finalize",zk="layer.matched",pm=2**24-1,jk=Object.freeze([]),Hk=Eo(({oldViewport:t,viewport:e})=>t.equals(e));let Wt=new Uint8ClampedArray(0);const Wk={data:{type:"data",value:jk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:Ga(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):Ga(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:te.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class bd extends kk{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Yr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){He(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=tT(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=Zv(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return He(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){He(this.internalState);const r=this.internalState.viewport||this.context.viewport;return nT(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===te.DEFAULT||e===te.LNGLAT||e===te.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){He(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:gk(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=dm(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=dm(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!Hk({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Wt.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>pm&&ne.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Wt=so.allocate(Wt,n,{size:4,copy:!0,maxCount:Math.max(n,pm)});const i=Math.floor(Wt.length/4),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Wt[o*4+0]=s[0],Wt[o*4+1]=s[1],Wt[o*4+2]=s[2]}e.value=Wt.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const c=n[l].getValue();for(const u in c){const h=c[u];h instanceof ge?n[l].settings.isIndexed?e.setIndexBuffer(h):s[u]=h:h&&(o[u]=h)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Wt.buffer&&(r.value=Wt.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){He(!this.internalState),He(Number.isFinite(this.props.coordinateSystem)),ze(Bk,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Dk({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ne.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new ok(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ze(zk,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(ze(Lk,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){ze(Vk,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:h}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:h}})}const{getPolygonOffset:l}=this.props,c=l&&l(r)||[0,0];o.device.setParametersWebGL({polygonOffset:c});for(const u of this.getModels())u.setParameters(i);o.device.withParametersWebGL(i,()=>{const u={renderPass:e,moduleParameters:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,u,h);this.draw(u)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&ze(Uk,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=lk(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){ak(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new LT(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};Array.isArray(l)&&(c.highlightColor=l),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}bd.defaultProps=Wk;bd.layerName="Layer";const Cd=bd,$k="compositeLayer.renderLayers";class zT extends Cd{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var k;const{opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:m,modelMatrix:E,extensions:w,fetch:S,operation:_,_subLayerProps:d}=this.props,y={id:"",updateTriggers:{},opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:m,modelMatrix:E,extensions:w,fetch:S,operation:_},A=d&&e.id&&d[e.id],b=A&&A.updateTriggers,I=e.id||"sublayer";if(A){const M=this.props[Xn],O=e.type?e.type._propTypes:{};for(const F in A){const V=O[F]||M[F];V&&V.type==="accessor"&&(A[F]=this.getSubLayerAccessor(A[F]))}}Object.assign(y,e,A),y.id=`${this.props.id}-${I}`,y.updateTriggers={all:(k=this.props.updateTriggers)==null?void 0:k.all,...e.updateTriggers,...b};for(const M of w){const O=M.getSubLayerProps.call(this,M);O&&Object.assign(y,O,{updateTriggers:Object.assign(y.updateTriggers,O.updateTriggers)})}return y}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=_d(s,Boolean),this.internalState.subLayers=r}ze($k,this,i,r);for(const s of r)s.parent=this}}zT.layerName="CompositeLayer";const Xk=zT,Xr={SUM:1,MEAN:2,MIN:3,MAX:4};function jT(t,e){return t+e}function Yk(t,e){return e>t?e:t}function Kk(t,e){return e<t?e:t}function qk(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(jT,0)/n.length:null}function Zk(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(jT,0):null}function Qk(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(Yk,-1/0):null}function Jk(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(Kk,1/0):null}function Gk(t,e,n){const r=Xr[t]||Xr.SUM;switch(e=eO(e,n),r){case Xr.MIN:return i=>Jk(i,e);case Xr.SUM:return i=>Zk(i,e);case Xr.MEAN:return i=>qk(i,e);case Xr.MAX:return i=>Qk(i,e);default:return null}}function eO(t,e={}){return Number.isFinite(t)?t:n=>(e.index=n.index,t(n.source,e))}function tO(t,e={}){return n=>(e.indices=n.map(r=>r.index),t(n.map(r=>r.source),e))}const nO=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function rO(t,e){const n={};for(const r in t)e.includes(r)||(n[r]=t[r]);return n}class HT extends Xk{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:rO(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){const r=this.getShaders({});r&&r.defines&&(r.defines.NON_INSTANCED_MODEL=1),this.updateShaders(r)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:n,device:r}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:n,picking:{isActive:0},devicePixelRatio:r.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,n={}){const{props:r,oldProps:i,changeFlags:s}=e,{compareAll:o=!1,dimension:a}=n,{ignoreProps:l}=this.state,{props:c,accessors:u=[]}=a,{updateTriggersChanged:h}=s;if(s.dataChanged)return!0;if(h){if(h.all)return!0;for(const f of u)if(h[f])return!0}if(o)return s.extensionsChanged?!0:Sd({oldProps:i,newProps:r,ignoreProps:l,propTypes:this.constructor._propTypes});for(const f of c)if(r[f]!==i[f])return!0;return!1}isAttributeChanged(e){const{changedAttributes:n}=this.state;return e?n&&n[e]!==void 0:!sO(n)}_getAttributeManager(){return new LT(this.context.device,{id:this.props.id,stats:this.context.stats})}}HT.layerName="AggregationLayer";const iO=HT;function sO(t){let e=!0;for(const n in t){e=!1;break}return e}function lc(t,e,n){const r=n;return r.domain=()=>t,r.range=()=>e,r}function gm(t,e){return lc(t,e,r=>dO(t,e,r))}function oO(t,e){return lc(t,e,r=>pO(t,e,r))}function aO(t,e){const n=t.sort(WT);let r=0;const i=Math.max(1,e.length),s=new Array(i-1);for(;++r<i;)s[r-1]=lO(n,r/i);const o=a=>uO(s,e,a);return o.thresholds=()=>s,lc(t,e,o)}function WT(t,e){return t-e}function lO(t,e){const n=t.length;if(e<=0||n<2)return t[0];if(e>=1)return t[n-1];const r=(n-1)*e,i=Math.floor(r),s=t[i],o=t[i+1];return s+(o-s)*(r-i)}function cO(t,e){let n=0,r=t.length;for(;n<r;){const i=n+r>>>1;WT(t[i],e)>0?r=i:n=i+1}return n}function uO(t,e,n){return e[cO(t,n)]}function hO(t,e,n,r){const i=`${r}`;let s=e.get(i);return s===void 0&&(s=t.push(r),e.set(i,s)),n[(s-1)%n.length]}function fO(t,e){const n=new Map,r=[];for(const s of t){const o=`${s}`;n.has(o)||n.set(o,r.push(s))}return lc(t,e,s=>hO(r,n,e,s))}function dO(t,e,n){const r=t[1]-t[0];if(r<=0)return ne.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const i=r/e.length,s=Math.floor((n-t[0])/i),o=Math.max(Math.min(s,e.length-1),0);return e[o]}function pO(t,e,n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}function $T(t){return t!=null}function gO(t){const e=[];return t.forEach(n=>{!e.includes(n)&&$T(n)&&e.push(n)}),e}function XT(t,e){return(typeof e=="function"?t.map(e):t).filter($T)}function _O(t,e){return XT(t,e)}function mO(t,e){return gO(XT(t,e))}function yO(t,e,n){return Math.max(e,Math.min(n,t))}function vO(t){switch(t){case"quantize":return gm;case"linear":return oO;case"quantile":return aO;case"ordinal":return fO;default:return gm}}const YT=t=>t.length,TO=3402823466e29,KT=t=>t.points,qT=t=>t.index,_m=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,EO={getValue:YT,getPoints:KT,getIndex:qT,filterData:null};class wO{constructor(e=[],n=EO){this.aggregatedBins=this.getAggregatedBins(e,n),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,n){const{getValue:r=YT,getPoints:i=KT,getIndex:s=qT,filterData:o}=n,a=typeof o=="function",l=e.length,c=[];let u=0;for(let h=0;h<l;h++){const f=e[h],m=i(f),E=s(f),w=a?m.filter(o):m;f.filteredPoints=a?w:null;const S=w.length?r(w):null;S!=null&&(c[u]={i:Number.isFinite(E)?E:h,value:S,counts:w.length},u++)}return c}_percentileToIndex(e){const n=this.sortedBins.length;if(n<2)return[0,0];const[r,i]=e.map(a=>yO(a,0,100)),s=Math.ceil(r/100*(n-1)),o=Math.floor(i/100*(n-1));return[s,o]}getBinMap(){const e={};for(const n of this.aggregatedBins)e[n.i]=n;return e}_updateMinMaxValues(){let e=0,n=0,r=TO,i=0;for(const s of this.aggregatedBins)e=e>s.counts?e:s.counts,n=n>s.value?n:s.value,r=r<s.value?r:s.value,i+=s.counts;this.maxCount=e,this.maxValue=n,this.minValue=r,this.totalCount=i}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((i,s)=>_m(i.value,s.value))),!this.sortedBins.length)return[];let n=0,r=this.sortedBins.length-1;if(Array.isArray(e)){const i=this._percentileToIndex(e);n=i[0],r=i[1]}return[this.sortedBins[n].value,this.sortedBins[r].value]}getValueDomainByScale(e,[n=0,r=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((s,o)=>_m(s.value,o.value))),!this.sortedBins.length)return[];const i=this._percentileToIndex([n,r]);return this._getScaleDomain(e,i)}_getScaleDomain(e,[n,r]){const i=this.sortedBins;switch(e){case"quantize":case"linear":return[i[n].value,i[r].value];case"quantile":return _O(i.slice(n,r+1),s=>s.value);case"ordinal":return mO(i,s=>s.value);default:return[i[n].value,i[r].value]}}}const SO={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function AO(t,e,n={}){return RO(t,n)!==e?(CO(t,n),!0):!1}function RO(t,e={}){return Math.sign(bO(t,e))}const mm={x:0,y:1,z:2};function bO(t,e={}){const{start:n=0,end:r=t.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=mm[i[0]],l=mm[i[1]];for(let c=n,u=r-s;c<r;c+=s)o+=(t[c+a]-t[u+a])*(t[c+l]+t[u+l]),u=c;return o/2}function CO(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*i,c=n+(s-1-a)*i;for(let u=0;u<i;++u){const h=t[l+u];t[l+u]=t[c+u],t[c+u]=h}}}class PO extends rx{constructor(e){const{indices:n,attributes:r}=xO(e);super({...e,indices:n,attributes:r})}}function xO(t){const{radius:e,height:n=1,nradial:r=10}=t;let{vertices:i}=t;i&&(ne.assert(i.length>=r),i=i.flatMap(m=>[m[0],m[1]]),AO(i,SO.COUNTER_CLOCKWISE));const s=n>0,o=r+1,a=s?o*3+1:r,l=Math.PI*2/r,c=new Uint16Array(s?r*3*2:0),u=new Float32Array(a*3),h=new Float32Array(a*3);let f=0;if(s){for(let m=0;m<o;m++){const E=m*l,w=m%r,S=Math.sin(E),_=Math.cos(E);for(let d=0;d<2;d++)u[f+0]=i?i[w*2]:_*e,u[f+1]=i?i[w*2+1]:S*e,u[f+2]=(1/2-d)*n,h[f+0]=i?i[w*2]:_,h[f+1]=i?i[w*2+1]:S,f+=3}u[f+0]=u[f-3],u[f+1]=u[f-2],u[f+2]=u[f-1],f+=3}for(let m=s?0:1;m<o;m++){const E=Math.floor(m/2)*Math.sign(.5-m%2),w=E*l,S=(E+r)%r,_=Math.sin(w),d=Math.cos(w);u[f+0]=i?i[S*2]:d*e,u[f+1]=i?i[S*2+1]:_*e,u[f+2]=n/2,h[f+2]=1,f+=3}if(s){let m=0;for(let E=0;E<r;E++)c[m++]=E*2+0,c[m++]=E*2+2,c[m++]=E*2+0,c[m++]=E*2+1,c[m++]=E*2+1,c[m++]=E*2+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:h}}}}const IO=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = radius * coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
if (radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,MO=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (extruded && !isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,vl=[0,0,0,255],NO={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:vl},getLineColor:{type:"accessor",value:vl},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Pd extends Cd{getShaders(){const e={},{flatShading:n}=this.props;return n&&(e.FLAT_SHADING=1),super.getShaders({vs:IO,fs:MO,defines:e,modules:[WP,n?bP:RP,f2]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:vl},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:vl},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var a;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=i.extensionsChanged||n.flatShading!==r.flatShading;s&&((a=this.state.models)==null||a.forEach(l=>l.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(s||n.diskResolution!==r.diskResolution||n.vertices!==r.vertices||(n.extruded||n.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(n)}getGeometry(e,n,r){const i=new PO({radius:1,height:r?2:0,vertices:n,nradial:e});let s=0;if(n)for(let o=0;o<e;o++){const a=n[o],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);s+=l/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),i}_getModels(){const e=this.getShaders(),n=this.getAttributeManager().getBufferLayouts(),r=new Li(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:n,isInstanced:!0}),i=new Li(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:n,isInstanced:!0});return{fillModel:r,wireframeModel:i,models:[i,r]}}_updateGeometry({diskResolution:e,vertices:n,extruded:r,stroked:i}){const s=this.getGeometry(e,n,r||i);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});const o=this.state.fillModel,a=this.state.wireframeModel;o.setGeometry(s),o.setTopology("triangle-strip"),o.setIndexBuffer(null),a.setGeometry(s),a.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:r,lineWidthMinPixels:i,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:l,filled:c,stroked:u,wireframe:h,offset:f,coverage:m,radius:E,angle:w}=this.props,S=this.state.fillModel,_=this.state.wireframeModel,{fillVertexCount:d,edgeDistance:y}=this.state,A={...e,radius:E,angle:w/180*Math.PI,offset:f,extruded:l,stroked:u,coverage:m,elevationScale:a,edgeDistance:y,radiusUnits:fl[o],widthUnits:fl[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s};l&&h&&(_.setUniforms(A),_.setUniforms({isStroke:!0}),_.draw(this.context.renderPass)),S.setUniforms(A),c&&(S.setVertexCount(d),S.setUniforms({isStroke:!1}),S.draw(this.context.renderPass)),!l&&u&&(S.setVertexCount(d*2/3),S.setUniforms({isStroke:!0}),S.draw(this.context.renderPass))}}Pd.layerName="ColumnLayer";Pd.defaultProps=NO;const kO=Pd;function ym(){}const vm=["getBins","getDomain","getScaleFunc"],Tm=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],OO=t=>t.cellSize;class FO{constructor(e){this.state={layerData:{data:void 0},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||OO,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||Tm)}static defaultDimensions(){return Tm}updateState(e,n){const{oldProps:r,props:i,changeFlags:s}=e;this.updateGetValueFuncs(r,i,s);const o=this.needsReProjectPoints(r,i,s);let a=!1;return s.dataChanged||o?(this.getAggregatedData(i,n),a=!0):((this.getDimensionChanges(r,i,s)||[]).forEach(c=>typeof c=="function"&&c()),a=!0),this.setState({aggregationDirty:a}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,n){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...n}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,n){const i=this._getAggregator(e)(e,n);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,n,r){for(const i in this.dimensionUpdaters){const{value:s,weight:o,aggregation:a}=this.dimensionUpdaters[i].getBins.triggers;let l=n[s.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,e,n,r)&&(l?l=tO(l,{data:n.data}):l=Gk(n[a.prop],n[o.prop],{data:n.data})),l&&this.setDimensionState(i,{getValue:l})}}needsReProjectPoints(e,n,r){return this._getCellSize(e)!==this._getCellSize(n)||this._getAggregator(e)!==this._getAggregator(n)||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach(n=>{const{key:r}=n;this.dimensionUpdaters[r]=this.getDimensionUpdaters(n),this.state.dimensions[r]={getValue:null,domain:null,sortedBins:null,scaleFunc:ym}})}getDimensionUpdaters({key:e,accessor:n,pickingInfo:r,getBins:i,getDomain:s,getScaleFunc:o,nullValue:a}){return{key:e,accessor:n,pickingInfo:r,getBins:{updater:this.getDimensionSortedBins.bind(this),...i},getDomain:{updater:this.getDimensionValueDomain.bind(this),...s},getScaleFunc:{updater:this.getDimensionScale.bind(this),...o},attributeAccessor:this.getSubLayerDimensionAttribute(e,a)}}needUpdateDimensionStep(e,n,r,i){return Object.values(e.triggers).some(s=>s.updateTrigger?i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[s.updateTrigger]):n[s.prop]!==r[s.prop])}getDimensionChanges(e,n,r){const i=[];for(const s in this.dimensionUpdaters){const o=vm.find(a=>this.needUpdateDimensionStep(this.dimensionUpdaters[s][a],e,n,r));o&&i.push(this.dimensionUpdaters[s][o].updater.bind(this,n,this.dimensionUpdaters[s]))}return i.length?i:null}getUpdateTriggers(e){const n=e.updateTriggers||{},r={};for(const i in this.dimensionUpdaters){const{accessor:s}=this.dimensionUpdaters[i];r[s]={},vm.forEach(o=>{Object.values(this.dimensionUpdaters[i][o].triggers).forEach(({prop:a,updateTrigger:l})=>{if(l){const c=n[l];typeof c=="object"&&!Array.isArray(c)?Object.assign(r[s],c):c!==void 0&&(r[s][a]=c)}else r[s][a]=e[a]})})}return r}getSortedBins(e){for(const n in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[n])}getDimensionSortedBins(e,n){const{key:r}=n,{getValue:i}=this.state.dimensions[r],s=new wO(this.state.layerData.data||[],{getValue:i,filterData:e._filterData});this.setDimensionState(r,{sortedBins:s}),this.getDimensionValueDomain(e,n)}getDimensionValueDomain(e,n){const{getDomain:r,key:i}=n,{triggers:{lowerPercentile:s,upperPercentile:o,scaleType:a}}=r,l=this.state.dimensions[i].sortedBins.getValueDomainByScale(e[a.prop],[e[s.prop],e[o.prop]]);this.setDimensionState(i,{valueDomain:l}),this.getDimensionScale(e,n)}getDimensionScale(e,n){const{key:r,getScaleFunc:i,getDomain:s}=n,{domain:o,range:a}=i.triggers,{scaleType:l}=s.triggers,{onSet:c}=i,u=e[a.prop],h=e[o.prop]||this.state.dimensions[r].valueDomain,m=vO(l&&e[l.prop])(h,u);typeof c=="object"&&typeof e[c.props]=="function"&&e[c.props](m.domain()),this.setDimensionState(r,{scaleFunc:m})}getSubLayerDimensionAttribute(e,n){return r=>{const{sortedBins:i,scaleFunc:s}=this.state.dimensions[e],o=i.binMap[r.index];if(o&&o.counts===0)return n;const a=o&&o.value,l=s.domain();return a>=l[0]&&a<=l[l.length-1]?s(a):n}}getSubLayerAccessors(e){const n={};for(const r in this.dimensionUpdaters){const{accessor:i}=this.dimensionUpdaters[r];n[i]=this.getSubLayerDimensionAttribute(e,r)}return n}getPickingInfo({info:e}){const n=e.picked&&e.index>-1;let r=null;if(n){const i=this.state.layerData.data[e.index],s={};for(const o in this.dimensionUpdaters){const{pickingInfo:a}=this.dimensionUpdaters[o],{sortedBins:l}=this.state.dimensions[o],c=l.binMap[i.index]&&l.binMap[i.index].value;s[a]=c}r=Object.assign(s,i,{points:i.filteredPoints||i.points})}return e.picked=!!r,e.object=r,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:ym}}var Kr=Math.PI/3,DO=[0,Kr,2*Kr,3*Kr,4*Kr,5*Kr];function UO(t){return t[0]}function BO(t){return t[1]}function LO(){var t=0,e=0,n=1,r=1,i=UO,s=BO,o,a,l;function c(h){var f={},m=[],E,w=h.length;for(E=0;E<w;++E)if(!(isNaN(_=+i.call(null,S=h[E],E,h))||isNaN(d=+s.call(null,S,E,h)))){var S,_,d,y=Math.round(d=d/l),A=Math.round(_=_/a-(y&1)/2),b=d-y;if(Math.abs(b)*3>1){var I=_-A,k=A+(_<A?-1:1)/2,M=y+(d<y?-1:1),O=_-k,F=d-M;I*I+b*b>O*O+F*F&&(A=k+(y&1?1:-1)/2,y=M)}var V=A+"-"+y,z=f[V];z?z.push(S):(m.push(z=f[V]=[S]),z.x=(A+(y&1)/2)*a,z.y=y*l)}return m}function u(h){var f=0,m=0;return DO.map(function(E){var w=Math.sin(E)*h,S=-Math.cos(E)*h,_=w-f,d=S-m;return f=w,m=S,[_,d]})}return c.hexagon=function(h){return"m"+u(h==null?o:+h).join("l")+"z"},c.centers=function(){for(var h=[],f=Math.round(e/l),m=Math.round(t/a),E=f*l;E<r+o;E+=l,++f)for(var w=m*a+(f&1)*a/2;w<n+a/2;w+=a)h.push([w,E]);return h},c.mesh=function(){var h=u(o).slice(0,4).join("l");return c.centers().map(function(f){return"M"+f+"m"+h}).join("")},c.x=function(h){return arguments.length?(i=h,c):i},c.y=function(h){return arguments.length?(s=h,c):s},c.radius=function(h){return arguments.length?(o=+h,a=o*2*Math.sin(Kr),l=o*1.5,c):o},c.size=function(h){return arguments.length?(t=e=0,n=+h[0],r=+h[1],c):[n-t,r-e]},c.extent=function(h){return arguments.length?(t=+h[0][0],e=+h[0][1],n=+h[1][0],r=+h[1][1],c):[[t,e],[n,r]]},c.radius(1)}function VO(t,e){const{data:n,radius:r}=t,{viewport:i,attributes:s}=e,o=n.length?zO(n,e):null,a=jO(r,i,o),l=[],{iterable:c,objectInfo:u}=PT(n),h=s.positions.value,{size:f}=s.positions.getAccessor();for(const w of c){u.index++;const S=u.index*f,_=[h[S],h[S+1]];Number.isFinite(_[0])&&Number.isFinite(_[1])?l.push({screenCoord:i.projectFlat(_),source:w,index:u.index}):ne.warn("HexagonLayer: invalid position")()}return{hexagons:LO().radius(a).x(w=>w.screenCoord[0]).y(w=>w.screenCoord[1])(l).map((w,S)=>({position:i.unprojectFlat([w.x,w.y]),points:w,index:S})),radiusCommon:a}}function zO(t,e){const{attributes:n}=e,r=n.positions.value,{size:i}=n.positions.getAccessor();let s=1/0,o=1/0,a=-1/0,l=-1/0,c;for(c=0;c<i*t.length;c+=i){const u=r[c],h=r[c+1];Number.isFinite(u)&&Number.isFinite(h)&&(s=Math.min(u,s),a=Math.max(u,a),o=Math.min(h,o),l=Math.max(h,l))}return[s,o,a,l].every(Number.isFinite)?[(s+a)/2,(o+l)/2]:null}function jO(t,e,n){const{unitsPerMeter:r}=e.getDistanceScales(n);return t*r[0]}function Em(){}const HO={colorDomain:null,colorRange:nO,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Em,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Em,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:VO,getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class xd extends iO{initializeState(){const e=new FO({getAggregator:r=>r.hexagonAggregator,getCellSize:r=>r.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){const n=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==n.layerData){const{hexagonVertices:r}=n.layerData||{};this.setState({vertices:r&&this.convertLatLngToMeterOffset(r)})}this.setState({aggregatorState:n})}}convertLatLngToMeterOffset(e){const{viewport:n}=this.context;if(Array.isArray(e)&&e.length===6){const r=e[0],i=e[3],s=[(r[0]+i[0])/2,(r[1]+i[1])/2],o=n.projectFlat(s),{metersPerUnit:a}=n.getDistanceScales(s);return e.map(c=>{const u=n.projectFlat(c);return[(u[0]-o[0])*a[0],(u[1]-o[1])*a[1]]})}return ne.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:n,coverage:r,material:i,transitions:s}=this.props,{aggregatorState:o,vertices:a}=this.state,l=this.getSubLayerClass("hexagon-cell",kO),c=this._getSublayerUpdateTriggers(),u=a?{vertices:a,radius:1}:{radius:o.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new l({...u,diskResolution:6,elevationScale:e,extruded:n,coverage:r,material:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:c}),{data:o.layerData.data})}}xd.layerName="HexagonLayer";xd.defaultProps=HO;const WO=xd,$O=typeof window<"u"?L.useLayoutEffect:L.useEffect,XO=$O;function Tl(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const YO={position:"absolute",zIndex:-1};function ZT(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>ZT(n,e));if(cc(t)){if(KO(t))return e.style=YO,L.cloneElement(t,e);if(qO(t))return L.cloneElement(t,e)}return t}function cc(t){return t&&typeof t=="object"&&"type"in t||!1}function KO(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function qO(t){const e=t.type;return e&&e.deckGLViewProps}function tf(t){if(typeof t=="function")return L.createElement(Vi,{},t);if(Array.isArray(t))return t.map(tf);if(cc(t)){if(t.type===L.Fragment)return tf(t.props.children);if(Tl(t.type,Vi))return t}return t}function ZO({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return L.Children.forEach(tf(t),o=>{if(cc(o)){const a=o.type;if(Tl(a,Cd)){const l=QO(a,o.props);i.push(l)}else r.push(o);if(Tl(a,Vi)&&a!==Vi&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function QO(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function JO({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,l=o;cc(o)&&Tl(o.type,Vi)&&(a=o.props.id||s,l=o.props.children);const c=r.getViewport(a),u=r.getViewState(a);if(c){u.padding=c.padding;const{x:h,y:f,width:m,height:E}=c;l=ZT(l,{x:h,y:f,width:m,height:E,viewport:c,viewState:u}),i[a]||(i[a]={viewport:c,children:[]}),i[a].children.push(l)}}return Object.keys(i).map(o=>{const{viewport:a,children:l}=i[o],{x:c,y:u,width:h,height:f}=a,m={position:"absolute",left:c,top:u,width:h,height:f},E=`view-${o}`,w=L.createElement("div",{key:E,id:E,style:m},...l);if(n){const S={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:_=>{_.viewId=o,e._onViewStateChange(_)}};return L.createElement(n,{key:E,value:S},w)}return w})}const GO={mixBlendMode:null};function eF({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in GO?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function tF(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function QT(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function nF(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const s=r.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():QT(t)}});return r}function rF(t,e){const[n,r]=L.useState(0),s=L.useRef({control:null,version:n,forceUpdate:()=>r(b=>b+1)}).current,o=L.useRef(null),a=L.useRef(null),l=L.useMemo(()=>ZO(t),[t.layers,t.views,t.children]);let c=!0;const u=b=>{var I;return c&&t.viewState?(s.viewStateUpdateRequested=b,null):(s.viewStateUpdateRequested=null,(I=t.onViewStateChange)==null?void 0:I.call(t,b))},h=b=>{var I;c?s.interactionStateUpdateRequested=b:(s.interactionStateUpdateRequested=null,(I=t.onInteractionStateChange)==null||I.call(t,b))},f=L.useMemo(()=>{const b={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:h};return delete b._customRender,s.deck&&s.deck.setProps(b),b},[t]);L.useEffect(()=>{const b=t.Deck||bN;return s.deck=nF(s,b,{...f,parent:o.current,canvas:a.current}),()=>{var I;return(I=s.deck)==null?void 0:I.finalize()}},[]),XO(()=>{QT(s);const{viewStateUpdateRequested:b,interactionStateUpdateRequested:I}=s;b&&u(b),I&&h(I)}),L.useImperativeHandle(e,()=>tF(s),[]);const m=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:E,width:w="100%",height:S="100%",id:_,style:d}=t,{containerStyle:y,canvasStyle:A}=L.useMemo(()=>eF({width:w,height:S,style:d}),[w,S,d]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===m||s.version!==n){s.lastRenderedViewports=m,s.version=n;const b=JO({children:l.children,deck:s.deck,ContextProvider:E}),I=L.createElement("canvas",{key:"canvas",id:_||"deckgl-overlay",ref:a,style:A});s.control=L.createElement("div",{id:`${_||"deckgl"}-wrapper`,ref:o,style:y},[I,b])}return c=!1,s.control}const iF=L.forwardRef(rF),sF=iF;/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const wm="\uFEFF",Zt={parse:oF,unparse:aF,RECORD_SEP:String.fromCharCode(30),UNIT_SEP:String.fromCharCode(31),BYTE_ORDER_MARK:wm,BAD_DELIMITERS:["\r",`
`,'"',wm],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:nf,ParserHandle:GT,ChunkStreamer:JT,StringStreamer:zi},uc=Zt;function oF(t,e,n){e=e||{};var r=e.dynamicTyping||!1;if(Ye(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=Ye(e.transform)?e.transform:!1,e.worker&&Zt.WORKERS_SUPPORTED){var i=newWorker();i.userStep=e.step,i.userChunk=e.chunk,i.userComplete=e.complete,i.userError=e.error,e.step=Ye(e.step),e.chunk=Ye(e.chunk),e.complete=Ye(e.complete),e.error=Ye(e.error),delete e.worker,i.postMessage({input:t,config:e,workerId:i.id});return}var s=null;return typeof t=="string"&&(s=new zi(e)),s||(s=new n(e)),s.stream(t)}function aF(t,e){var n=!1,r=!0,i=",",s=`\r
`,o='"',a=o+o,l=!1,c=null;h();var u=new RegExp(co(o),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return m(null,t,l);if(typeof t[0]=="object")return m(c||f(t[0]),t,l)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:f(t.data[0])),!Array.isArray(t.data[0])&&typeof t.data[0]!="object"&&(t.data=[t.data])),m(t.fields||[],t.data||[],l);throw new Error("Unable to serialize unrecognized input");function h(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!Zt.BAD_DELIMITERS.filter(function(S){return e.delimiter.indexOf(S)!==-1}).length&&(i=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(n=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(l=e.skipEmptyLines),typeof e.newline=="string"&&(s=e.newline),typeof e.quoteChar=="string"&&(o=e.quoteChar),typeof e.header=="boolean"&&(r=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");c=e.columns}e.escapeChar!==void 0&&(a=e.escapeChar+o)}}function f(S){if(typeof S!="object")return[];var _=[];for(var d in S)_.push(d);return _}function m(S,_,d){var y="";typeof S=="string"&&(S=JSON.parse(S)),typeof _=="string"&&(_=JSON.parse(_));var A=Array.isArray(S)&&S.length>0,b=!Array.isArray(_[0]);if(A&&r){for(var I=0;I<S.length;I++)I>0&&(y+=i),y+=E(S[I],I);_.length>0&&(y+=s)}for(var k=0;k<_.length;k++){var M=A?S.length:_[k].length,O=!1,F=A?Object.keys(_[k]).length===0:_[k].length===0;if(d&&!A&&(O=d==="greedy"?_[k].join("").trim()==="":_[k].length===1&&_[k][0].length===0),d==="greedy"&&A){for(var V=[],z=0;z<M;z++){var X=b?S[z]:z;V.push(_[k][X])}O=V.join("").trim()===""}if(!O){for(var $=0;$<M;$++){$>0&&!F&&(y+=i);var G=A&&b?S[$]:$;y+=E(_[k][G],$)}k<_.length-1&&(!d||M>0&&!F)&&(y+=s)}}return y}function E(S,_){if(typeof S>"u"||S===null)return"";if(S.constructor===Date)return JSON.stringify(S).slice(1,25);S=S.toString().replace(u,a);var d=typeof n=="boolean"&&n||Array.isArray(n)&&n[_]||w(S,Zt.BAD_DELIMITERS)||S.indexOf(i)>-1||S.charAt(0)===" "||S.charAt(S.length-1)===" ";return d?o+S+o:S}function w(S,_){for(var d=0;d<_.length;d++)if(S.indexOf(_[d])>-1)return!0;return!1}}function JT(t){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},e.call(this,t),this.parseChunk=function(n,r){if(this.isFirstChunk&&Ye(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(n);i!==void 0&&(n=i)}this.isFirstChunk=!1;var s=this._partialLine+n;this._partialLine="";var o=this._handle.parse(s,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var a=o.meta.cursor;this._finished||(this._partialLine=s.substring(a-this._baseIndex),this._baseIndex=a),o&&o.data&&(this._rowCount+=o.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(Ye(this._config.chunk)&&!r){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return;o=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!this._completed&&l&&Ye(this._config.complete)&&(!o||!o.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),!l&&(!o||!o.meta.paused)&&this._nextChunk(),o}},this._sendError=function(n){Ye(this._config.error)&&this._config.error(n)};function e(n){var r=Id(n);r.chunkSize=parseInt(r.chunkSize),!n.step&&!n.chunk&&(r.chunkSize=null),this._handle=new GT(r),this._handle.streamer=this,this._config=r}}function zi(t){t=t||{},JT.call(this,t);var e;this.stream=function(n){return e=n,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var n=this._config.chunkSize,r=n?e.substr(0,n):e;return e=n?e.substr(n):"",this._finished=!e,this.parseChunk(r)}}}zi.prototype=Object.create(zi.prototype);zi.prototype.constructor=zi;function GT(t){var e=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,n=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,r=this,i=0,s=0,o,a,l=!1,c=!1,u,h=[],f={data:[],errors:[],meta:{}};if(Ye(t.step)){var m=t.step;t.step=function(M){if(f=M,S())w();else{if(w(),!f.data||f.data.length===0)return;i+=M.data.length,t.preview&&i>t.preview?a.abort():m(f,r)}}}this.parse=function(M,O,F){var V=t.quoteChar||'"';if(t.newline||(t.newline=I(M,V)),u=!1,t.delimiter)Ye(t.delimiter)&&(t.delimiter=t.delimiter(M),f.meta.delimiter=t.delimiter);else{var z=b(M,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);z.successful?t.delimiter=z.bestDelimiter:(u=!0,t.delimiter=Zt.DefaultDelimiter),f.meta.delimiter=t.delimiter}var X=Id(t);return t.preview&&t.header&&X.preview++,o=M,a=new nf(X),f=a.parse(o,O,F),w(),l?{meta:{paused:!0}}:f||{meta:{paused:!1}}},this.paused=function(){return l},this.pause=function(){l=!0,a.abort(),o=o.substr(a.getCharIndex())},this.resume=function(){l=!1,r.streamer.parseChunk(o,!0)},this.aborted=function(){return c},this.abort=function(){c=!0,a.abort(),f.meta.aborted=!0,Ye(t.complete)&&t.complete(f),o=""};function E(M){return t.skipEmptyLines==="greedy"?M.join("").trim()==="":M.length===1&&M[0].length===0}function w(){if(f&&u&&(k("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Zt.DefaultDelimiter+"'"),u=!1),t.skipEmptyLines)for(var M=0;M<f.data.length;M++)E(f.data[M])&&f.data.splice(M--,1);return S()&&_(),A()}function S(){return t.header&&h.length===0}function _(){if(!f)return;function M(F){Ye(t.transformHeader)&&(F=t.transformHeader(F)),h.push(F)}if(Array.isArray(f.data[0])){for(var O=0;S()&&O<f.data.length;O++)f.data[O].forEach(M);f.data.splice(0,1)}else f.data.forEach(M)}function d(M){return t.dynamicTypingFunction&&t.dynamicTyping[M]===void 0&&(t.dynamicTyping[M]=t.dynamicTypingFunction(M)),(t.dynamicTyping[M]||t.dynamicTyping)===!0}function y(M,O){return d(M)?O==="true"||O==="TRUE"?!0:O==="false"||O==="FALSE"?!1:e.test(O)?parseFloat(O):n.test(O)?new Date(O):O===""?null:O:O}function A(){if(!f||!f.data||!t.header&&!t.dynamicTyping&&!t.transform)return f;function M(F,V){var z=t.header?{}:[],X;for(X=0;X<F.length;X++){var $=X,G=F[X];t.header&&($=X>=h.length?"__parsed_extra":h[X]),t.transform&&(G=t.transform(G,$)),G=y($,G),$==="__parsed_extra"?(z[$]=z[$]||[],z[$].push(G)):z[$]=G}return t.header&&(X>h.length?k("FieldMismatch","TooManyFields","Too many fields: expected "+h.length+" fields but parsed "+X,s+V):X<h.length&&k("FieldMismatch","TooFewFields","Too few fields: expected "+h.length+" fields but parsed "+X,s+V)),z}var O=1;return!f.data[0]||Array.isArray(f.data[0])?(f.data=f.data.map(M),O=f.data.length):f.data=M(f.data,0),t.header&&f.meta&&(f.meta.fields=h),s+=O,f}function b(M,O,F,V,z){var X,$,G;z=z||[",","	","|",";",Zt.RECORD_SEP,Zt.UNIT_SEP];for(var dt=0;dt<z.length;dt++){var Qe=z[dt],j=0,Y=0,q=0;G=void 0;for(var K=new nf({comments:V,delimiter:Qe,newline:O,preview:10}).parse(M),J=0;J<K.data.length;J++){if(F&&E(K.data[J])){q++;continue}var he=K.data[J].length;if(Y+=he,typeof G>"u"){G=0;continue}else he>1&&(j+=Math.abs(he-G),G=he)}K.data.length>0&&(Y/=K.data.length-q),(typeof $>"u"||j>$)&&Y>1.99&&($=j,X=Qe)}return t.delimiter=X,{successful:!!X,bestDelimiter:X}}function I(M,O){M=M.substr(0,1024*1024);var F=new RegExp(co(O)+"([^]*?)"+co(O),"gm");M=M.replace(F,"");var V=M.split("\r"),z=M.split(`
`),X=z.length>1&&z[0].length<V[0].length;if(V.length===1||X)return`
`;for(var $=0,G=0;G<V.length;G++)V[G][0]===`
`&&$++;return $>=V.length/2?`\r
`:"\r"}function k(M,O,F,V){f.errors.push({type:M,code:O,message:F,row:V})}}function co(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function nf(t){t=t||{};var e=t.delimiter,n=t.newline,r=t.comments,i=t.step,s=t.preview,o=t.fastMode,a;t.quoteChar===void 0?a='"':a=t.quoteChar;var l=a;if(t.escapeChar!==void 0&&(l=t.escapeChar),(typeof e!="string"||Zt.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),r===e)throw new Error("Comment character same as delimiter");r===!0?r="#":(typeof r!="string"||Zt.BAD_DELIMITERS.indexOf(r)>-1)&&(r=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var c=0,u=!1;this.parse=function(h,f,m){if(typeof h!="string")throw new Error("Input must be a string");var E=h.length,w=e.length,S=n.length,_=r.length,d=Ye(i);c=0;var y=[],A=[],b=[],I=0;if(!h)return K();if(o||o!==!1&&h.indexOf(a)===-1){for(var k=h.split(n),M=0;M<k.length;M++){if(b=k[M],c+=b.length,M!==k.length-1)c+=n.length;else if(m)return K();if(!(r&&b.substr(0,_)===r)){if(d){if(y=[],Qe(b.split(e)),J(),u)return K()}else Qe(b.split(e));if(s&&M>=s)return y=y.slice(0,s),K(!0)}}return K()}for(var O=h.indexOf(e,c),F=h.indexOf(n,c),V=new RegExp(co(l)+co(a),"g"),z;;){if(h[c]===a){for(z=c,c++;;){if(z=h.indexOf(a,z+1),z===-1)return m||A.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:y.length,index:c}),Y();if(z===E-1){var X=h.substring(c,z).replace(V,a);return Y(X)}if(a===l&&h[z+1]===l){z++;continue}if(!(a!==l&&z!==0&&h[z-1]===l)){var $=F===-1?O:Math.min(O,F),G=j($);if(h[z+1+G]===e){if(b.push(h.substring(c,z).replace(V,a)),c=z+1+G+w,O=h.indexOf(e,c),F=h.indexOf(n,c),d&&(J(),u))return K();if(s&&y.length>=s)return K(!0);break}var dt=j(F);if(h.substr(z+1+dt,S)===n){if(b.push(h.substring(c,z).replace(V,a)),q(z+1+dt+S),O=h.indexOf(e,c),d&&(J(),u))return K();if(s&&y.length>=s)return K(!0);break}A.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:y.length,index:c}),z++}}if(d&&(J(),u))return K();if(s&&y.length>=s)return K(!0);continue}if(r&&b.length===0&&h.substr(c,_)===r){if(F===-1)return K();c=F+S,F=h.indexOf(n,c),O=h.indexOf(e,c);continue}if(O!==-1&&(O<F||F===-1)){b.push(h.substring(c,O)),c=O+w,O=h.indexOf(e,c);continue}if(F!==-1){if(b.push(h.substring(c,F)),q(F+S),d&&(J(),u))return K();if(s&&y.length>=s)return K(!0);continue}break}return Y();function Qe(he){y.push(he),I=c}function j(he){var Ue=0;if(he!==-1){var At=h.substring(z+1,he);At&&At.trim()===""&&(Ue=At.length)}return Ue}function Y(he){return m||(typeof he>"u"&&(he=h.substr(c)),b.push(he),c=E,Qe(b),d&&J()),K()}function q(he){c=he,Qe(b),b=[],F=h.indexOf(n,c)}function K(he,Ue){var At=Ue||!1;return{data:At?y[0]:y,errors:A,meta:{delimiter:e,linebreak:n,aborted:u,truncated:!!he,cursor:I+(f||0)}}}function J(){i(K(void 0,!0)),y=[],A=[]}},this.abort=function(){u=!0},this.getCharIndex=function(){return c}}function Id(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var n in t)e[n]=Id(t[n]);return e}function Ye(t){return typeof t=="function"}const{ChunkStreamer:eE}=uc;function El(t){t=t||{},eE.call(this,t),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(e){this._input=e;try{for await(const n of e)this.parseChunk(this.getStringChunk(n));this._finished=!0,this.parseChunk("")}catch(n){this._sendError(n)}},this._nextChunk=function(){},this.getStringChunk=function(e){return typeof e=="string"?e:this.textDecoder.decode(e,{stream:!0})}}El.prototype=Object.create(eE.prototype);El.prototype.constructor=El;const lF="4.2.4",Md="object-row-table",Nd={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:lF,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(t,e)=>Sm(new TextDecoder().decode(t),e),parseText:(t,e)=>Sm(t,e),parseInBatches:cF,options:{csv:{shape:Md,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function Sm(t,e){const n={...Nd.options.csv,...e==null?void 0:e.csv},r=uF(t),s=n.header==="auto"?tE(r):!!n.header,o={...n,header:s,download:!1,transformHeader:s?nE():void 0,error:h=>{throw new Error(h)}},a=uc.parse(t,o),l=a.data,c=a.meta.fields||rE(n.columnPrefix,r.length),u=n.shape||Md;switch(u){case"object-row-table":return{shape:"object-row-table",data:l.map(h=>Array.isArray(h)?iv(h,c):h)};case"array-row-table":return{shape:"array-row-table",data:l.map(h=>Array.isArray(h)?h:sv(h,c))};default:throw new Error(u)}}function cF(t,e){e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const n={...Nd.options.csv,...e==null?void 0:e.csv},r=new _R;let i=!0,s=null,o=null,a=null;const l={...n,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(c){let u=c.data;if(n.skipEmptyLines&&u.flat().join("").trim()==="")return;const h=c.meta.cursor;if(i&&!s&&(n.header==="auto"?tE(u):!!n.header)){s=u.map(nE());return}i&&(i=!1,s||(s=rE(n.columnPrefix,u.length)),a=hF(u,s)),n.optimizeMemoryUsage&&(u=JSON.parse(JSON.stringify(u)));const f=n.shape||Md;o=o||new yh(a,{shape:f,...e});try{o.addRow(u);const m=o&&o.getFullBatch({bytesUsed:h});m&&r.enqueue(m)}catch(m){r.enqueue(m)}},complete(c){try{const u=c.meta.cursor,h=o&&o.getFinalBatch({bytesUsed:u});h&&r.enqueue(h)}catch(u){r.enqueue(u)}r.close()}};return uc.parse(t,l,El),r}function tE(t){return t&&t.every(e=>typeof e=="string")}function uF(t){return uc.parse(t,{download:!1,dynamicTyping:!0,preview:1}).data[0]}function nE(){const t=new Set;return e=>{let n=e,r=1;for(;t.has(n);)n=`${e}.${r}`,r++;return t.add(n),n}}function rE(t,e=0){const n=[];for(let r=0;r<e;r++)n.push(`${t}${r+1}`);return n}function hF(t,e){const n=e?{}:[];for(let r=0;r<t.length;r++){const i=e&&e[r]||r;switch(typeof t[r]){case"number":case"boolean":n[i]={name:String(i),index:r,type:Float32Array};break;case"string":default:n[i]={name:String(i),index:r,type:Array}}}return n}const fF="data/cleaned/vancouver_bicycle_thefts_cleaned.csv",dF=new Qv({color:[255,255,255],intensity:1}),pF=new rT({color:[255,255,255],intensity:1,position:[-123.12103,49.27869,8e4]}),gF=new rT({color:[255,255,255],intensity:1,position:[-116.89301,49.119268]}),_F=new gd({ambientLight:dF,pointLight1:pF,pointLight2:gF}),mF={longitude:-123.12103,latitude:49.27869,zoom:11.7,minZoom:5,maxZoom:30,pitch:40.5},yF="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",vF=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78],[196,45,69],[183,35,61],[170,25,52],[157,15,43],[144,5,35],[131,0,30],[118,0,25]];function TF({object:t}){if(!t)return null;const e=t.position[1],n=t.position[0],r=t.elevationValue;let i;return r==1?i="Bicycle Theft":i="Bicycle Thefts",`    latitude: ${Number.isFinite(e)?e.toFixed(6):""}
    longitude: ${Number.isFinite(n)?n.toFixed(6):""}
    ${r} ${i}`}function Am({data:t=null,mapStyle:e=yF}){const[n,r]=L.useState(50),[i,s]=L.useState(2003),[o,a]=L.useState(t),[l,c]=L.useState(2);L.useEffect(()=>{t&&a(t.filter(h=>h[2]===i))},[t,i]);const u=[new WO({id:"heatmap",colorDomain:[l,65],colorRange:vF,coverage:1,data:o,elevationDomain:[l,65],elevationRange:[0,7e3],extruded:!0,getPosition:h=>h,pickable:!0,radius:n,material:{ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},transitions:{elevationScale:3e3}})];return xe.createElement("div",null,xe.createElement("div",null,xe.createElement(sF,{layers:u,effects:[_F],initialViewState:mF,controller:!0,getTooltip:TF},xe.createElement(R1,{reuseMaps:!0,mapStyle:e}))),xe.createElement("div",{className:"box"},xe.createElement("h3",null,"Vancouver Bike Thefts"),xe.createElement("label",{className:"slider_label"},"Radius: ",n),xe.createElement("div",{className:"slider"},xe.createElement("input",{type:"range",min:10,max:120,step:10,value:n,onChange:h=>r(Number(h.target.value))})),xe.createElement("label",{className:"slider_label"},"Year: ",i),xe.createElement("div",{className:"slider"},xe.createElement("input",{type:"range",min:2003,max:2024,value:i,onChange:h=>s(Number(h.target.value))})),xe.createElement("label",{className:"slider_label"},"Minimum Value: ",l),xe.createElement("div",{className:"slider"},xe.createElement("input",{type:"range",min:1,max:5,value:l,onChange:h=>c(Number(h.target.value))})),xe.createElement("p",null,"(Hold shift and click to rotate the view)")))}async function EF(t){const e=U0(t);e.render(xe.createElement(Am,null));const r=(await Ga(fF,Nd)).data.map(i=>Number.isFinite(i.longitude)?[i.longitude,i.latitude,i.date_year]:null).filter(Boolean);e.render(xe.createElement(Am,{data:r}))}EF(document.getElementById("app"));export{SF as c,bm as g};
